<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>MMMMMCCLXXVII</title>
  <subtitle>美丽的火花在恋人的周围环绕</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.mmmmmcclxxvii.cn/"/>
  <updated>2017-04-10T05:36:01.000Z</updated>
  <id>http://www.mmmmmcclxxvii.cn/</id>
  
  <author>
    <name>Crayon Chaney</name>
    <email>mmmmmcclxxvii@yeah.net</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>vim的字符编码</title>
    <link href="http://www.mmmmmcclxxvii.cn/2017/04/10/vim-encoding/"/>
    <id>http://www.mmmmmcclxxvii.cn/2017/04/10/vim-encoding/</id>
    <published>2017-04-10T04:43:00.000Z</published>
    <updated>2017-04-10T05:36:01.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="vim中的编码"><a href="#vim中的编码" class="headerlink" title="vim中的编码"></a>vim中的编码</h1><p>vim 有四个跟字符编码方式有关的选项，encoding、fileencoding、fileencodings、termencoding (这些选项可能的取值请参考 Vim 在线帮助 :help encoding-names)</p>
<ul>
<li>encoding: Vim 内部使用的字符编码方式，包括 Vim 的 buffer (缓冲区)、菜单文本、消息文本等。默认是根据你的locale选择.用户手册上建议只在 .vimrc 中改变它的值，事实上似乎也只有在.vimrc 中改变它的值才有意义。你可以用另外一种编码来编辑和保存文件，如你的vim的encoding为utf-8,所编辑的文件采用cp936编码,vim会自动将读入的文件转成utf-8(vim的能读懂的方式），而当你写入文件时,又会自动转回成cp936（文件的保存编码). </li>
<li>fileencoding: Vim 中当前编辑的文件的字符编码方式，Vim 保存文件时也会将文件保存为这种字符编码方式 (不管是否新文件都如此)。 </li>
<li>fileencodings: Vim自动探测fileencoding的顺序列表， 启动时会按照它所列出的字符编码方式逐一探测即将打开的文件的字符编码方式，并且将 fileencoding 设置为最终探测到的字符编码方式。因此最好将Unicode 编码方式放到这个列表的最前面，将拉丁语系编码方式 latin1 放到最后面。 </li>
<li>termencoding: Vim 所工作的终端 (或者 Windows 的 Console 窗口) 的字符编码方式。如果vim所在的term与vim编码相同，则无需设置。如其不然，你可以用vim的termencoding选项将自动转换成term的编码.这个选项在 Windows 下对我们常用的 GUI 模式的 gVim 无效，而对 Console 模式的Vim 而言就是 Windows 控制台的代码页，并且通常我们不需要改变它。 </li>
</ul>
<p>最主要的就是关注一下<code>encoding</code>和<code>fileencoding</code>，总结就是前者是vim内部处理字符的用的。vim中可能会处理不一样的编码的字符，然后都化为统一的格式进行处理是最明智的。后者是文件的编码格式。</p>
<p>上面也说的很清楚了，文件读入时，若是<code>fileencoding</code>和<code>encoding</code>不一致，会先转化成<code>encoding</code>，统一处理，最后保存的时候再转化回<code>fileencoding</code>。转化的过程就是通过<code>unicode</code>这个第二层过渡。看<a href="http://www.mmmmmcclxxvii.cn/2016/10/04/encoding/">编码总结</a></p>
<h1 id="vim的多字符编码方式支持工作流程"><a href="#vim的多字符编码方式支持工作流程" class="headerlink" title="vim的多字符编码方式支持工作流程"></a>vim的多字符编码方式支持工作流程</h1><ol>
<li>Vim 启动，根据 <code>.vimrc</code> 中设置的<code>encoding</code> 的值来设置 buffer、菜单文本、消息文的字符编码方式。 </li>
<li>读取需要编辑的文件，根据<code>fileencodings</code> 中列出的字符编码方式逐一探测该文件编码方式。并设置<code>fileencoding</code>为探测到的，看起来是正确的 字符编码方式。 </li>
<li>对比<code>fileencoding</code>和<code>encoding</code>的值，若不同则调用<code>iconv</code>将文件内容转换为<code>encoding</code>所描述的字符编码方式，并且把转换后的内容放到为此文件开辟的<code>buffer</code>里，此时我们就可以开始编辑这个文件了。注意，完成这一步动作需要调用外部的<code>iconv.dll</code>，你需要保证这个文件存在于<code>$VIMRUNTIME</code>或者其他列在<code>PATH</code>环境变量中的目录里。 </li>
<li>编辑完成后保存文件时，再次对比<code>fileencoding</code>和<code>encoding</code>的值。若不同，再次调用<code>iconv</code>将即将保存的 buffer 中的文本转换为<code>fileencoding</code>所描述的字符编码方式，并保存到指定的文件中。同样，这需要调用<code>iconv.dll</code>由于<code>Unicode</code>能够包含几乎所有的语言的字符，而且<code>Unicode</code>的<code>UTF-8</code>编码方式又是非常具有性价比的编码方式 (空间消耗比<code>UCS-2</code>小)，因此建议<code>encoding</code>的值设置为<code>utf-8</code>。这么做的另一个理由是<code>encoding</code>设置为<code>utf-8</code>时，Vim 自动探测文件的编码方式会更准确 (或许这个理由才是主要的 ;)。我们在中文 Windows 里编辑的文件，为了兼顾与其他软件的兼容性，文件编码还是设置为<code>GB2312/GBK</code> 比较合适，因此<code>fileencoding</code>建议设置为 chinese (chinese 是个别名，在 Unix 里表示 gb2312，在 Windows 里表示cp936，也就是 GBK 的代码页)。 </li>
</ol>
]]></content>
    
    <summary type="html">
    
      对vim中`encoding`,`filenecoding`,`fileencodings`,`termencoding`的区别做个认识
    
    </summary>
    
      <category term="砍树人" scheme="http://www.mmmmmcclxxvii.cn/categories/%E7%A0%8D%E6%A0%91%E4%BA%BA/"/>
    
    
      <category term="encode" scheme="http://www.mmmmmcclxxvii.cn/tags/encode/"/>
    
      <category term="utf-8" scheme="http://www.mmmmmcclxxvii.cn/tags/utf-8/"/>
    
  </entry>
  
  <entry>
    <title>用R画出下面这样子的形式的图</title>
    <link href="http://www.mmmmmcclxxvii.cn/2017/04/07/r-lines/"/>
    <id>http://www.mmmmmcclxxvii.cn/2017/04/07/r-lines/</id>
    <published>2017-04-07T05:35:06.000Z</published>
    <updated>2017-04-07T07:08:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>用到什么学什么</p>
<h1 id="plot的使用"><a href="#plot的使用" class="headerlink" title="plot的使用"></a>plot的使用</h1><p>官方的description</p>
<blockquote>
<p>Generic function for plotting of R objects. For more details about the graphical parameter arguments, see par.</p>
<p>For simple scatter plots, plot.default will be used. However, there are plot methods for many R objects, including functions, data.frames, density objects, etc. Use methods(plot) and the documentation for these.</p>
<p>plot(x, y, …)</p>
</blockquote>
<p>这里先用到plot的一个type参数</p>
<blockquote>
<p>what type of plot should be drawn. Possible types are</p>
<p>“p” for points,</p>
<p>“l” for lines,</p>
<p>“b” for both,</p>
<p>“c” for the lines part alone of “b”,</p>
<p>“o” for both ‘overplotted’,</p>
<p>“h” for ‘histogram’ like (or ‘high-density’) vertical lines,</p>
<p>“s” for stair steps,</p>
<p>“S” for other steps, see ‘Details’ below,</p>
<p>“n” for no plotting.</p>
</blockquote>
<p>这里有个<code>&quot;n&quot;</code>的参数值可以选择，也就是什么都不会打印，先看个例子<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">x &lt;- seq(-pi,pi,length = <span class="number">100</span>)</div><div class="line">plot(x,sin(x),type=<span class="string">'p'</span>)</div><div class="line">plot(x,sin(x),type=<span class="string">'l'</span>)</div><div class="line">plot(x,sin(x),type=<span class="string">'n'</span>)</div></pre></td></tr></table></figure></p>
<p>分别是这样色儿的<br><img src="http://onexs3cnv.bkt.clouddn.com/Rplot-sin.png" alt="points"><br><img src="http://onexs3cnv.bkt.clouddn.com/Rplot-sin-line.png" alt="line"><br><img src="http://onexs3cnv.bkt.clouddn.com/Rplot-sine-none.png" alt="none"><br>看最后一个，也就是什么都没画。什么都没有有什么用！？<br><strong>存在即合理</strong>，它可以用来弄一个画布，然后再在上面画其他图形</p>
<p>比如：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt; plot(c(<span class="number">0</span>,<span class="number">10</span>),c(<span class="number">0</span>,<span class="number">10</span>))</div></pre></td></tr></table></figure></p>
<p><img src="http://onexs3cnv.bkt.clouddn.com/Rplot-canvas-with-something.png" alt="with points"></p>
<p>这里<code>plot</code>的<code>x</code>,<code>y</code>参数是用向量指定的，<code>x</code>坐标的放一起，<code>y</code>坐标的放一起，其实坐标点是<code>(0,0)</code>,和<code>(10,10)</code>，在这两个坐标上，默认是画了两个小圆圈。但是如果我想要一个有坐标系的这样的一个画布，我就可以</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt; plot(c(<span class="number">0</span>,<span class="number">10</span>),c(<span class="number">0</span>,<span class="number">10</span>),type=<span class="string">'n'</span>)</div></pre></td></tr></table></figure>
<p><img src="http://onexs3cnv.bkt.clouddn.com/Rplot-canvas-blank.png" alt="no points canvas"></p>
<p>而这里<code>x</code>,<code>y</code>的作用就是撑开画布坐标系的大小，我如果<code>plot(c(0,50),c(0,50),type=&#39;n&#39;)</code>，那坐标系就变大了。</p>
<h1 id="lines"><a href="#lines" class="headerlink" title="lines"></a>lines</h1><blockquote>
<p>A generic function taking coordinates given in various ways and joining the corresponding points with line segments.<br>lines(x, …)</p>
<h2 id="Default-S3-method"><a href="#Default-S3-method" class="headerlink" title="Default S3 method:"></a>Default S3 method:</h2><p>lines(x, y = NULL, type = “l”, …)</p>
</blockquote>
<p>就是根据像<code>plot</code>那样<code>x</code>,<code>y</code>解释的意思，将两点连起来，<del>同时用<code>type</code>指定的样式画出这点线</del><br>这个说法有点不正确，好像是说<code>type</code>指定的是线的样式，比如实线，虚线，不是的。<code>lty</code>这个参数才是指定“线样式的”</p>
<p>我这里看到了<code>lines(x,...)</code>说明可以不用指定<code>y</code>，那画出来是什么？？<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; plot(c(<span class="number">0</span>,<span class="number">10</span>),c(<span class="number">0</span>,<span class="number">10</span>),type=<span class="string">'n'</span>)</div><div class="line">&gt; lines(c(<span class="number">0</span>,<span class="number">1</span>))</div><div class="line">&gt; lines(c(<span class="number">5</span>,<span class="number">9</span>))</div><div class="line">&gt; lines(c(<span class="number">2</span>,<span class="number">4</span>))</div><div class="line">&gt; lines(c(<span class="number">10</span>,<span class="number">1</span>))</div><div class="line">&gt; lines(c(<span class="number">4</span>,<span class="number">7</span>))</div></pre></td></tr></table></figure></p>
<p><img src="http://onexs3cnv.bkt.clouddn.com/Rplot-line%28x%29.png" alt="line(x)"><br>可以看出来给出的<code>c(a,b)</code>，a,b都是表示纵坐标，默认好像横坐标是1到2，那这样就是画<code>(1,a)</code>到<code>(2,b)</code>的线？<br>至少实验出来是这样的<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt; lines(c(<span class="number">4</span>,<span class="number">7</span>,<span class="number">6</span>))</div></pre></td></tr></table></figure></p>
<p><img src="http://onexs3cnv.bkt.clouddn.com/Rplot-line%28x%29-456.png" alt="line(x)456"><br>三个向量元素，那上面的猜测是对的，现在是画<code>(1,a)</code>,<code>(2,b)</code>,<code>(3,c)</code>的线段，估计向量元素增多，就是横坐标到4，5，6了吧</p>
<h2 id="lines-的type"><a href="#lines-的type" class="headerlink" title="lines 的type"></a>lines 的type</h2><blockquote>
<p>lines(x, y, type = “l”, …)<br>type<br>character indicating the type of plotting; actually any of the types as in plot.default.</p>
</blockquote>
<p>说是根据<code>plot</code>的<code>type</code>来，一开始我觉得这不跟<code>lty</code>参数重复了么，其实两个是不一样的<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; plot(c(<span class="number">0</span>,<span class="number">10</span>),c(<span class="number">0</span>,<span class="number">10</span>),type=<span class="string">'n'</span>)</div><div class="line">&gt; lines(c(<span class="number">2</span>,<span class="number">4</span>),c(<span class="number">3</span>,<span class="number">8</span>),type = <span class="string">"s"</span>)</div><div class="line">&gt; lines(c(<span class="number">6</span>,<span class="number">7</span>),c(<span class="number">3</span>,<span class="number">8</span>),type = <span class="string">"s"</span>,lty=<span class="number">2</span>)</div><div class="line">&gt; lines(c(<span class="number">6</span>,<span class="number">7</span>),c(<span class="number">3</span>,<span class="number">8</span>),type = <span class="string">"l"</span>,lty=<span class="number">3</span>)</div></pre></td></tr></table></figure></p>
<p><img src="http://onexs3cnv.bkt.clouddn.com/Rplot-type-lty.png" alt="type-lty"><br>当<code>type=&quot;s&quot;</code>是，画的是折线！！！，<code>s</code>解释为step，相当于画的是曼哈顿路径。<br><code>lty</code>才是线是什么样子的形式的。而<code>type</code>应该是画的什么什么形状吧，不知道怎么描述</p>
<h3 id="lty的实验"><a href="#lty的实验" class="headerlink" title="lty的实验"></a>lty的实验</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">plot(c(<span class="number">1</span>,<span class="number">6</span>),c(<span class="number">1</span>,<span class="number">1</span>),type=<span class="string">'l'</span>,lty=<span class="number">1</span>,ylim=c(<span class="number">0</span>,<span class="number">8</span>))</div><div class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">2</span>:<span class="number">6</span>)&#123;</div><div class="line">  lines(c(<span class="number">1</span>,<span class="number">6</span>),c(i,i),type = <span class="string">'l'</span>,lty=i)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://onexs3cnv.bkt.clouddn.com/Rplot-lty.png" alt="lty"></p>
<h1 id="text"><a href="#text" class="headerlink" title="text"></a>text</h1><p>在画布上写文本吧<br>直接看实验<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; plot(c(<span class="number">0</span>,<span class="number">10</span>),c(<span class="number">0</span>,<span class="number">10</span>),type=<span class="string">'n'</span>)</div><div class="line">&gt; text(c(<span class="number">5</span>,<span class="number">1</span>),c(<span class="number">3</span>,<span class="number">3</span>),<span class="number">1</span>)</div><div class="line">&gt; text(c(<span class="number">5</span>,<span class="number">8</span>),c(<span class="number">2</span>,<span class="number">3</span>),c(<span class="string">"A"</span>,<span class="string">"B"</span>))</div></pre></td></tr></table></figure></p>
<p><img src="http://onexs3cnv.bkt.clouddn.com/Rplot-text.png" alt="text"></p>
<h1 id="points"><a href="#points" class="headerlink" title="points"></a>points</h1><p>画点。主要是<code>pch</code>,<code>cex</code>这两个参数有点意思</p>
<blockquote>
<p>pch<br>plotting ‘character’, i.e., symbol to use. This can either be a single character or an integer code for one of a set of graphics symbols. The full set of S symbols is available with pch = 0:18, see the examples below. (NB: R uses circles instead of the octagons used in S.)</p>
<p>Value pch = “.” (equivalently pch = 46) is handled specially. It is a rectangle of side 0.01 inch (scaled by cex). In addition, if cex = 1 (the default), each side is at least one pixel (1/72 inch on the pdf, postscript and xfig devices).</p>
<p>For other text symbols, cex = 1 corresponds to the default fontsize of the device, often specified by an argument pointsize. For pch in 0:25 the default size is about 75% of the character height (see par(“cin”)).</p>
<p>cex<br>character (or symbol) expansion: a numerical vector. This works as a multiple of par(“cex”).</p>
</blockquote>
<p>目前我的理解就是pch就是点的样式，cex就是指定大小</p>
<h2 id="pch-实验"><a href="#pch-实验" class="headerlink" title="pch 实验"></a>pch 实验</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">plot(c(<span class="number">0</span>,<span class="number">10</span>),c(<span class="number">0</span>,<span class="number">10</span>),type=<span class="string">'n'</span>)</div><div class="line">line.draw = <span class="number">9</span></div><div class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">25</span>)&#123;</div><div class="line">	<span class="keyword">if</span>((i-<span class="number">1</span>) %% <span class="number">5</span>==<span class="number">0</span>)&#123;</div><div class="line">		line.draw = line.draw - <span class="number">1</span></div><div class="line">	&#125;</div><div class="line">	points((i-<span class="number">1</span>)%%<span class="number">5</span>,line.draw,pch=i)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://onexs3cnv.bkt.clouddn.com/Rplot-points-pch.png" alt="pch"></p>
<h1 id="回到题目"><a href="#回到题目" class="headerlink" title="回到题目"></a>回到题目</h1><p>画这样的一个三角形。思路就是用<code>points</code>画大一点的圆圈，<code>text</code>来写<code>A</code>这中标签，然后<code>lines</code>来画线，没什么难度<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">plot(c(<span class="number">0</span>,<span class="number">10</span>),c(<span class="number">0</span>,<span class="number">10</span>),type = <span class="string">'n'</span>)</div><div class="line">lines(c(<span class="number">3</span>,<span class="number">5</span>),c(<span class="number">4</span>,<span class="number">9</span>),type = <span class="string">'l'</span>,lty=<span class="number">1</span>)</div><div class="line">lines(c(<span class="number">5</span>,<span class="number">7</span>),c(<span class="number">9</span>,<span class="number">4</span>),type = <span class="string">'l'</span>,lty=<span class="number">1</span>)</div><div class="line">lines(c(<span class="number">3</span>,<span class="number">7</span>),c(<span class="number">4</span>,<span class="number">4</span>),type = <span class="string">'l'</span>,lty=<span class="number">1</span>,xlim=c(<span class="number">2.5</span>,<span class="number">6.7</span>))</div><div class="line">points(<span class="number">5</span>,<span class="number">9</span>,pch=<span class="number">1</span>,cex = <span class="number">5</span>)</div><div class="line">text(<span class="number">5</span>,<span class="number">9</span>,<span class="string">'A'</span>)</div><div class="line">points(<span class="number">3</span>,<span class="number">4</span>,pch=<span class="number">1</span>,cex = <span class="number">5</span>)</div><div class="line">text(<span class="number">3</span>,<span class="number">4</span>,<span class="string">'B'</span>)</div><div class="line">points(<span class="number">7</span>,<span class="number">4</span>,pch=<span class="number">1</span>,cex = <span class="number">5</span>)</div><div class="line">text(<span class="number">7</span>,<span class="number">4</span>,<span class="string">'C'</span>)</div></pre></td></tr></table></figure></p>
<p>不过我这样，太啰嗦了啊</p>
<p>R中的最常用的对象就是向量，很多运算都支持向量操作。可以用向量<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">plot(c(<span class="number">0</span>,<span class="number">10</span>),c(<span class="number">0</span>,<span class="number">10</span>),type = <span class="string">'n'</span>)</div><div class="line">x &lt;- c(<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>)</div><div class="line">y &lt;- c(<span class="number">4</span>,<span class="number">9</span>,<span class="number">4</span>)</div><div class="line">points(x,y,cex=<span class="number">5</span>)</div><div class="line">text(x,y,c(<span class="string">"A"</span>,<span class="string">"B"</span>,<span class="string">"C"</span>))</div><div class="line">lines(x,y,type=<span class="string">'l'</span>)</div></pre></td></tr></table></figure></p>
<p><img src="http://onexs3cnv.bkt.clouddn.com/Rplot-plot-triangle-vector.png" alt="triangle-vector"></p>
<p><code>lines(x,y)</code> , 这个<code>x</code>，<code>y</code>的坐标，相当于这里，两个坐标的<code>x</code>都提取出来到<code>x</code>，两个坐标的<code>y</code>都提取出来到<code>y</code>，相当于起始点终点的<code>x</code>坐标放一起，起始点终点的<code>y</code>坐标放一起.感觉python中的<code>map(None,x,y)</code> 后就是<code>[(3,4),(5,9),(7,4)]</code> 其实就是各点的坐标</p>
<p>但是是不闭合的，为什么，其实两个组合确定一条线，可能<code>lines</code>中的向量，<code>x</code>先是<code>(3,5)</code>,在是<code>(5,7)</code>,<code>y</code>对应，但后面没有回去<code>(7，3)</code>。要手动添加<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lints(c(x,<span class="number">3</span>),c(y,<span class="number">4</span>),type=<span class="string">'l'</span>)</div></pre></td></tr></table></figure></p>
<p>这样就和开篇的fancybox的图片里面一样了。</p>
]]></content>
    
    <summary type="html">
    
      主要是plot, lines, text , points 四个函数的使用
    
    </summary>
    
      <category term="R" scheme="http://www.mmmmmcclxxvii.cn/categories/R/"/>
    
    
      <category term="R-piece" scheme="http://www.mmmmmcclxxvii.cn/tags/R-piece/"/>
    
      <category term="R" scheme="http://www.mmmmmcclxxvii.cn/tags/R/"/>
    
      <category term="plot" scheme="http://www.mmmmmcclxxvii.cn/tags/plot/"/>
    
  </entry>
  
  <entry>
    <title>自我约束-开会</title>
    <link href="http://www.mmmmmcclxxvii.cn/2017/04/06/self-discipline-meeting/"/>
    <id>http://www.mmmmmcclxxvii.cn/2017/04/06/self-discipline-meeting/</id>
    <published>2017-04-06T14:54:22.000Z</published>
    <updated>2017-04-06T15:01:53.000Z</updated>
    
    <content type="html"><![CDATA[<p>如果不能做到以下，那么你就把你的屁股老老实实的坐到那该死的团会上，体验如坐针毡的感觉。</p>
<p>自己真的做的惜时如金的时候，真的做到压榨每一分每一秒的时候，真的做到push self的时候，当感觉到跑在计划前面的时候。</p>
<p><strong>不能不趁三十之前，立志猛进也</strong></p>
<p>野蛮生长</p>
]]></content>
    
    <summary type="html">
    
      所谓自我约束是指在向某些困难发起挑战时，故意给自己戴上一个枷锁，把自己逼到穷途末路， 制定只属于自己的规矩，正因为有了那个枷锁，你才会认真面对挑战，而一旦失败，你就能通过实践那个规矩，让自己得到严格的锻炼，使得自己不断进步，这才叫自我约束。
    
    </summary>
    
      <category term="life" scheme="http://www.mmmmmcclxxvii.cn/categories/life/"/>
    
    
      <category term="life" scheme="http://www.mmmmmcclxxvii.cn/tags/life/"/>
    
      <category term="namaste" scheme="http://www.mmmmmcclxxvii.cn/tags/namaste/"/>
    
  </entry>
  
  <entry>
    <title>Intro to hadoop and MapReduce -- hdfs &amp; mapreduce (二)</title>
    <link href="http://www.mmmmmcclxxvii.cn/2017/04/06/hdfs-mapreduce/"/>
    <id>http://www.mmmmmcclxxvii.cn/2017/04/06/hdfs-mapreduce/</id>
    <published>2017-04-06T08:34:28.000Z</published>
    <updated>2017-04-06T13:29:11.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Quiz：-Is-there-a-problem"><a href="#Quiz：-Is-there-a-problem" class="headerlink" title="Quiz： Is there a problem"></a>Quiz： Is there a problem</h2><ul>
<li>[x] network failure</li>
<li>[x] disk failure on datanode</li>
<li>[] <del>not all datanode used</del> (Why do you think that all nodes have to be used. What if you have hundreds of Data Nodes?)</li>
<li>[] <del>block sizes differ</del> (If block sizes would have to be the same, what would happen if the file could not be divided in same size blocks?)</li>
<li>[x] disk failure on namenode</li>
</ul>
<p>what if namenode had hardware problem</p>
<h2 id="Quiz-any-problems-now"><a href="#Quiz-any-problems-now" class="headerlink" title="Quiz: any problems now"></a>Quiz: any problems now</h2><ul>
<li>[x] data inaccessible  (when network failure)</li>
<li>[x] data lost forever  (when disk failure)</li>
<li>[] no problem</li>
</ul>
<p>so, depends.</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Quiz：-Is-there-a-problem&quot;&gt;&lt;a href=&quot;#Quiz：-Is-there-a-problem&quot; class=&quot;headerlink&quot; title=&quot;Quiz： Is there a problem&quot;&gt;&lt;/a&gt;Quiz： Is there
    
    </summary>
    
      <category term="bigdata" scheme="http://www.mmmmmcclxxvii.cn/categories/bigdata/"/>
    
    
      <category term="hadoop" scheme="http://www.mmmmmcclxxvii.cn/tags/hadoop/"/>
    
      <category term="mapreduce" scheme="http://www.mmmmmcclxxvii.cn/tags/mapreduce/"/>
    
      <category term="udacity" scheme="http://www.mmmmmcclxxvii.cn/tags/udacity/"/>
    
  </entry>
  
  <entry>
    <title>Intro to hadoop and MapReduce -- Big Data(一)</title>
    <link href="http://www.mmmmmcclxxvii.cn/2017/04/04/big-data/"/>
    <id>http://www.mmmmmcclxxvii.cn/2017/04/04/big-data/</id>
    <published>2017-04-04T12:26:09.000Z</published>
    <updated>2017-04-06T13:29:30.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Definition-of-Big-Data"><a href="#Definition-of-Big-Data" class="headerlink" title="Definition of Big Data"></a>Definition of Big Data</h1><p>可能有些人认为几个<code>terebytes</code>的数据量是大数据，但这个量不是标准的，所以一个合理的定义是</p>
<blockquote>
<p>It’s data that’s too big to be processed on a single machine.</p>
</blockquote>
<h2 id="Quiz-Chanllenges-with-Big-Data"><a href="#Quiz-Chanllenges-with-Big-Data" class="headerlink" title="Quiz: Chanllenges with Big Data"></a>Quiz: Chanllenges with Big Data</h2><p><del>- most data is worthless</del></p>
<ul>
<li>data is created fast</li>
<li>data from different sources in various formats</li>
</ul>
<p>most data is not worthless, but actually does have a lot of value.</p>
<h1 id="The-3-V’s-of-big-data"><a href="#The-3-V’s-of-big-data" class="headerlink" title="The 3 V’s of big data"></a>The 3 V’s of big data</h1><h2 id="Volume"><a href="#Volume" class="headerlink" title="Volume"></a>Volume</h2><p>总结：量大。需要考虑那些能提供有用信息</p>
<blockquote>
<p>But in order to store it, you’ll need a way to scale your storage capacity up to massive volume. Hadoop, which stores data in a distributed way across multiple machines, does that</p>
</blockquote>
<h2 id="Variety"><a href="#Variety" class="headerlink" title="Variety"></a>Variety</h2><p>就是说我们如果用像MySQL,Oracle这种数据库，数据必须要适合他们的格式，但是现在我们处理的数据很大部分都是<code>unstructured</code>或者是<code>semi-structured</code>.<br>比方说现在打客服热线不都有一个提示说是会录音，一种存储是语音识别成文字保存起来，另一种是直接存储成mp3格式然后让相应的软件解码如果后面要用的话。那hadoop不管你的数据是什么样的格式，</p>
<blockquote>
<p>you can just store the data in its raw format, and manipulate and reformat it later.</p>
</blockquote>
<h3 id="example"><a href="#example" class="headerlink" title="example"></a>example</h3><blockquote>
<p>Sometimes the most unlikely data can be extremely useful and lead to savings due to better planning. </p>
</blockquote>
<p><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-04-04%20at%209.39.47%20PM.png" alt="optimize choice"></p>
<p>比方说现在要通知附近的货车到中心取货，基于位置的系统就会通知最近的车辆过来。但往往，这个最近，不是最佳的选择。也许那里有交通堵塞，也许最近的车辆过来需要过羊肠小道，那里的路比较难走，也许是要绕一大圈才能到中心。更需要考虑的是，这辆车上也许没有足够的空间了，这辆车没有油了。所以以下都是需要考虑的</p>
<ul>
<li>Current GPS location fromi all trucks</li>
<li>Current itineraries for all trucks</li>
<li>Current traffic speed in related areas as reported by services such as waze</li>
<li>Current load of trucks by volume and weight</li>
<li>Fuel efficiency of the different vehicles</li>
</ul>
<blockquote>
<p>The world we live in is extremely complex, and there are a lot of variables to consider that you can tweak to get large benefits.</p>
<h2 id="Velocity"><a href="#Velocity" class="headerlink" title="Velocity"></a>Velocity</h2><p>实时更新？？<br>If we can’t store it as it arrives, we’ll end up discarding some of it, and that’s what we absolutely want to avoid.</p>
</blockquote>
<h1 id="history-of-hadoop"><a href="#history-of-hadoop" class="headerlink" title="history of hadoop"></a>history of hadoop</h1><p>来自hadoop 之父 Doug Cutting</p>
<blockquote>
<p>So, let me tell you how Hadoop came to be. About ten years ago in around 2003, I was working on an Open Source web search engine called Nutch, and we knew it needed to be something very scalable, because the Web was you know, billions of pages. terabytes, petabytes, of data, that we needed to be able to process, and we set about doing the best job we could and it was tough. We got things up and running on four or five machines, not very well, and around that time Google published some papers about how they were doing things internally. Published a paper about their distributed file system, TFS. and about their processing, framework, MapReduce. So my partner and I, at the time, in this project, Mike Cafarella. said about trying to reimplement these in Open Source. So that more people could use them than just folks at Google. Took us a couple of years, and we had Nutch up and running on, instead of four or five machines, on, 20 to 40 machines. It wasn’t perfect, it wasn’t totally reliable, but it worked. And we realize that to get it to the point where it was scaled to thousands of machines, and be as bullet proof as it needed to be, would take more than just the two of us, working part time.</p>
<p>Around that time, Yahoo approached me and said they were interested in investing in this. So I went to work for Yahoo in January of 2006. First thing I did there, was, we took the parts of Nutch that were a distributed computing platform, and put them into a separate project. A new project christened Hadoop. Over the next couple years, with, Yahoo’s help, and the help of others, we took Hadoop, and really got it to the point where it did scale to petabytes, and running on thousands of processors. And doing so quite reliably. </p>
<p>It spread to lots of companies, and mostly in the Internet sector, and became quite a success. after that, we, we started to see a bunch of other projects grow up around it. And Hadoop’s grown to be the kernel of a, which, pretty much an operating system for big data. We’ve got tools that, allow you to, more easily do, MapReduce programming, so, you can develop using SQL or a data flow language called Pig. And we’ve also got the beginnings of higher­level tools. We’ve got interactive SQL with Impala. We’ve got Search. and so we’re really seeing this develop to being a general purpose platform for data processing. that scale’s much better and that it is much more flexible than anything that’s, that’s, else is out there.</p>
</blockquote>
<h1 id="hadoop-cluster"><a href="#hadoop-cluster" class="headerlink" title="hadoop cluster"></a>hadoop cluster</h1><p><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-04-04%20at%2010.04.35%20PM.png" alt="cluster"><br>hadoop存储数据的方法是一个分布式的文件系统叫做<code>HDFS</code>。处理数据是通过<code>MapReduce</code>。<br>核心思想就是将数据分块，然后在集群中存储，也就是各个计算机搭建的一个网络吧。那这样的好处就是我们不用从中心取数据然后再操作，我们直接在集群中就地处理数据，后续还可以继续扩大集群的规模</p>
<h1 id="hadoop-Ecosystem"><a href="#hadoop-Ecosystem" class="headerlink" title="hadoop Ecosystem"></a>hadoop Ecosystem</h1><p><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-04-04%20at%2010.31.42%20PM.png" alt="ecosystem"></p>
<blockquote>
<p>Core hadoop consists of HDFS and MapReduce<br>hadoop的生态系统。以hadoop为核心的，打造的周边产品，主要的目的就是降低使用hadoop的难度和门槛。<br>比如编写<code>MapReduce</code>的程序不是一件容易的事，有些没有编程经验的就可以用<code>Pig</code>，<code>Hive</code>，这种类似SQL语句来操作数据，但这两个都是将语句翻译为<code>MapReduce</code>然后再到集群上执行。<br>因为<code>Hive</code>和<code>Pig</code>它们本质上还是<code>MapReduce</code>的工作量，所以花费的时间可能更多。所以另一个开源项目<code>Impala</code>，它是允许直接用<code>SQL</code>语句来操作数据，不用经过<code>MapReduce</code>（具体现在我也不懂），所以这样就很快了<br>其他的也就类似了。</p>
</blockquote>
<p>Cloudera hadoop版的其实就是把这些都给你打包好了，你不用在一个一个去弄了。</p>
<p>核心还是hadoop的<code>HDFS</code>和<code>MapReduce</code></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Definition-of-Big-Data&quot;&gt;&lt;a href=&quot;#Definition-of-Big-Data&quot; class=&quot;headerlink&quot; title=&quot;Definition of Big Data&quot;&gt;&lt;/a&gt;Definition of Big Da
    
    </summary>
    
      <category term="bigdata" scheme="http://www.mmmmmcclxxvii.cn/categories/bigdata/"/>
    
    
      <category term="hadoop" scheme="http://www.mmmmmcclxxvii.cn/tags/hadoop/"/>
    
      <category term="mapreduce" scheme="http://www.mmmmmcclxxvii.cn/tags/mapreduce/"/>
    
      <category term="udacity" scheme="http://www.mmmmmcclxxvii.cn/tags/udacity/"/>
    
  </entry>
  
  <entry>
    <title>seven-principle</title>
    <link href="http://www.mmmmmcclxxvii.cn/2017/04/04/seven-principle/"/>
    <id>http://www.mmmmmcclxxvii.cn/2017/04/04/seven-principle/</id>
    <published>2017-04-04T05:58:52.000Z</published>
    <updated>2017-04-06T07:41:12.000Z</updated>
    
    <content type="html"><![CDATA[<ol>
<li><strong>自带鸡血</strong>，能源源不断地给自己充电，遇到打击能迅速恢复，哪怕这种打击沉重而有力，也就是，抗压能力强。<br><img src="http://onexs3cnv.bkt.clouddn.com/balalal" alt="balala"></li>
<li><strong>不能给自己设限</strong>，既没有上限，也没有下限，凡事能想到的事，都敢做，给联合国秘书长写信也没啥不敢的</li>
<li><strong>格局大，顺势而为</strong>.胸怀达到全宇宙，又能找到把猪吹上天的风口，从来站在更大的地位上思考问题，绝不想同事蹭吃了一盒酸奶之类的小时；</li>
<li>对自己高标准，<strong>永不满足</strong>，一旦自己陷入舒适圈，马上调整自己，给自己提更高的要求，让自己不舒适，让自己不高心，让自己不痛快，给自己找别扭，上升到更高的level</li>
<li><strong>做不可替代的角色</strong></li>
<li><strong>极度自律，执行力超强（强调）</strong>。别跟我说自律，其实就是一个人呆着的时候，不放纵自己，做应当做的是，不玩游戏，不看电视剧，<strong>不在低附加值的事情上浪费时间</strong>。同时，你不能想着，我要有时间就好了，然后每天还能睡到中午12点，然后慵懒的发发朋友圈，谈谈诗和远方。</li>
<li>具备<strong>逆向思维</strong>，善于创新，说白了，就不跟大家一样思考，常人怎么想，总是反着想，具备创新精神。剑走偏锋</li>
</ol>
]]></content>
    
    <summary type="html">
    
      七条
    
    </summary>
    
      <category term="life" scheme="http://www.mmmmmcclxxvii.cn/categories/life/"/>
    
    
      <category term="life" scheme="http://www.mmmmmcclxxvii.cn/tags/life/"/>
    
      <category term="principle" scheme="http://www.mmmmmcclxxvii.cn/tags/principle/"/>
    
  </entry>
  
  <entry>
    <title>自我约束-你好</title>
    <link href="http://www.mmmmmcclxxvii.cn/2017/03/30/self-discipline/"/>
    <id>http://www.mmmmmcclxxvii.cn/2017/03/30/self-discipline/</id>
    <published>2017-03-30T08:02:29.000Z</published>
    <updated>2017-04-06T13:30:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>坐公交好几次都碰见她，一位穿着比较啰哩啰嗦的，时尚的。我想认识她</p>
<p>今天，我在看nba勇士队的比赛，她突然过来，没有一丝丝准备，都不知道我发型有没有乱的，问我能不能帮她刷下公交卡，她转支付宝给我，我下意识的说不用，现在老后悔了。</p>
<p>不过，从我过往的经验看，大多是我自己自作多情，人家也只是想寻求帮助，不要想太多了，今天不是你也是其他人。</p>
<p>但还是挺开心的，借此聊了一会，得知是大三外语系的。哈哈哈</p>
<p>这次的自我约束：<br>如果你能静下心来，不要胡思乱想。进入自己的zone, 认认真真做自己的事情，专注！！<br>看缘分，如果能做到专注，那么下次遇见的时候就厚着脸皮要个联系方式吧，不然就永远当个路人</p>
]]></content>
    
    <summary type="html">
    
      所谓自我约束是指在向某些困难发起挑战时，故意给自己戴上一个枷锁，把自己逼到穷途末路， 制定只属于自己的规矩，正因为有了那个枷锁，你才会认真面对挑战，而一旦失败，你就能通过实践那个规矩，让自己得到严格的锻炼，使得自己不断进步，这才叫自我约束。
    
    </summary>
    
      <category term="life" scheme="http://www.mmmmmcclxxvii.cn/categories/life/"/>
    
    
      <category term="life" scheme="http://www.mmmmmcclxxvii.cn/tags/life/"/>
    
      <category term="namaste" scheme="http://www.mmmmmcclxxvii.cn/tags/namaste/"/>
    
  </entry>
  
  <entry>
    <title>python name and values</title>
    <link href="http://www.mmmmmcclxxvii.cn/2017/03/29/python-name-and-values/"/>
    <id>http://www.mmmmmcclxxvii.cn/2017/03/29/python-name-and-values/</id>
    <published>2017-03-29T13:54:00.000Z</published>
    <updated>2017-03-29T14:50:38.000Z</updated>
    
    <content type="html"><![CDATA[<p>阅读 <a href="https://nedbatchelder.com/text/names.html" target="_blank" rel="external">Facts and myths about Python names and values</a> 做的摘记<br>内容不是很深，只是这里面提到了一些需要注意的点。最主要还是<code>name</code>和<code>value</code>的区别<br><a id="more"></a></p>
<h1 id="Fact-Names-have-no-type-values-have-no-scope"><a href="#Fact-Names-have-no-type-values-have-no-scope" class="headerlink" title="Fact: Names have no type, values have no scope."></a>Fact: Names have no type, values have no scope.</h1><blockquote>
<p>Just as names have no type, values have no scope. When we say that a function has a local variable, we mean that the name is scoped to the function: you can’t use the name outside the function, and when the function returns, the name is destroyed. But as we’ve seen, if the name’s value has other references, it will live on beyond the function call. It is a local name, not a local value.</p>
</blockquote>
<p>翻译：</p>
<p>就跟名字没有类型一样，数值是没有作用范围的。当我们说一个函数有局部变量的时候，我们只是说的是名字只在函数作用域中起作用而已，你不能在函数外使用这个名字，当函数返回的时候，这个名字也就摧毁了。但是，如果这个名字指向的数值还有其他引用，它就会继续生存下去，不管这个函数了。局部变量，而不是局部数值。</p>
<h1 id="Fact-Values-can’t-be-deleted-only-names-can"><a href="#Fact-Values-can’t-be-deleted-only-names-can" class="headerlink" title="Fact: Values can’t be deleted, only names can."></a>Fact: Values can’t be deleted, only names can.</h1><blockquote>
<p>Python’s memory management is so central to its behavior, not only do you not have to delete values, but there is no way to delete values. You may have seen the del statement:</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</div><div class="line"><span class="keyword">del</span> nums</div></pre></td></tr></table></figure>
<blockquote>
<p>This does not delete the value nums, it deletes the name nums. The name is removed from its scope, and then the usual reference counting kicks in: if nums’ value had only that one reference, then the value will be reclaimed. But if it had other references, then it will not.</p>
</blockquote>
<h1 id="Fact-Assignment-never-copies-data"><a href="#Fact-Assignment-never-copies-data" class="headerlink" title="Fact: Assignment never copies data."></a>Fact: Assignment never copies data.</h1><blockquote>
<p>Mutable means that the value has methods that can change the value in-place. Immutable means that the value can never change, instead when you think you are changing the value, you are really making new values from old ones.</p>
</blockquote>
<p>比如：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">x = <span class="number">3</span></div><div class="line">y = x</div></pre></td></tr></table></figure></p>
<p><code>x</code>和<code>y</code>只是一起指向了<code>3</code>而已，并没有给<code>y</code>再来一个<code>3</code>。这里<code>x</code>,<code>y</code>是<code>name</code>，<code>3</code>是<code>value</code><br>上面说到的<code>Mutable</code>是什么意思，也就是因为这个赋值不拷贝数据的特性，当<code>y</code>变了的时候，比如<code>y+=1</code>，那<code>x</code>还变不变？这里就要考虑到可变类型和不可变类型了</p>
<p>Immutable values:</p>
<ol>
<li>numbers</li>
<li>strings</li>
<li>tuples </li>
</ol>
<p>Mutable values:</p>
<ol>
<li>lists</li>
<li>dicts</li>
<li>user-defined objects</li>
</ol>
<p>那在上面<code>y+=1</code>之后，其实是给<code>y</code>重新<code>reference</code>到了4</p>
<p>关于mutable的直接截图：</p>
<p><img src="http://onexs3cnv.bkt.clouddn.com/list_mutate_value.png" alt="list_mutate"></p>
<hr>
<h1 id="Fact-Python-passes-function-arguments-by-assigning-to-them"><a href="#Fact-Python-passes-function-arguments-by-assigning-to-them" class="headerlink" title="Fact: Python passes function arguments by assigning to them."></a>Fact: Python passes function arguments by assigning to them.</h1><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">def my_func(x,y)</div><div class="line">	return x+y</div><div class="line">print(my_func(8,9))</div></pre></td></tr></table></figure>
<blockquote>
<p>The names x and y are local to the function, so when the function returns, those names go away. But if the values they refer to are still referenced by other names, the values live on.</p>
</blockquote>
<p><strong>注意</strong>，这里就出现<code>name</code>和<code>value</code>的区别了，可以这样理解，<code>value</code>就是一个实物，<code>name</code>只是这个实物的标签，我可以贴很多标签，而看到这个标签，我就联想到这个实物，实物可以有多个标签，一个标签只能对应一个实物。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">augment_twice</span><span class="params">(a_list,val)</span>:</span></div><div class="line">	a_list.append(val)</div><div class="line">	a_list.append(val)</div><div class="line"></div><div class="line">nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</div><div class="line">augment_twice(nums, <span class="number">4</span>)</div><div class="line">print(nums) <span class="comment">#[1,2,3,4,4]</span></div></pre></td></tr></table></figure>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-03-29%20at%2010.23.49%20PM.png" alt="before"></h2><h2 id="-1"><a href="#-1" class="headerlink" title=""></a><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-03-29%20at%2010.23.55%20PM.png" alt="after"></h2><p>虚线框表示本地<code>name</code>在一个新的<code>frame</code>里面，而参数传递只是一种赋值操作，<code>a_list</code> “指向” <code>nums</code>指向的<code>value</code>,而<code>list</code>类型是可变数据类型，所以任何<code>name</code>对它的改变都是就地的，可以通过<code>id()</code>操作来查看是否改变了地址</p>
<p>另外一个程序</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">augment_twice_bad</span><span class="params">(a_list,val)</span>:</span></div><div class="line">	a_list = a_list + [val,val]</div><div class="line">nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</div><div class="line">augment_twice_bad(nums,<span class="number">4</span>)</div><div class="line">print(nums) <span class="comment">#[1,2,3]</span></div></pre></td></tr></table></figure>
<p>这个跟上面的程序就不同在函数里面一个是用<code>.append()</code>来增加元素，一个则用加法然后赋值，赋值，赋值，重要的事情说三遍，这是个赋值操作，一旦出现赋值，就相当于等式左边的<code>name</code><strong>rebind</strong>出现在等式右边的<code>value</code></p>
<h2 id="-2"><a href="#-2" class="headerlink" title=""></a><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-03-29%20at%2010.35.39%20PM.png" alt="bad_before"></h2><p><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-03-29%20at%2010.35.45%20PM.png" alt="bad_after"></p>
<blockquote>
<p>It’s really important to keep in mind the difference between mutating a value in place, and rebinding a name. augment_twice worked because it mutated the value passed in, so that mutation was available after the function returned. augment_twice_bad used an assignment to rebind a local name, so the changes weren’t visible outside the function.</p>
</blockquote>
<h1 id="其他的-facts-myths都知道了，上面的需要注意一下就可以了。过"><a href="#其他的-facts-myths都知道了，上面的需要注意一下就可以了。过" class="headerlink" title="其他的 facts, myths都知道了，上面的需要注意一下就可以了。过"></a>其他的 facts, myths都知道了，上面的需要注意一下就可以了。过</h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;阅读 &lt;a href=&quot;https://nedbatchelder.com/text/names.html&quot;&gt;Facts and myths about Python names and values&lt;/a&gt; 做的摘记&lt;br&gt;内容不是很深，只是这里面提到了一些需要注意的点。最主要还是&lt;code&gt;name&lt;/code&gt;和&lt;code&gt;value&lt;/code&gt;的区别&lt;br&gt;
    
    </summary>
    
      <category term="python" scheme="http://www.mmmmmcclxxvii.cn/categories/python/"/>
    
    
      <category term="python" scheme="http://www.mmmmmcclxxvii.cn/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>naruto</title>
    <link href="http://www.mmmmmcclxxvii.cn/2017/03/20/naruto/"/>
    <id>http://www.mmmmmcclxxvii.cn/2017/03/20/naruto/</id>
    <published>2017-03-20T07:44:12.000Z</published>
    <updated>2017-04-06T14:16:14.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="迈特凯语录"><a href="#迈特凯语录" class="headerlink" title="迈特凯语录"></a>迈特凯语录</h1><blockquote>
<p>唯有努力，我不想输给他</p>
<p>真正的胜利，不是击败强者，而是保护对你而言最重要的东西。</p>
<p>不相信自己的人，连努力的价值都没有。</p>
<p>真正重要的东西，不管痛苦也好、悲伤也好…都要努力到底，就算失去生命也要用双手来保护到底!如此一来，就算死掉的话，也会永远留下男子汉活过的证据…</p>
<p>努力是绝不会背叛人的</p>
<p>你只要相信自己所走的路，大步向前走就好，然后就那样成为一个能让别人带着笑容守望着的人吧。</p>
<p>天资聪颖的人并非幸福，能够为自己所信任之人去努力拼搏的人才是幸福的！</p>
<p>当新叶萌发，新春到来之时，才是青春的最高潮燃烧得最火热的时刻！</p>
<p>既然我已经摆出帅哥的姿势来耍帅了,就必须要彻底地遵守约定! </p>
<p>小李,你要休息了吗? </p>
<p>青春的勋章离不开『热血』</p>
<p>我相信木叶的莲花一定会再次定放!!</p>
<p>青春的操场500圈!!</p>
<p>这就是青春!!!</p>
<p>李洛克：在一个有觉悟的男人面前，任何哀愁和悲伤都是对他的侮辱</p>
</blockquote>
<p>在凯开八门遁甲，这个差点一脚踢出大结局的男人，令卡卡西尊敬不已，我反复看了好几遍。<br>凯这个集逗逼与热血气质于一身的男人。</p>
<h1 id="迈特凯父亲，迈特戴的语录"><a href="#迈特凯父亲，迈特戴的语录" class="headerlink" title="迈特凯父亲，迈特戴的语录"></a>迈特凯父亲，迈特戴的语录</h1><blockquote>
<p>不要和你的努力说对不起，那样会多对不起你的努力啊！</p>
<p>祝贺你从忍者 学校毕业，但青春可不能就此毕业啊。搜索<br>青春什么时候结束？<br>青春不会退缩，所以永远不会结束。那爸爸死的时候也不结束吗？<br>那才是青春的最高潮！</p>
<p> 迈特戴：不过你的努力也不算错，就算只跑完一半，你也确实努力了。<br> 迈特戴：你的忍术和体术不行，这才叫爸爸高兴，知道自己的短处，才能让长处发光，<br> 迈特戴：爸爸很高兴，能让儿子在这么小的时候就发现长处，<br> 迈特凯：爸爸，其实你在逞强吧，<br> 迈特戴：短处也能变成长处，唠叨代表周到，啰嗦说明热门，顽固意味着专注，</p>
<p>迈特戴：所谓自我约束是指在向某些困难发起挑战时，故意给自己戴上一个枷锁，把自己逼到穷途末路， 制定只属于自己的规矩，正因为有了那个枷锁，你才会认真面对挑战，而一旦失败，你就能通过实践那个规矩，让自己得到严格的锻炼，使得自己不断进步，这才叫自我约束。</p>
</blockquote>
<p>迈特戴为迈特凯的父亲，他影响了迈特凯的一生，而迈特凯也将这种影响传给了自己的徒弟李洛克</p>
<p>青春，热血！！！</p>
<p>迈特戴经常在别人嘲笑他的时候，对别人说，谢谢支持。</p>
<p><img src="http://onexs3cnv.bkt.clouddn.com/self1.jpg" alt="self1"><br><img src="http://onexs3cnv.bkt.clouddn.com/self2.jpg" alt="self2"></p>
]]></content>
    
    <summary type="html">
    
      想成为像鸣人那样能感染身边人的人；迈特凯和李的青春！！！
    
    </summary>
    
      <category term="life" scheme="http://www.mmmmmcclxxvii.cn/categories/life/"/>
    
    
      <category term="life" scheme="http://www.mmmmmcclxxvii.cn/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>project of stackoverflow - python object(一)</title>
    <link href="http://www.mmmmmcclxxvii.cn/2017/03/14/object/"/>
    <id>http://www.mmmmmcclxxvii.cn/2017/03/14/object/</id>
    <published>2017-03-14T14:27:10.000Z</published>
    <updated>2017-03-27T15:00:07.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="what-does-‘super’-do-in-python"><a href="#what-does-‘super’-do-in-python" class="headerlink" title="what does ‘super’ do in python"></a><a href="http://stackoverflow.com/questions/222877/what-does-super-do-in-python" target="_blank" rel="external">what does ‘super’ do in python</a></h1><p>下面两个的区别是？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span><span class="params">(SomeBaseClass)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">		super(Child, self).__init__()</div></pre></td></tr></table></figure>
<p>和<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span><span class="params">(SomeBaseClass)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">		SomeBaseClass.__init__(self)</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>我在单个继承中已经看到<code>super</code> 被用的很多了。我能知道为什么要在多重继承的时候用它，但是还是不清楚在这种情况用它的好处。</p>
<hr>
<p>180票的回答：（John Millikin)</p>
<p>在单一继承用<code>super</code>的好处很小–只是你不再需要硬编码基类名字到方法里面去了</p>
<p>然后，在多重继承里，不用<code>super()</code>几乎是不可能的。这包括常见的习语，像是mixins，interface,abstract classes等，<br>这能让你的代码在之后延伸。如果以后有人想写一个拓展<code>Child</code> 和 mixin的类，他们的代码不会很好的工作。</p>
<hr>
<p>75票的回答：</p>
<p><strong>区别是什么？</strong></p>
<p><code>SomeBaseClass.__init__(self)</code>意思是调用<code>SomeBaseClass</code>的<code>__init__</code>方法<br>然后，<code>super(Child,self).__init__()</code>意思是从<code>Child</code>类的MRO的父类中调用一个绑定方法<code>__init__</code><br>如果实例是Child的子类，有可能在方法解释顺序中的下一个父类是不一样的？？？</p>
<p><strong>向前兼容间接 ？？ （Indirection with Forward Compatibility) </strong></p>
<p>这能给你什么？对于单重继承，问题中给出的例子几乎等同于静态分析。然而使用<code>super</code> 提供了具有向前兼容性的间接层<br>向前兼容对于经验丰富的开发者来说是很重要的。你希望你的代码在做出一些细微的改动之后还能工作。当您查看修订历史记录时，您希望准确地查看何时更改了哪些内容。</p>
<p>你可能先从单重继承开始，但是当你增加另外的基类，你只需要改变基类的顺序（change the line with the bases）<br>（if the bases change in a class you inherit from）如果类继承关系变了（比如增加了一个mixin)，其实你就没做什么改变。<br>尤其在python2中，要想给super正确的方法参数是很难的。如果你知道你在单重继承下正确的使用<code>super</code>，这样是的调试就容易一点了</p>
<p><strong>依赖注入 Dependency Injection </strong></p>
<p>其他人可以使用你的代码然后插入一些父类到方法解释中(method resolution):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeBaseClass</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">		print(<span class="string">'SomeBaseClass.__init__(self) called'</span>)</div><div class="line">			</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnsuperChild</span><span class="params">(SomeBaseClass)</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">		print(<span class="string">'UnsuperChild.__init__(self) called'</span>)</div><div class="line">		SomeBaseClass.__init__(self)</div><div class="line">							</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SuperChild</span><span class="params">(SomeBaseClass)</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">		print(<span class="string">'SuperChild.__init__(self) called'</span>)</div><div class="line">		super(SuperChild, self).__init__()</div></pre></td></tr></table></figure>
<p>现在你增加其他类，然后在Foo和Bar之间插入一个类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">InjectMe</span><span class="params">(SomeBaseClass)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">		print(<span class="string">'InjectMe.__init__(self) called'</span>)</div><div class="line">		super(InjectMe, self).__init__()</div><div class="line">				</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnsuperInjector</span><span class="params">(UnsuperChild, InjectMe)</span>:</span> <span class="keyword">pass</span></div><div class="line">					</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SuperInjector</span><span class="params">(SuperChild, InjectMe)</span>:</span> <span class="keyword">pass</span></div></pre></td></tr></table></figure>
<p>使用un-super子类未能注入依赖，因为你是用的子类在自己执行打印后调用的是硬编码方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>o = UnsuperInjector()</div><div class="line">UnsuperChild.__init__(self) called</div><div class="line">SomeBaseClass.__init__(self) called</div></pre></td></tr></table></figure>
<p>然而使用<code>super</code>的子类能正确的依赖注入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>o2 = SuperInjector()</div><div class="line">SuperChild.__init__(self) called</div><div class="line">InjectMe.__init__(self) called</div><div class="line">SomeBaseClass.__init__(self) called</div></pre></td></tr></table></figure>
<p>(我：因为super按照MRO来寻找next类的，不是就是去找父类SomeBaseClass,<br>因为SuperInjector的MRO是自身&gt; UnsuperChild &gt; InjectMe &gt; SomeBaseClass &gt; object</p>
<p>还有就是 super 不是在SuperChild内么，为什么要按SuperInjector的MRO来？？<br>这里应该是因为SuperInjector的init没有定义，然后是用的supserchild的，但是还是按照自身的MRO来。<br>怎么做实验</p>
<p>)</p>
<p><strong>结论</strong><br>一直使用<code>super</code>来引用父类就好了</p>
<p>你想要引用的父类是MRO下一个类，而不是你看到的继承的关系</p>
<p>不使用<code>super</code> 回让你代码的使用者多了很多不必要的限制</p>
<hr>
<h1 id="我的："><a href="#我的：" class="headerlink" title="我的："></a>我的：</h1><p>一个例子就是<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> collections imoprt Counter, OrderedDict</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderedCounter</span><span class="params">(Counter, OrderedDict)</span>:</span></div><div class="line">	<span class="keyword">pass</span></div><div class="line"></div><div class="line">oc = OrderedCounter(<span class="string">"abracadabra"</span>)</div></pre></td></tr></table></figure></p>
<p>之前还一直奇怪这个为什么类里面pass，什么都不用写就能结合，现在知道是因为有super<br>相当于我先把参数传递到Counter初始化，然后因为有super找到的是下一个MRO，然后到OrderedDict初始化<br>相当于两个工序，先count再order。</p>
<hr>
<h1 id="How-does-Python’s-super-actually-work-in-the-general-case"><a href="#How-does-Python’s-super-actually-work-in-the-general-case" class="headerlink" title="How does Python’s super() actually work, in the general case?"></a><a href="http://stackoverflow.com/questions/33290894/how-does-pythons-super-actually-work-in-the-general-case/33291315?noredirect=1#comment72867412_33291315" target="_blank" rel="external">How does Python’s super() actually work, in the general case?</a></h1><p>现在有很多有关<code>super()</code>的资源，包括<a href="https://rhettinger.wordpress.com/2011/05/26/super-considered-super/" target="_blank" rel="external">这个</a>博客写的，还有很多stackoverflow上的问题。但是我感觉它们都没有解释它在普遍情况下是怎么工作的，也就是底层的实现。</p>
<p>考虑下面的这个继承层次：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(self)</span>:</span></div><div class="line">		<span class="keyword">print</span> <span class="string">'A foo'</span></div><div class="line">			</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(self)</span>:</span></div><div class="line">		<span class="keyword">print</span> <span class="string">'B foo before'</span></div><div class="line">		super(B, self).foo()</div><div class="line">		<span class="keyword">print</span> <span class="string">'B foo after'</span></div><div class="line">										</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(A)</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(self)</span>:</span></div><div class="line">		<span class="keyword">print</span> <span class="string">'C foo before'</span></div><div class="line">		super(C, self).foo()</div><div class="line">		<span class="keyword">print</span> <span class="string">'C foo after'</span></div><div class="line">																	</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span><span class="params">(B, C)</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(self)</span>:</span></div><div class="line">		<span class="keyword">print</span> <span class="string">'D foo before'</span></div><div class="line">		super(D, self).foo()</div><div class="line">		<span class="keyword">print</span> <span class="string">'D foo after'</span></div></pre></td></tr></table></figure>
<p>如果你读过python的方法解释顺序的规则，你就知道上面的MRO是（D,B,C,A,object)。 这是被D.<strong>mro</strong>决定的<br><code>(&lt;class &#39;__main__.D&#39;&gt;, &lt;class &#39;__main__.B&#39;&gt;, &lt;class &#39;__main__.C&#39;&gt;, &lt;class &#39;__main__.A&#39;&gt;, &lt;type &#39;object&#39;&gt;))</code></p>
<p>和<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">d = D()</div><div class="line">d.foo()</div></pre></td></tr></table></figure></p>
<p>打印出的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">D foo before</div><div class="line">B foo before</div><div class="line">C foo before</div><div class="line">A foo</div><div class="line">C foo after</div><div class="line">B foo after</div><div class="line">D foo after</div></pre></td></tr></table></figure>
<p>结果符合MRO。 但是，考虑上面的B中的<code>super(B,self).foo()</code> 实际调用的是<code>C.foo</code>，这个是在<code>b=B()</code>中；<code>b.foo()</code> 会直接到<code>A.foo</code> 很显然使用<code>super(B,self).foo()</code>不是<code>A.foo(self)</code>的快捷键，虽然有时是</p>
<p>很显然<code>super()</code>是有意识的在意之前的调用，然后尝试着去跟随总的MRO链。我觉得有两个方法能完成这个。<br>第一个是做了一些类似在链中将<code>super</code>对象传递给下一个方法的<code>self</code>参数,像原来<code>self</code>对象那样，但是包含了这个信息，但是这样似乎会破坏很多东西(<code>super(D,d) is d</code>是False)，然后做了一些实验，我觉得这个方法不可行。</p>
<p>另外一个方法是类似全局变量来保存MRO和现在的链上的位置。我想象中的<code>super</code>算法是这样的：</p>
<ol>
<li>我们当前有工作的环境吗？如果没有，创建一个队列，获取MRO，将除了第一个之外的所有元素入队列</li>
<li>将当前上下文的MRO队列中pop一个元素，在构建<code>super</code>实例的时候将它作为当前的class</li>
<li>当访问<code>super</code>实例的一个方法的时候，在当前class上寻找，然后调用它</li>
</ol>
<p>但是，这样却没有解释类似使用不一样的基类当作第一个参数来调用<code>super</code>，或者调用不同方法。（这段好别扭）<br>我想知道这个的更普遍的算法。而且，如果这样的context存在的话，我能看吗？我能破坏他么？这当然是一个糟糕的想法，但是python希望你成为一个成熟的人尽管你不是。</p>
<p>这同样也引入了好多设计的考量。如果我写的B只考虑了它和A的联系，然后又有其他人写了C，还有其他人写了D，我的<code>B.foo()</code>方法必须找到一个能兼容<code>C.foo()</code>的方法来调用<code>super</code>，尽管我在写它的时候C不存在。如果我想要我的类能很简单的扩展，那我必须要考虑这些。但是我不清楚这是不是比简单的将所有的<code>foo</code>的特征设置成一样来的更复杂。还有一个问题就是什么时候将代码放在<code>super</code>之前，什么时候之后，即使在仅考虑B的基类的时候它没有什么区别</p>
<hr>
<p>7票的回答：</p>
<blockquote>
<p>super() is then obviously aware of the previous calls before it</p>
</blockquote>
<p>它不是。当你做<code>super(B,self).foo</code>,<code>super</code>知道你的MRO因为它会从<code>type(self).__mro__</code>中得到。然后它知道应该在MRO的B后面那里开始寻找<code>foo</code>，一个粗略的纯 python写的应该是这样的：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">super</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, klass, obj)</span>:</span></div><div class="line">		self.klass = klass</div><div class="line">		self.obj = obj</div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, attrname)</span>:</span></div><div class="line">		classes = iter(type(self.obj).__mro__)</div><div class="line"></div><div class="line">		<span class="comment"># search the MRO to find self.klass</span></div><div class="line">		<span class="keyword">for</span> klass <span class="keyword">in</span> classes:</div><div class="line">			<span class="keyword">if</span> klass <span class="keyword">is</span> self.klass:</div><div class="line">				<span class="keyword">break</span></div><div class="line"></div><div class="line">		<span class="comment"># start searching for attrname at the next class after self.klass</span></div><div class="line">		<span class="keyword">for</span> klass <span class="keyword">in</span> classes:</div><div class="line">			<span class="keyword">if</span> attrname <span class="keyword">in</span> klass.__dict__:</div><div class="line">				attr = klass.__dict__[attrname]</div><div class="line">				<span class="keyword">break</span></div><div class="line">		<span class="keyword">else</span>:</div><div class="line">			<span class="keyword">raise</span> AttributeError</div><div class="line"></div><div class="line">		<span class="comment"># handle methods and other descriptors</span></div><div class="line">		<span class="keyword">try</span>:</div><div class="line">			<span class="keyword">return</span> attr.__get__(self.obj, type(self.obj))</div><div class="line">		<span class="keyword">except</span> AttributeError:</div><div class="line">			<span class="keyword">return</span> attr</div></pre></td></tr></table></figure></p>
<blockquote>
<p>If I wrote B thinking only of its relation to A, then later someone else writes C and a third person writes D, my B.foo() method has to call super in a way that is compatible with C.foo() even though it didn’t exist at the time I wrote it!</p>
</blockquote>
<p>并不要求你要从随机的类中多种继承。除非<code>foo</code>是被特意设计成在多重继承的时候将兄弟类的重写。D不应该存在。</p>
]]></content>
    
    <summary type="html">
    
      搬运stackoverflow有关python的问题 之 object部分 （一）
    
    </summary>
    
      <category term="stackoverflow" scheme="http://www.mmmmmcclxxvii.cn/categories/stackoverflow/"/>
    
    
      <category term="python" scheme="http://www.mmmmmcclxxvii.cn/tags/python/"/>
    
      <category term="object" scheme="http://www.mmmmmcclxxvii.cn/tags/object/"/>
    
      <category term="stackoverflow" scheme="http://www.mmmmmcclxxvii.cn/tags/stackoverflow/"/>
    
  </entry>
  
  <entry>
    <title>understanding MRO</title>
    <link href="http://www.mmmmmcclxxvii.cn/2017/03/13/mro/"/>
    <id>http://www.mmmmmcclxxvii.cn/2017/03/13/mro/</id>
    <published>2017-03-13T09:28:31.000Z</published>
    <updated>2017-03-30T13:05:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>其实我一直觉得遇到什么障碍再去学什么是效率比较高的，这时候是带着问题去解决问题，比起干看，没有与实际相结合，要有用多了。所以等你真正遇到这个问题了，再来看看。<strong> 这个<code>MRO</code>是理解<code>super</code>方法的前序 </strong>,以下考虑的都是多重继承，单重继承讨论这个就没什么价值了。</p>
<h1 id="Method-Resolution-Order"><a href="#Method-Resolution-Order" class="headerlink" title="Method Resolution Order"></a>Method Resolution Order</h1><blockquote>
<p>In computing, the C3 superclass linearization is an algorithm used primarily to obtain the order in which methods should be inherited (the “linearization”) in the presence of multiple inheritance, and is often termed Method Resolution Order (MRO)<br>from wikipedia – <a href="https://en.wikipedia.org/wiki/C3_linearization" target="_blank" rel="external">C3 linearization</a></p>
</blockquote>
<p>这里引进这个概念。因为在继承中，会有子类继承父类当中的一些元素或方法，但是在多重继承中，到底是哪一个呢？这里就涉及到了<code>MRO</code>，方法解释顺序。可以想像一个列表，里面是继承关系的顺序，当调用子类的方法，或访问子类的元素的时候，就按照这个顺序依次的查找。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line">	<span class="keyword">pass</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(object)</span>:</span></div><div class="line">	<span class="keyword">pass</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(B)</span>:</span></div><div class="line">	<span class="keyword">pass</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span><span class="params">(A,B,C)</span>:</span></div><div class="line">	<span class="keyword">pass</span></div></pre></td></tr></table></figure>
<p>你可以试一下，这个<code>D</code>类是定义不了的，会报错<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">TypeError: Error when calling the metaclass bases</div><div class="line">  Cannot create a consistent method resolution</div><div class="line">order (MRO) <span class="keyword">for</span> bases object, B, C</div></pre></td></tr></table></figure></p>
<p>这里是因为破坏了<code>MRO</code>的一个(<code>monotomic</code>)单调性规定：</p>
<blockquote>
<p>if C1 precedes C2 in the linearization of C, then C1 precedes C2 in the linearization of any subclass of C.</p>
</blockquote>
<p>通过C3算法得出的<code>MRO</code>就可以满足上面的这个要求</p>
<h1 id="C3-linearization"><a href="#C3-linearization" class="headerlink" title="C3 linearization"></a>C3 linearization</h1><p>先定义几个符号表示：<br><code>C1C2....CN</code> 表示一个[C1,C2,C3….CN]的解决顺序列表，在这样的一个列表中，<code>head</code>是<code>C1</code>，<strong>其余的</strong>都叫做<code>tail</code>。<br>注意：是从C2到最后都算tail.<br><code>C+(C1C2...CN) = CC1C2...CN</code> 表示<code>[C] + [C1,C2...CN]</code><br><code>L[C]</code>表示<code>linearization of class C</code>，规定<code>L[O] = O</code>,<code>O</code>表示<code>object</code></p>
<p>算法可以描述为一个递归的过程：</p>
<blockquote>
<p>the linearization of C is the Sum of C plus the merge of the linearizations of the parents and the list of the parents.<br><code>L[C(B1B2...BN)] = C + merge(L[B1],...L[BN],B1...BN)</code><br>顺序很重要，一一对应的。</p>
</blockquote>
<p>merge 算法描述为(原文)：</p>
<blockquote>
<p>take the head of the first list, i.e L[B1][0]; if this head is not in the tail of any of the other lists, then add it to the linearization of C and remove it from the lists in the merge, otherwise look at the head of the next list and take it. if it is a good head, then report the operation until all the class are removed or it is impossible to find good heads. If fail, python will refuse to create the class C and will raise an exception.</p>
</blockquote>
<h2 id="没看懂直接看例子。"><a href="#没看懂直接看例子。" class="headerlink" title="没看懂直接看例子。"></a>没看懂直接看例子。</h2><p><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-03-30%20at%207.18.59%20PM.png" alt="example-class-inherit"></p>
<p>写出各个的<code>linearization</code>（这个翻译成啥我也不知道）<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">L[O] = O</div><div class="line">L[E] = EO</div><div class="line">L[D] = DO</div><div class="line">L[F] = FO</div><div class="line">L[B] = B + merge(L[D],L[E],DE)</div><div class="line">     = B + merge(DO,EO,DE)</div></pre></td></tr></table></figure></p>
<p>这里是要<code>merge</code>3个<code>list</code>，<code>DO</code>,<code>EO</code>,<code>DE</code>，从第一个<code>DO</code>开始，它的<code>head</code>是<code>D</code>，然后看<code>D</code>是否出现在其他<code>list</code>的<code>tail</code>中中，注意<code>tail</code>是指除了<code>head</code>其余的所有。比如有一个<code>list</code>是<code>ADCBEF</code>,那<code>D</code>出现在第2个位置也算是在<code>tail</code>中，而不是在最后一个位置才算是<code>tail</code>。也就是说只有<code>D</code>出现在其他<code>list</code>首位置的时候，或者就根本没有<code>D</code>，这个<code>D</code>算是一个<code>good head</code>，然后将<code>D</code>加入<code>B</code>的linearization中，如果<code>D</code>不满足上面的条件，那么顺推到下一个<code>list</code> <code>EO</code>中的<code>E</code>，如果再不满足，继续顺推，都不满足的话就<code>raise an exception</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">L[B] = B + merge(L[D],L[E],DE)</div><div class="line">     = B + merge(DO,EO,DE)</div><div class="line">	 = B + D + merge(O,EO,E) <span class="comment">#再从第一个list O 开始去第一个元素O，但O不满足，出现在了第二个EO的tail中，顺延</span></div><div class="line">	 = B + D + E + merge(O,O)</div><div class="line">	 = B + D + E + O</div><div class="line">	 = BDEO</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">L[C] = C + merge(DO,FO,DF)</div><div class="line">	 = C + D + merge(O,FO,F)</div><div class="line">	 = C + D + F + merge(O,O)</div><div class="line">	 = CDFO</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">L[A] = A + merge(L[B],L[C],BC)</div><div class="line">	 = A + merge(BDEO,CDFO,BC)</div><div class="line">	 = A + B + merge(DEO,CDFO,C)</div><div class="line">	 = A + B + C + merge(DEO,DFO)</div><div class="line">	 = A + B + C + D + merge(EO,FO)</div><div class="line">	 = A + B + C + D + E + merge(O,FO)</div><div class="line">	 = A + B + C + D + E + F + merge(O,O)</div><div class="line">	 = A + B + C + D + E + F + O</div><div class="line">	 = ABCDEFO</div></pre></td></tr></table></figure>
<hr>
<h2 id="另一个例子–-不能生成mro"><a href="#另一个例子–-不能生成mro" class="headerlink" title="另一个例子– 不能生成mro"></a>另一个例子– 不能生成mro</h2><p><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-03-30%20at%207.39.09%20PM.png" alt="bad-example"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">L[O] = O</div><div class="line">L[X] = XO</div><div class="line">L[Y] = YO</div><div class="line">L[A] = AXYO </div><div class="line">L[B] = BYXO <span class="comment">#这两个其实也应该通过上面那个merge算法算出来的，只不过这里一眼就能看出来</span></div></pre></td></tr></table></figure>
<p>关键看类C<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">L[C] = C + merge(AXYO,BYXO,AB)</div><div class="line">	 = C + A + merge(XYO,BYXO,B)</div><div class="line">	 = C + A + B + merge(XYO,YXO)</div></pre></td></tr></table></figure></p>
<p>到了这里就做不下去了，这里<code>XYO</code>,<code>YXO</code>，不管第一个<code>X</code>还是第二个的<code>Y</code>，都不行！！</p>
<blockquote>
<p>X is in the tail of YXO whereas Y is in the tail of XYO<br>因此算法结束.<code>raise an error refuese to create class C</code></p>
</blockquote>
<h1 id="快速判别能否生成MRO的方法"><a href="#快速判别能否生成MRO的方法" class="headerlink" title="快速判别能否生成MRO的方法"></a>快速判别能否生成MRO的方法</h1><p>以下来自 <a href="http://www.cafepy.com/article/python_attributes_and_methods/python_attributes_and_methods.html" target="_blank" rel="external">python Attributes and Methods</a><br><img src="http://www.cafepy.com/article/python_attributes_and_methods/images/simple_hierarchy.png" alt="simple hierarchy"><br>现在要定义一个新的类<code>class N(A,B,C)</code><br><img src="http://www.cafepy.com/article/python_attributes_and_methods/images/beads_on_strings.png" alt="game abacus style beads"><br>画的稍微歪了，第一排全是<code>O</code>，那ok，<code>result</code>中也生成<code>O</code>放在顶部，第二排，<code>BBC</code>，不一样，要全部一样才能放在最后的<code>result</code>中，所以这个是失败的。</p>
<p>如果将类<code>N</code>的定义改为<code>class N(A,C,B)</code><br><img src="http://www.cafepy.com/article/python_attributes_and_methods/images/beads_on_strings_solved.png" alt="solved-beads on strings"></p>
<hr>
<p>以上深入了解以下这个机制就可以，在编程的时候可以调用<code>__mro__</code>属性来查看一个类的<code>mro</code>，了解这个更有助于你理解你写的程序，比如<code>super</code>，比如描述符当中也会用到这个概念</p>
<hr>
<p>出处：</p>
<ol>
<li><a href="https://www.python.org/download/releases/2.3/mro/" target="_blank" rel="external">The Python 2.3 Method Resolution Order</a></li>
<li><a href="http://www.cafepy.com/article/python_attributes_and_methods/python_attributes_and_methods.html" target="_blank" rel="external">python Attributes and Methods</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;其实我一直觉得遇到什么障碍再去学什么是效率比较高的，这时候是带着问题去解决问题，比起干看，没有与实际相结合，要有用多了。所以等你真正遇到这个问题了，再来看看。&lt;strong&gt; 这个&lt;code&gt;MRO&lt;/code&gt;是理解&lt;code&gt;super&lt;/code&gt;方法的前序 &lt;/st
    
    </summary>
    
      <category term="python" scheme="http://www.mmmmmcclxxvii.cn/categories/python/"/>
    
    
      <category term="python" scheme="http://www.mmmmmcclxxvii.cn/tags/python/"/>
    
      <category term="mro" scheme="http://www.mmmmmcclxxvii.cn/tags/mro/"/>
    
      <category term="python-object" scheme="http://www.mmmmmcclxxvii.cn/tags/python-object/"/>
    
  </entry>
  
  <entry>
    <title>python中的对象属性查找</title>
    <link href="http://www.mmmmmcclxxvii.cn/2017/03/08/object-attribute-look-up/"/>
    <id>http://www.mmmmmcclxxvii.cn/2017/03/08/object-attribute-look-up/</id>
    <published>2017-03-08T14:06:02.000Z</published>
    <updated>2017-04-02T02:03:08.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://www.betterprogramming.com/object-attribute-lookup-in-python.html" target="_blank" rel="external">原文链接</a></p>
<p>这里面已经讲的很详细了。暂时还没有自己的深刻的思考和理解，就先搬运过来。</p>
<h1 id="Instance-attribute-look-up-实例属性查找"><a href="#Instance-attribute-look-up-实例属性查找" class="headerlink" title="Instance attribute look up 实例属性查找"></a>Instance attribute look up 实例属性查找</h1><blockquote>
<p>The implementation works through a precedence chain that gives data descriptors priority over instance variables, instance variables priority over non-data descriptors, and assigns lowest priority to getattr() if provided.</p>
</blockquote>
<p>现在有一个类<code>C</code>和一个实例<code>c = C()</code>，现在调用<code>c.name</code>，相当于在实例<code>c</code>中查找<code>name</code>属性，流程如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">Get the Class from Instance</div><div class="line">Call the Class&apos;s special method __getattribute__.All objects have a default __getattribute__</div><div class="line">	Get the Class&apos;s __mro__ as ClassParents</div><div class="line">	For each ClassParent in ClassParents</div><div class="line">		if the Attribute is in the ClassParent&apos;s __dict__</div><div class="line">			if this attribute is data descriptor</div><div class="line">				return the result from calling the data descriptor&apos;s special method __get__()</div><div class="line">				Breaking the for each(do not continue searching the same Attribute any further)</div><div class="line">	</div><div class="line">	If the Attribute is in Instance&apos;s __dict__</div><div class="line">		return the value as it is(even if the value is a data descriptor)</div><div class="line">		#这个意思是即使是描述符也直接返回这个对象，不会去调用__get__(),返回值类似&lt;__main__ descriptor object at Ox..&gt;</div><div class="line">	For each ClassParent in ClassParents</div><div class="line">		if the Attribute is in the ClassParent&apos;s __dict__</div><div class="line">			if is a non-data descriptor</div><div class="line">				return the result from calling the non-data descriptor&apos;s special method __get__()</div><div class="line">			if it is Not a descriptor</div><div class="line">				return the value</div><div class="line">	</div><div class="line">	If Class has the special method __getattr__</div><div class="line">		return the result from calling the Class&apos;s special method __getattr__</div><div class="line">	</div><div class="line">	Raise an AttributeError</div></pre></td></tr></table></figure></p>
<p>有几个点要记住！</p>
<ol>
<li>descriptors are invoked by the <code>getattribute()</code> method</li>
<li>overriding <code>getattribute()</code> prevents automatic descriptor calls</li>
<li><code>getattribute()</code> is only available with new style classes and objects</li>
<li><code>object.getattribute()</code> and <code>type.getattribute()</code> make different calls to <code>get()</code></li>
<li>data descriptors always override instance dictionaries.</li>
<li>non-data descriptors may be overridden by instance dictionaries.</li>
</ol>
<h1 id="Class-attribute-look-up-类属性的查找"><a href="#Class-attribute-look-up-类属性的查找" class="headerlink" title="Class attribute look up 类属性的查找"></a>Class attribute look up 类属性的查找</h1><p>一个<code>metaclass</code> <code>M</code>，和一个<code>M</code>的实例，类<code>C</code>，这时候调用<code>C.name</code>的流程：<br>其实和实例访问一一对应，就是各自都升了一个level<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">Get the MetaClass from Class</div><div class="line">Call the Metaclass&apos;s special method __getattribute__</div><div class="line">	Get the Metaclass&apos;s __mro__ as MetaParents</div><div class="line">	For each MetaParent in MetaParents</div><div class="line">		if the Attribute is in the MetaParent&apos;s __dict__</div><div class="line">			if is a data descriptor</div><div class="line">				return the result from calling the data descriptor&apos;s special method __get__()</div><div class="line">	</div><div class="line">	Get the Class&apos;s __mro__ as ClassParents</div><div class="line">	For each ClassParent in ClassParents</div><div class="line">		if the Attribute is in the ClassParents&apos;s __dict__</div><div class="line">			if is a(data or non-data) descriptor</div><div class="line">				return the result from calling the descriptor&apos;s special method __get__()</div><div class="line">				# 实例在这层上不会调用__get__()</div><div class="line">			else</div><div class="line">				return the value</div><div class="line">	</div><div class="line">	For each MetaParent in MetaParents</div><div class="line">		if the Attribute is in the MetaParents&apos;s __dict__</div><div class="line">			if is a non-data descriptor</div><div class="line">				return the result from calling the non-data descriptor&apos;s special method __get__()</div><div class="line">			if it is NOT a descriptor</div><div class="line">				return the value</div><div class="line">	</div><div class="line">	If MetaClass has the special method __getattr__</div><div class="line">		return the result from calling the MetaClass&apos;s special method __getattr__</div><div class="line">	</div><div class="line">	Raises an AttributeError</div></pre></td></tr></table></figure></p>
<h1 id="例子"><a href="#例子" class="headerlink" title="例子"></a><a href="https://gist.github.com/Crayon277/cd05d4c058a5e11c7bd202aa44fff876" target="_blank" rel="external">例子</a></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># coding=utf-8</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Desc</span><span class="params">(object)</span>:</span> <span class="comment"># 定一个非数据描述符</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, msg)</span>:</span></div><div class="line">        self.msg = msg</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner=None)</span>:</span></div><div class="line">        <span class="keyword">return</span> <span class="string">"&#123;0&#125;: &#123;1&#125;"</span>.format(self.typ, self.msg) <span class="comment"># self.typ是啥？？？？</span></div><div class="line"></div><div class="line">    </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NonDesc</span><span class="params">(Desc)</span>:</span></div><div class="line">    <span class="comment"># non-data descriptor </span></div><div class="line">    typ = <span class="string">'NonDesc'</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataDesc</span><span class="params">(Desc)</span>:</span></div><div class="line">    <span class="comment"># data descriptor</span></div><div class="line">    typ = <span class="string">'DataDesc'</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">M</span><span class="params">(type)</span>:</span></div><div class="line">    x = <span class="string">'x from M'</span></div><div class="line">    y = NonDesc(<span class="string">'y from cls M'</span>)</div><div class="line">    z = DataDesc(<span class="string">'z from cls M'</span>)</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, name)</span>:</span></div><div class="line">        <span class="keyword">return</span> <span class="string">"getattr M &#123;0&#125;"</span>.format(name)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="comment">#t = 't from A'</span></div><div class="line">    <span class="comment">#u = NonDesc('u from cls A')</span></div><div class="line">    <span class="comment">#v = DataDesc('v from cls A')</span></div><div class="line">    x = <span class="string">'x from A'</span></div><div class="line">    y = NonDesc(<span class="string">'y from cls A'</span>)</div><div class="line">    z = DataDesc(<span class="string">'z from cls A'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    metaclass is M</div><div class="line">    """</div><div class="line">    __metaclass__ = M</div><div class="line">    <span class="string">"""</span></div><div class="line">    这个metaclass什么用？？？？</div><div class="line">    """</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(B)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    metaclass is inherited from C</div><div class="line">    """</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, name)</span>:</span></div><div class="line">        <span class="keyword">return</span> <span class="string">"getattr C: &#123;0&#125;"</span>.format(name)</div><div class="line">    </div><div class="line"></div><div class="line">c = C()</div><div class="line"><span class="keyword">print</span> <span class="string">'******'</span></div><div class="line"><span class="keyword">print</span> <span class="string">'c.__class__'</span>, c.__class__  <span class="comment">#其实就是type(c), 还有注意c是新式类，格式应该是&lt;class '__main__.C'&gt;之类的</span></div><div class="line"><span class="keyword">print</span> <span class="string">'c.__class__.__getattribute__'</span>, c.__class__.__getattribute__ <span class="comment"># 因为c.__class__也是一个对象</span></div><div class="line"><span class="comment"># &lt;slot wrapper '__getattribute__' of 'object' objects&gt;</span></div><div class="line"><span class="keyword">print</span> <span class="string">'c.__class__.__mro__'</span>, c.__class__.__mro__ <span class="comment"># method resolution order C B A O</span></div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">'******'</span></div><div class="line"><span class="keyword">print</span> <span class="string">'c.x'</span>, c.x </div><div class="line"><span class="string">"""</span></div><div class="line">父类们寻找顺序是根据c.__class__.__mro__ 来的</div><div class="line">c先去寻找父类们中有没有x的描述符，没有，然后在自己的__dict__中找x，也咩有，然后再去父类们的__dict__中找</div><div class="line">有没有这个属性名的non-data 描述符，没有，不是描述符而是直接属性的呢？A中有，返回A中的x值</div><div class="line">"""</div><div class="line"><span class="keyword">print</span> <span class="string">'c.y'</span>, c.y</div><div class="line"><span class="string">"""</span></div><div class="line">同上，父类的顺序不废话了</div><div class="line">最终在第三阶段找到A中的y，它是一个non-data descriptor，NonDesc: y from cls A</div><div class="line">"""</div><div class="line"><span class="keyword">print</span> <span class="string">'c.z'</span>, c.z</div><div class="line"><span class="string">"""</span></div><div class="line">在第一个阶段中的A中找到z 是一个data descriptor，饭后 DataDesc: z from cls A</div><div class="line">"""</div><div class="line"><span class="keyword">print</span> <span class="string">'c.nope'</span>, c.nope</div><div class="line"><span class="string">"""</span></div><div class="line">当前三个阶段都找不到的时候，如果类中有定义__getattr__，就到这里去，没有报错</div><div class="line">这里所有三个阶段没有nope属性，然后到了__getattr__，返回 getattr C: nope</div><div class="line">"""</div><div class="line"></div><div class="line">c.t = <span class="string">'t from obj c'</span></div><div class="line">c.u = NonDesc(<span class="string">'u from obj c'</span>)</div><div class="line">c.v = DataDesc(<span class="string">'v from obj c'</span>)</div><div class="line">c.x = <span class="string">'x from obj c'</span></div><div class="line">c.y = NonDesc(<span class="string">'y from obj c'</span>)</div><div class="line">c.z = DataDesc(<span class="string">'z from obj c'</span>)</div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">'******'</span></div><div class="line"><span class="keyword">print</span> <span class="string">'c.t'</span>, c.t</div><div class="line"><span class="string">"""</span></div><div class="line">如上，在第二个阶段找到t, 返回 t from obj c</div><div class="line">"""</div><div class="line"><span class="keyword">print</span> <span class="string">'c.u'</span>, c.u</div><div class="line"><span class="string">"""</span></div><div class="line">在第二个阶段在c字典里面找到，不管是值还是descriptor ，这里会调用__get__()  NonDesc: u from obj c</div><div class="line">update:更正</div><div class="line">因为在</div><div class="line">"""</div><div class="line"><span class="keyword">print</span> <span class="string">'c.v'</span>, c.v</div><div class="line"><span class="string">"""</span></div><div class="line">在第二阶段c字典里找到, 调用__get__() ，返回 DataDesc: v from obj c</div><div class="line">"""</div><div class="line"><span class="keyword">print</span> <span class="string">'c.x'</span>, c.x</div><div class="line"><span class="string">"""</span></div><div class="line">因为在第一阶段是在类父类中找描述符，虽然A中有属性x但不是描述符，因此进入第二个阶段，在实例字典中找，不管是不是描述符</div><div class="line">只要名字对了就返回. 这里在这个阶段返回x from obj c</div><div class="line">"""</div><div class="line"><span class="keyword">print</span> <span class="string">'c.y'</span>, c.y</div><div class="line"><span class="string">"""</span></div><div class="line">同上，返回的是 NonDesc: y from obj c</div><div class="line">"""</div><div class="line"><span class="keyword">print</span> <span class="string">'c.z'</span>, c.z</div><div class="line"><span class="string">"""</span></div><div class="line">同上，返回的是 DataDesc: z from obj c</div><div class="line">"""</div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">'******'</span>  <span class="comment"># 这里是用到 class attribute look up 。 以上是对实例进行点运算</span></div><div class="line"><span class="keyword">print</span> <span class="string">"C.x"</span>, C.x</div><div class="line"><span class="string">"""</span></div><div class="line">因为B的metaclass是M了，C继承B，C现在的metaclass也是M</div><div class="line">现在要将上面的所有概念都升级，原来class变成metaclass，原来instance变成class</div><div class="line">先根据metaclass里的mro决定先后顺序metaparents</div><div class="line">因为这里是类属性访问，C类的metaclass是M，M.__mro__ 是 (&lt;class '__main__.M'&gt;, &lt;type 'type'&gt;, &lt;type 'object'&gt;)</div><div class="line">按顺序找x的描述符，但M中没有x的描述符，然后type，object都没有。</div><div class="line">进入第二个阶段，先计算C.__mro__,按照顺序依次访问类字典C,B,A,O ， </div><div class="line">如果有属性重名，先要描述符，不然只要是在__dict__中就返回</div><div class="line">c中没有x,然后去B，B里面也咩有x，到A中，有x但是不是描述符，没关系直接返回,因为也没有名字为x的描述符了。</div><div class="line">返回x from A</div><div class="line">"""</div><div class="line"><span class="keyword">print</span> <span class="string">"C.y"</span>, C.y</div><div class="line"><span class="string">"""</span></div><div class="line">同上，虽然在M中有y但是是非数据描述符，在第2阶段中的A类中找到y非数据描述符,返回 NonDesc: y from cls A</div><div class="line">"""</div><div class="line"><span class="keyword">print</span> <span class="string">"C.z"</span>, C.z</div><div class="line"><span class="string">"""</span></div><div class="line">这是在第一个阶段中的M里找到z数据描述符， 返回 DataDesc: z from cls M</div><div class="line">"""</div><div class="line"><span class="keyword">print</span> <span class="string">"C.nope"</span>, C.nope</div><div class="line"><span class="string">"""</span></div><div class="line">上面三个阶段都没有，进入第四个阶段，这个阶段不是去C中的__getattr__，因为上面说了都升了一级，现在是在</div><div class="line">M中的__getattr__，如果M里面没有__getattr__，那么就回报错，现在M有，返回 getattr M nope</div><div class="line">"""</div><div class="line"></div><div class="line">C.t = <span class="string">'t from obj C'</span></div><div class="line">C.u = NonDesc(<span class="string">'u from obj C'</span>)</div><div class="line">C.v = DataDesc(<span class="string">'v from obj C'</span>)</div><div class="line">C.x = <span class="string">'x from obj C'</span></div><div class="line">C.y = NonDesc(<span class="string">'y from obj C'</span>)</div><div class="line">C.z = DataDesc(<span class="string">'z from obj C'</span>)</div><div class="line"></div><div class="line"><span class="string">"""</span></div><div class="line">如果是类属性访问，好像没有A，B什么事 !!!!</div><div class="line">写在流程搞错之前，之前在第二阶段没有计算类的__mro__</div><div class="line">重新看一下流程</div><div class="line">"""</div><div class="line"><span class="keyword">print</span> <span class="string">'******'</span></div><div class="line"><span class="keyword">print</span> <span class="string">"C.t"</span>, C.t</div><div class="line"><span class="string">"""</span></div><div class="line">因为metaclass以及mro中都没有t，进入下一个阶段</div><div class="line">在第二阶段中现在C类中有t这个属性了，返回 t from obj C</div><div class="line">"""</div><div class="line"><span class="keyword">print</span> <span class="string">"C.u"</span>, C.u</div><div class="line"><span class="string">"""</span></div><div class="line">同上，在第二阶段中C类的__dict__中找到，返回 NonDesc: u from obj C</div><div class="line">"""</div><div class="line"><span class="keyword">print</span> <span class="string">"C.v"</span>, C.v</div><div class="line"><span class="string">"""</span></div><div class="line">同上，在第二阶段中返回 DataDesc: v from obj C</div><div class="line">"""</div><div class="line"><span class="keyword">print</span> <span class="string">"C.x"</span>, C.x</div><div class="line"><span class="string">"""</span></div><div class="line">和M中有重名，但是因为M中的不是数据描述符，这个的优先级高，在第二阶段返回 x from obj C</div><div class="line">虽然A中也有x，但是mro顺序C排在A前面</div><div class="line">"""</div><div class="line"><span class="keyword">print</span> <span class="string">"C.y"</span>, C.y</div><div class="line"><span class="string">"""</span></div><div class="line">同上，有重名，但是M中是非数据描述符，第一阶段过，到第二阶段，返回 NonDesc: y from obj C</div><div class="line">然后A中同理</div><div class="line">"""</div><div class="line"><span class="keyword">print</span> <span class="string">"C.z"</span>, C.z</div><div class="line"><span class="string">"""</span></div><div class="line">重名，但是z在M中是数据描述符，在第一阶段就返回 DataDesc: z from cls M</div><div class="line">"""</div><div class="line"><span class="keyword">print</span> <span class="string">"C.nope"</span>, C.nope</div><div class="line"><span class="string">"""</span></div><div class="line">这个没有变 getattr M nope</div><div class="line">"""</div></pre></td></tr></table></figure>
<p>结果：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">******</div><div class="line">c.__class__ &lt;class '__main__.C'&gt;</div><div class="line">c.__class__.__getattribute__ &lt;slot wrapper '__getattribute__' of 'object' objects&gt;</div><div class="line">c.__class__.__mro__ (&lt;class '__main__.C'&gt;, &lt;class '__main__.B'&gt;, &lt;class '__main__.A'&gt;, &lt;type 'object'&gt;)</div><div class="line">******</div><div class="line">c.x x from A</div><div class="line">c.y NonDesc: y from cls A</div><div class="line">c.z DataDesc: z from cls A</div><div class="line">c.nope getattr C: nope</div><div class="line">******</div><div class="line">c.t t from obj c</div><div class="line">c.u &lt;__main__.NonDesc object at 0x1009b8f10&gt;</div><div class="line">c.v &lt;__main__.DataDesc object at 0x1009b8f50&gt;</div><div class="line">c.x x from obj c</div><div class="line">c.y &lt;__main__.NonDesc object at 0x1009b8f90&gt;</div><div class="line">c.z DataDesc: z from cls A</div><div class="line">******</div><div class="line">C.x x from A</div><div class="line">C.y NonDesc: y from cls A</div><div class="line">C.z DataDesc: z from cls M</div><div class="line">C.nope getattr M nope</div><div class="line">******</div><div class="line">C.t t from obj C</div><div class="line">C.u NonDesc: u from obj C</div><div class="line">C.v DataDesc: v from obj C</div><div class="line">C.x x from obj C</div><div class="line">C.y NonDesc: y from obj C</div><div class="line">C.z DataDesc: z from cls M</div><div class="line">C.nope getattr M nope</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      分为实例调用和类调用，两者查找属性的流程是不一样的
    
    </summary>
    
      <category term="python" scheme="http://www.mmmmmcclxxvii.cn/categories/python/"/>
    
    
      <category term="python" scheme="http://www.mmmmmcclxxvii.cn/tags/python/"/>
    
      <category term="object" scheme="http://www.mmmmmcclxxvii.cn/tags/object/"/>
    
  </entry>
  
  <entry>
    <title>descriptor</title>
    <link href="http://www.mmmmmcclxxvii.cn/2017/03/08/descriptor/"/>
    <id>http://www.mmmmmcclxxvii.cn/2017/03/08/descriptor/</id>
    <published>2017-03-08T00:50:01.000Z</published>
    <updated>2017-04-02T02:19:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>其实自己没有深入的研究源码，这篇也是基于阅读一些官方文档和他人的博客做的总结。<br>我这里的思路是从描述符的渊源到为什么有这个描述符，然后怎么用<br>这里先直接给出描述符的定义，先有个印象，如果一开始阅读感觉没什么联系，没关系，最终那些点将连成线的。<br>官方的定义：</p>
<blockquote>
<p>In general, a descriptor is an object attribute with “binding behavior”, one whose attribute access has been overridden by methods in the descriptor protocol. Those methods are <strong>get</strong>(), <strong>set</strong>(), and <strong>delete</strong>(). If any of those methods are defined for an object, it is said to be a descriptor.<br>from – <a href="https://docs.python.org/2/howto/descriptor.html#definition-and-introduction" target="_blank" rel="external">Descriptor HowTo Guide</a></p>
</blockquote>
<p>也就是只要一个类定义了<code>__get__()</code>,<code>__set__()</code>,<code>__delete__()</code>当中的任意一个<strong>特殊方法</strong>,这个类就有了个别名“描述符”啦</p>
<h1 id="描述符的由来"><a href="#描述符的由来" class="headerlink" title="描述符的由来"></a>描述符的由来</h1><p>首先，因为python是一种动态编译的语言，他能在运行中动态添加类属性或类对象属性。那这些属性是被保存在比如<code>a.__dict__</code>这个里面，这里<code>a</code>是一个实例<code>a=A()</code>。其实类也有一个<code>__dict__</code>属性，通过<code>A.__dict__</code>就可以访问到.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line"><span class="meta">... </span>            self.attr = <span class="number">1</span></div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(self)</span>:</span></div><div class="line"><span class="meta">... </span>            <span class="keyword">print</span> self.attr</div><div class="line">...</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>a = A()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>dir(a)</div><div class="line">[<span class="string">'__class__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__dict__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__format__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__module__'</span>, <span class="string">'__new__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>, <span class="string">'__weakref__'</span>, <span class="string">'attr'</span>, <span class="string">'foo'</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>dir(A)</div><div class="line">[<span class="string">'__class__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__dict__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__format__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__module__'</span>, <span class="string">'__new__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>, <span class="string">'__weakref__'</span>, <span class="string">'foo'</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>a.__dict__</div><div class="line">&#123;<span class="string">'attr'</span>: <span class="number">1</span>&#125;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>A.__dict__</div><div class="line">dict_proxy(&#123;<span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'__dict__'</span>: &lt;attribute <span class="string">'__dict__'</span> of <span class="string">'A'</span> objects&gt;, <span class="string">'foo'</span>: &lt;function foo at <span class="number">0x101bba668</span>&gt;, <span class="string">'__weakref__'</span>: &lt;attribute <span class="string">'__weakref__'</span> of <span class="string">'A'</span> objects&gt;, <span class="string">'__doc__'</span>: <span class="keyword">None</span>, <span class="string">'__init__'</span>: &lt;function __init__ at <span class="number">0x101bba5f0</span>&gt;&#125;)</div></pre></td></tr></table></figure>
<p>注意到在<code>A</code>类中定义了一个<code>foo</code>函数，像这样的函数在C++语言中被称为成员函数，但是可以看到在<code>a.__dict__</code>中没有<code>foo</code>，在<code>A.__dict__</code>中有。其实通过访问，可以看出<code>a.__dict__</code>中保存的都是一些变量属性。这么理解，在C++中成员函数是被所有对象所共享的，不会为没个对象复制一份，这里也一样，可以看作是类的一个属性，不是实例的属性。那其实在python中，这么做是牵涉到了它的另外的两个概念，<strong>绑定，未绑定函数</strong>和<strong>描述符</strong>。先说一下，所有的类成员函数都是<strong><code>non-data despriptor</code></strong>。后面会继续解释</p>
<hr>
<blockquote>
<p>In a nutshell, a descriptor is a way to customize what happens when you reference an attribute on a model.<br>from – <a href="http://martyalchin.com/2007/nov/23/python-descriptors-part-1-of-2/" target="_blank" rel="external">Python Descriptors, Part 1 of 2</a></p>
</blockquote>
<hr>
<blockquote>
<p>Descriptor are the mechanism behind properties, methods,  static methods, class methods and <code>super()</code><br>from – <a href="https://docs.python.org/2/howto/descriptor.html#definition-and-introduction" target="_blank" rel="external">Descriptor HowTo Guide</a></p>
</blockquote>
<hr>
<h1 id="访问属性"><a href="#访问属性" class="headerlink" title="访问属性"></a>访问属性</h1><p><a href="http://www.mmmmmcclxxvii.cn/2017/03/08/object-attribute-look-up/">查找属性的访问顺序</a><br>建议先把下面的看了再来看这个</p>
<p>我之所以说先看下面，又不得不把这个主题先放上来，是因为其实描述符归根结底，目前看到就是对属性的取值赋值操作，<strong>只不过是对这个操作封装了一下</strong>而已。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a.attr = <span class="number">1</span></div><div class="line">tmp = a.attr</div></pre></td></tr></table></figure></p>
<p>一般的取值赋值就是这样子的，如果<code>attr</code>事先在类里面定义好了的<code>self.attr = arg</code> 上面的<code>a.attr = 1</code>其实就是重新将“标签”<code>a.attr</code>贴到<code>1</code>数值上去，如果没有那就是动态生成<code>attr</code>属性。<br><strong>但是这样的赋值太单一了，什么意思，也就是说，如果我要对赋入的值做下额外的检查，比如学生的成绩，不可能出现负数，身高也不可能出现负数。所以想到了在<code>__init__</code>当中增加一些逻辑代码进行检查</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,score)</span>:</span></div><div class="line">	<span class="keyword">assert</span> score&gt;=<span class="number">0</span>,<span class="string">"value error"</span></div><div class="line">	self.score = score</div></pre></td></tr></table></figure></p>
<p>但是这样只是在初始化的时候，像<code>a = A(-1)</code>会报错，那之后如果<code>a.score = -100</code>像这样的误操作，也没人阻止。那我们又有了另一种思路<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_score</span><span class="params">(self)</span>:</span></div><div class="line">	<span class="keyword">return</span> self.score</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_score</span><span class="params">(self,new_score)</span>:</span></div><div class="line">	<span class="keyword">assert</span> new_score&gt;=<span class="number">0</span>,<span class="string">"value error"</span></div><div class="line">	self.score = new_score</div></pre></td></tr></table></figure></p>
<p>通过<code>a.set_score(-100)</code>，调用一个函数，并在函数体内进行检查来进行赋值。</p>
<p><strong>总的来讲，python的属性获取，设置，这个属性只是一个存储的地方，只是一个容器，但往往你可能需要更多的功能，比如赋值的时候检验，然后，一般的，是用一些方法来做这些事情，<em>但是如果对于已经存在了的属性，你想用函数代替取值，赋值，你就要重写代码，找到所有用到这些属性的方法，然后改成函数</em>，比如上面的所有<code>a.score = 1</code>像这样的操作改成<code>a.set_score(1)</code>。这样就增加了工作量，这也是为什么在java程序中一个简单的取值都要封装成一个函数，就是为了避免何种情况，常见的模式也就是属性定义为私有变量，然后开放一个公有接口。python中的描述符只不过是另一种方法来实现这种对属性额外控制的需求而已</strong></p>
<h1 id="描述符实例"><a href="#描述符实例" class="headerlink" title="描述符实例"></a>描述符实例</h1><p>描述符的用法应该不局限于下面给出的例子，要多看其他高人的代码！！！<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Positive</span><span class="params">(object)</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></div><div class="line">		self.name = name</div><div class="line">		</div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self,instance,owner)</span>:</span></div><div class="line">		<span class="keyword">if</span> instance <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">			<span class="keyword">return</span> self <span class="comment">#这里相当于如果通过类调用,Student.score，就返回是类似&lt;descriptor.Positive object at 0x123455..&gt;之类的</span></div><div class="line">		<span class="keyword">return</span> instance.__dict__[self.name]</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self,instance,value)</span>:</span></div><div class="line">		<span class="keyword">if</span> value &lt; <span class="number">0</span>:</div><div class="line">			<span class="keyword">raise</span> ValueError(<span class="string">"negative value error..."</span>)</div><div class="line">		instance.__dict__[self.name] = value</div></pre></td></tr></table></figure></p>
<p>上面就定义了一个描述符。其实就是一个类，描述符只是个名称而已。在我的世界里，我想叫它皮皮虾都可以。只是全世界就这么流通规定了<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></div><div class="line">	score = Positive(<span class="string">'score'</span>) <span class="comment">#这句话就将score属性让描述符代理了</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,score)</span>:</span></div><div class="line">		self.name = name</div><div class="line">		self.score = score</div></pre></td></tr></table></figure></p>
<p>现在如果有这么一个语句<code>s = Student(&#39;cy&#39;,100);a = s.score</code>，其实是相当于在做<code>a = type(s).__dict__[&#39;score&#39;].__get__(s,type(s))</code><br>可以查看<code>Student.__dict__</code>中的<code>score</code>属性是<code>&#39;score&#39;: &lt;__main__.Positive object at 0x101bb8ed0&gt;</code>这样子的。<br>当作了<code>type(s).__dict__[&#39;score&#39;]</code>时其实就是获得了一个实例，之后还可以继续用点运算符往下接着做。</p>
<h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h2><h3 id="Positive-描述符中的-set-为什么参数中没有类？"><a href="#Positive-描述符中的-set-为什么参数中没有类？" class="headerlink" title="Positive 描述符中的__set__为什么参数中没有类？"></a>Positive 描述符中的<code>__set__</code>为什么参数中没有类？</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>Student.__dict__</div><div class="line">dict_proxy(&#123;<span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'score'</span>: &lt;__main__.Positive object at <span class="number">0x101bb8ed0</span>&gt;, <span class="string">'__dict__'</span>: &lt;attribute <span class="string">'__dict__'</span> of <span class="string">'Student'</span> objects&gt;, <span class="string">'__weakref__'</span>: &lt;attribute <span class="string">'__weakref__'</span> of <span class="string">'Student'</span> objects&gt;, <span class="string">'__doc__'</span>: <span class="keyword">None</span>, <span class="string">'__init__'</span>: &lt;function __init__ at <span class="number">0x101bbaaa0</span>&gt;&#125;)</div><div class="line"><span class="comment">#注意上面的score属性的值</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>Student.score = <span class="number">12</span>  <span class="comment"># 通过类访问</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>Student.__dict__</div><div class="line">dict_proxy(&#123;<span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'score'</span>: <span class="number">12</span>, <span class="string">'__dict__'</span>: &lt;attribute <span class="string">'__dict__'</span> of <span class="string">'Student'</span> objects&gt;, <span class="string">'__weakref__'</span>: &lt;attribute <span class="string">'__weakref__'</span> of <span class="string">'Student'</span> objects&gt;, <span class="string">'__doc__'</span>: <span class="keyword">None</span>, <span class="string">'__init__'</span>: &lt;function __init__ at <span class="number">0x101bbaaa0</span>&gt;&#125;)</div><div class="line"><span class="comment">#再对比一下score的值</span></div></pre></td></tr></table></figure>
<p><strong>当类调用的时候，其实就是设置同名新值了，它将原来的描述符给替换覆盖了。</strong></p>
<h3 id="Student类里面的score和self-score-到底用的是哪个？？"><a href="#Student类里面的score和self-score-到底用的是哪个？？" class="headerlink" title="Student类里面的score和self.score,到底用的是哪个？？"></a>Student类里面的score和self.score,到底用的是哪个？？</h3><p>可以先看一下<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>s = Student(<span class="string">'cy'</span>,<span class="string">'100'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s.__dict__</div><div class="line">&#123;<span class="string">'score'</span>: <span class="string">'100'</span>, <span class="string">'name'</span>: <span class="string">'cy'</span>&#125;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>Student.__dict__</div><div class="line">dict_proxy(&#123;<span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'score'</span>: &lt;__main__.Positive object at <span class="number">0x101bb8ed0</span>&gt;, <span class="string">'__dict__'</span>: &lt;attribute <span class="string">'__dict__'</span> of <span class="string">'Student'</span> objects&gt;, <span class="string">'__weakref__'</span>: &lt;attribute <span class="string">'__weakref__'</span> of <span class="string">'Student'</span> objects&gt;, <span class="string">'__doc__'</span>: <span class="keyword">None</span>, <span class="string">'__init__'</span>: &lt;function __init__ at <span class="number">0x101bbaaa0</span>&gt;&#125;)</div></pre></td></tr></table></figure></p>
<p>其实这里涉及到一个优先级的问题，也就是上面的访问属性的顺序链接。这里可以再跳回去看。因为描述符的优先级高！并且会改变默认的<code>get</code>,<code>set</code>方法。</p>
<blockquote>
<p>If an instance’s dictionary has an entry with the same name as a data descriptor, the data descriptor takes precedence. If an instance’s dictionary has entry with the same name as a non-data descriptor,the dictionary entry takes precedence.<br>from <a href="https://docs.python.org/2/howto/descriptor.html#descriptor-protocol" target="_blank" rel="external">Descriptor HowTo Guide</a></p>
</blockquote>
<p>什么是non-data descriptor后面会说明。</p>
<h3 id="2引申的一个问题就是如果self-score-score没有定义会是什么情况"><a href="#2引申的一个问题就是如果self-score-score没有定义会是什么情况" class="headerlink" title="2引申的一个问题就是如果self.score = score没有定义会是什么情况"></a><code>2</code>引申的一个问题就是如果<code>self.score = score</code>没有定义会是什么情况</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></div><div class="line"><span class="meta">... </span>    score = Positive(<span class="string">'score'</span>)</div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></div><div class="line"><span class="meta">... </span>        self.name = name</div><div class="line">...</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s = Student(<span class="string">'cy'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s.score = <span class="number">10</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s.__dict__</div><div class="line">&#123;<span class="string">'score'</span>: <span class="number">10</span>, <span class="string">'name'</span>: <span class="string">'cy'</span>&#125;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s.score = <span class="number">-10</span></div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">10</span>, <span class="keyword">in</span> __set__</div><div class="line">ValueError: negative error</div></pre></td></tr></table></figure>
<p>还是照样行得通。因为<code>instance.__dict__[self.name] = value</code>.虽然初始化的时候没有<code>score</code>这个属性，但其实后面的字典操作，相当于动态增加了这个属性，而且访问的优先级照样根据那个顺序来</p>
<h3 id="如果是self-score-Positive-39-score-39-会怎么样"><a href="#如果是self-score-Positive-39-score-39-会怎么样" class="headerlink" title="如果是self.score = Positive(&#39;score&#39;)会怎么样"></a>如果是<code>self.score = Positive(&#39;score&#39;)</code>会怎么样</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></div><div class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></div><div class="line"><span class="meta">... </span>        self.name = name</div><div class="line"><span class="meta">... </span>        self.score = Positive(<span class="string">'score'</span>)</div><div class="line">...</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s = Student(<span class="string">'cy'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s.__dict__</div><div class="line">&#123;<span class="string">'score'</span>: &lt;__main__.Positive object at <span class="number">0x101bc70d0</span>&gt;, <span class="string">'name'</span>: <span class="string">'cy'</span>&#125;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s.score = <span class="number">-10</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s.__dict__</div><div class="line">&#123;<span class="string">'score'</span>: <span class="number">-10</span>, <span class="string">'name'</span>: <span class="string">'cy'</span>&#125;</div></pre></td></tr></table></figure>
<p>没有起到作用，这是必然的。如果你知道访问顺序了之后，访问<code>s.score</code>时，因为类中没有同名的描述符，所以到实例中的<code>__dict__</code>看，如果有这个<code>key</code>，返回，但这里是赋值操作，参考另一篇<a href="http://www.mmmmmcclxxvii.cn/2017/03/29/python-name-and-values/">python name and values</a>，<code>s.scorei = -10</code>只不过是将<code>score</code>这个<strong>name</strong>重新贴标签贴到数值<code>-10</code>上去。</p>
<h3 id="get-中参数owner什么用，也没有用到它啊？"><a href="#get-中参数owner什么用，也没有用到它啊？" class="headerlink" title="__get__中参数owner什么用，也没有用到它啊？"></a><code>__get__</code>中参数<code>owner</code>什么用，也没有用到它啊？</h3><p>后面在<code>classmethod</code>中就会用到这个参数。其实函数参数写在哪里，也不一定都要用到，但更关心为什么要这么设计。后面看看源代码</p>
<p>看一个图：<br><img src="http://onexs3cnv.bkt.clouddn.com/descriptor-example-student.png" alt="descriptor-example-Student"></p>
<h1 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h1><p>python中有个叫修饰器的东西，<code>property()</code>，它是描述符的简介版<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@property</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">score</span><span class="params">(self)</span>:</span></div><div class="line">	<span class="keyword">return</span> self.__score</div><div class="line"></div><div class="line"><span class="meta">@score.setter</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">score</span><span class="params">(self,score)</span>:</span></div><div class="line">	<span class="keyword">if</span> score &lt; <span class="number">0</span>:</div><div class="line">		<span class="keyword">raise</span> ValueError(<span class="string">'negative'</span>)</div><div class="line">	self.__score = score</div></pre></td></tr></table></figure></p>
<blockquote>
<p>calling propery() is a succinct way of building a data descriptor that triggers function calls upon access to an attribute<br>from <a href="https://docs.python.org/2/howto/descriptor.html#properties" target="_blank" rel="external">Descriptor HowTo Guide</a></p>
</blockquote>
<p>上面的写法<code>@property</code>使用到了<a href="">装饰器</a></p>
<ol>
<li>但是如果一个类里面有很多属性是相同的限制，比如学生的身高不能负数，成绩不能负数，体重不能负数，如果用<code>property</code>的话，那就多了很多重复的代码，每个属性都要像上面一样写一遍。这时候就可以考虑用写一个描述符类来“一统天下”了</li>
<li>在之前说的对于已存在的属性，如果要对它们要进行限制，通过方法的话要找到每一处，这样很不方便，如果使用描述符只需要在类中加上<code>tall = Positive(&#39;tall&#39;)</code>像这样的语句就可以了，而且完全没有任何副作用！！</li>
</ol>
<hr>
<blockquote>
<p>If looked-up value is an object defining one of the descriptor methods, then python may override the default behavior and invoke the descriptor method instead.<br>from <a href="https://docs.python.org/2/howto/descriptor.html#definition-and-introduction" target="_blank" rel="external">Descriptor HowTo Guide</a></p>
</blockquote>
<h1 id="描述符的种类"><a href="#描述符的种类" class="headerlink" title="描述符的种类"></a>描述符的种类</h1><blockquote>
<p>学习也要遵循20/80定律，学到的20%就足够写程序了，先跑起来再来完善接下来的80%<br>– 尔东诚霍划夫斯基<br>描述符分<code>data descriptor</code>和<code>non-data descriptor</code><br>两者之前的区别就是，后者只定义了<code>__get__</code>。也就是没有设置。</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;其实自己没有深入的研究源码，这篇也是基于阅读一些官方文档和他人的博客做的总结。&lt;br&gt;我这里的思路是从描述符的渊源到为什么有这个描述符，然后怎么用&lt;br&gt;这里先直接给出描述符的定义，先有个印象，如果一开始阅读感觉没什么联系，没关系，最终那些点将连成线的。&lt;br&gt;官方的定义：
    
    </summary>
    
      <category term="python" scheme="http://www.mmmmmcclxxvii.cn/categories/python/"/>
    
    
      <category term="python" scheme="http://www.mmmmmcclxxvii.cn/tags/python/"/>
    
      <category term="descriptor" scheme="http://www.mmmmmcclxxvii.cn/tags/descriptor/"/>
    
      <category term="object" scheme="http://www.mmmmmcclxxvii.cn/tags/object/"/>
    
  </entry>
  
  <entry>
    <title>zlt-project</title>
    <link href="http://www.mmmmmcclxxvii.cn/2017/03/01/zlt-project/"/>
    <id>http://www.mmmmmcclxxvii.cn/2017/03/01/zlt-project/</id>
    <published>2017-03-01T02:24:31.000Z</published>
    <updated>2017-04-02T03:10:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近一直在用python写，这个也用python试试。需求图示<br><img src="http://onexs3cnv.bkt.clouddn.com/demands.jpeg" alt="demands"></p>
<p>用到：</p>
<ul>
<li>正则表达式：用来匹配test.py中的test名的</li>
<li>shutil模块，shutil.copy复制</li>
<li>os模块，切换目录用的。os.listdir,os.path.isfile等</li>
<li>sys模块，sys.argv命令行参数</li>
<li>Tkinter，图形化界面</li>
</ul>
<hr>
<h1 id="主要的拷贝逻辑写出来"><a href="#主要的拷贝逻辑写出来" class="headerlink" title="主要的拷贝逻辑写出来"></a>主要的拷贝逻辑写出来</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> re</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> shutil</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"></div><div class="line">path_a = sys.argv[<span class="number">1</span>]</div><div class="line">path_b = sys.argv[<span class="number">2</span>]</div><div class="line"></div><div class="line">candidate_list = [x <span class="keyword">for</span> x <span class="keyword">in</span> os.listdir(path_b) <span class="keyword">if</span> os.path.isfile(x) <span class="keyword">and</span> x[<span class="number">0</span>]!=<span class="string">'.'</span>]</div><div class="line">p = re.compile(<span class="string">'\w+'</span>)</div><div class="line">candidate = [p.match(file_name).group() <span class="keyword">for</span> file_name <span class="keyword">in</span> candidate_list]</div><div class="line"><span class="comment">#先把B文件中的文件名提取出来</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> prefix <span class="keyword">in</span> candidate:</div><div class="line">	<span class="keyword">for</span> every_file <span class="keyword">in</span> os.listdir(path_a):</div><div class="line">		<span class="keyword">if</span> predix <span class="keyword">in</span> every_file:</div><div class="line">			file_path = path_a + <span class="string">'/'</span> + every_file</div><div class="line">			shutil.copy(file_path,path_b)</div><div class="line">			<span class="keyword">print</span> <span class="string">'copy %s to %s'</span>%(every_file,path_b)</div></pre></td></tr></table></figure>
<p>接下来就是披上一件外衣了，Tkinter。<img src="http://onexs3cnv.bkt.clouddn.com/mind-map-project-zlt.png" alt="思维导图"><br>下面是代码</p>
<h1 id="zlt-main-frame-listbox-py-这个是显示文件夹功能的窗口"><a href="#zlt-main-frame-listbox-py-这个是显示文件夹功能的窗口" class="headerlink" title="zlt_main_frame_listbox.py 这个是显示文件夹功能的窗口"></a><code>zlt_main_frame_listbox.py</code> 这个是显示文件夹功能的窗口</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="comment">#-*- coding: utf-8 -*-</span></div><div class="line"><span class="comment"># File Name: zlt.py</span></div><div class="line"><span class="comment"># Created Time: Sun Mar  5 21:56:03 2017</span></div><div class="line"></div><div class="line">__author__ = <span class="string">'Crayon Chaney &lt;mmmmmcclxxvii@gmail.com&gt;'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">from</span> Tkinter <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</div><div class="line"><span class="keyword">import</span> pdb</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShowList</span><span class="params">(Frame)</span>:</span></div><div class="line">    <span class="comment"># count = 0</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,parent,initdir=None)</span>:</span></div><div class="line">        <span class="comment"># super(ShowList,self).__init__(parent)</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        上面这个为什么不行？？？</div><div class="line">        """</div><div class="line">        Frame.__init__(self,parent)</div><div class="line">        </div><div class="line">        self.parent = parent</div><div class="line"></div><div class="line">        self.cwd = StringVar(self)</div><div class="line">        self.wholecwd = StringVar(self) </div><div class="line">        self.dir_display = Label(self,font = (<span class="string">'Helvetica'</span>,<span class="number">12</span>,<span class="string">'bold'</span>),fg = <span class="string">'blue'</span>)</div><div class="line">        self.dir_display.pack()</div><div class="line"></div><div class="line">        self.dirfm = Frame(self)</div><div class="line">        self.dirsb_y = Scrollbar(self.dirfm)</div><div class="line">        self.dirsb_x = Scrollbar(self.dirfm,orient=<span class="string">"horizontal"</span>)</div><div class="line">        self.dirlb = Listbox(self.dirfm,yscrollcommand = self.dirsb_y.set,xscrollcommand = self.dirsb_x.set,height =<span class="number">20</span>,width = <span class="number">30</span> )</div><div class="line">        self.dirsb_y.config(command = self.dirlb.yview)</div><div class="line">        self.dirsb_x.config(command = self.dirlb.xview)</div><div class="line"></div><div class="line">        self.dirlb.bind(<span class="string">'&lt;Double-1&gt;'</span>,func=self.selectAndGo)</div><div class="line"></div><div class="line">        self.dirsb_y.pack(side = RIGHT,fill=Y)</div><div class="line">        self.dirsb_x.pack(side = BOTTOM,fill=X)</div><div class="line">        self.dirlb.pack(side=LEFT,fill=BOTH)</div><div class="line">        </div><div class="line">        self.dirfm.pack()</div><div class="line"></div><div class="line">        self.input = Entry(self,textvariable=self.cwd)</div><div class="line">        self.input.bind(<span class="string">'&lt;Return&gt;'</span>,func = self.doLs)</div><div class="line">        self.input.pack()</div><div class="line"></div><div class="line">        self.dirbuttonfm = Frame(self)</div><div class="line">        </div><div class="line">        self.clrbutton = Button(self.dirbuttonfm,text=<span class="string">'clear'</span>,command=self.clrEntry)</div><div class="line">        self.clrbutton.pack(side=LEFT)</div><div class="line">        self.listbutton = Button(self.dirbuttonfm,text=<span class="string">'List Directory'</span>,command=self.doLs)</div><div class="line">        self.listbutton.pack(side=LEFT)</div><div class="line"></div><div class="line">        self.dirbuttonfm.pack()</div><div class="line"></div><div class="line">        <span class="keyword">if</span> initdir:</div><div class="line">            self.cwd.set(initdir)</div><div class="line">            self.doLs()</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clrEntry</span><span class="params">(self,ev = None)</span>:</span></div><div class="line">        self.cwd.set(<span class="string">''</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">selectAndGo</span><span class="params">(self,ev=None)</span>:</span></div><div class="line">        self.last = self.cwd.get()</div><div class="line">        self.dirlb.config(selectbackground=<span class="string">'red'</span>)</div><div class="line">        self.cwd.set(self.dirlb.selection_get())</div><div class="line">        self.doLs()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">doLs</span><span class="params">(self,ev = None)</span>:</span></div><div class="line">        cur = self.cwd.get()</div><div class="line">        error = <span class="string">''</span></div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(cur):</div><div class="line">            error = <span class="string">'%s is not exists'</span>%cur</div><div class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> os.path.isdir(cur):</div><div class="line">            error = <span class="string">"%s is not dir"</span>%cur</div><div class="line"></div><div class="line">        <span class="keyword">if</span> error:</div><div class="line">            self.cwd.set(error)</div><div class="line">            self.parent.update()</div><div class="line">            sleep(<span class="number">2</span>)</div><div class="line">            <span class="keyword">if</span> <span class="keyword">not</span> (hasattr(self,<span class="string">'last'</span>) <span class="keyword">and</span> self.last):</div><div class="line">                self.last = os.curdir</div><div class="line">            self.cwd.set(self.last)</div><div class="line">            self.dirlb.config(selectbackground=<span class="string">'LightSkyBlue'</span>)</div><div class="line">            <span class="keyword">return</span></div><div class="line"></div><div class="line">        self.cwd.set(<span class="string">'Fetching...'</span>)</div><div class="line">        self.parent.update()</div><div class="line"></div><div class="line">        dirfiles = os.listdir(cur)</div><div class="line">        os.chdir(cur)</div><div class="line"></div><div class="line">        self.dir_display.config(text=os.getcwd())</div><div class="line">        self.wholecwd.set(os.getcwd())</div><div class="line">        dirfiles.sort()</div><div class="line">        self.dirlb.delete(<span class="number">0</span>,END)</div><div class="line">        self.dirlb.insert(END,os.curdir)</div><div class="line">        self.dirlb.insert(END,os.pardir)</div><div class="line"></div><div class="line">        <span class="keyword">for</span> eachdirname <span class="keyword">in</span> dirfiles:</div><div class="line">            self.dirlb.insert(END,eachdirname)</div><div class="line"></div><div class="line">        self.cwd.set(os.curdir)</div><div class="line">        self.dirlb.config(selectbackground=<span class="string">'LightSkyBlue'</span>)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    root = Tk()</div><div class="line">    ShowList(root,os.curdir).pack()</div><div class="line">    root.mainloop()</div></pre></td></tr></table></figure>
<h1 id="zlt-windows-py-主窗口"><a href="#zlt-windows-py-主窗口" class="headerlink" title="zlt_windows.py 主窗口"></a><code>zlt_windows.py</code> 主窗口</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="comment">#-*- coding: utf-8 -*-</span></div><div class="line"><span class="comment"># File Name: zlt_windows.py</span></div><div class="line"><span class="comment"># Created Time: Mon Mar  6 14:13:52 2017</span></div><div class="line"></div><div class="line">__author__ = <span class="string">'Crayon Chaney &lt;mmmmmcclxxvii@gmail.com&gt;'</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> zlt_main_frame_listbox <span class="keyword">import</span> *</div><div class="line"><span class="keyword">import</span> shutil</div><div class="line"><span class="keyword">import</span> re</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CopyDir</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.top = Tk()</div><div class="line">        self.top.title(<span class="string">'你花大爷呕心沥血作'</span>)</div><div class="line"></div><div class="line">        <span class="comment"># ShowList(self.top).pack(side=LEFT)</span></div><div class="line">        self.A = ShowList(self.top,os.curdir)</div><div class="line">        self.A.pack(side=LEFT)</div><div class="line">        self.topbuttonfm = Frame(self.top)</div><div class="line">        self.copybutton = Button(self.topbuttonfm,text=<span class="string">'&lt;--A  copy  B--&gt;'</span>,width = <span class="number">15</span>,command = self.confirmCopy)</div><div class="line">        self.copybutton.pack()</div><div class="line">        self.quitbutton = Button(self.topbuttonfm,text=<span class="string">'退出'</span>,command = self.top.quit)</div><div class="line">        self.quitbutton.pack()</div><div class="line">        self.topbuttonfm.pack(side = LEFT,ipadx = <span class="number">5</span>)</div><div class="line">        <span class="comment"># ShowList(self.top).pack(side=LEFT)</span></div><div class="line">        self.B = ShowList(self.top,os.curdir)</div><div class="line">        self.B.pack(side=LEFT,ipadx = <span class="number">5</span>)</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">confirmCopy</span><span class="params">(self,ev = None)</span>:</span></div><div class="line">        self.confirmtop = Toplevel(self.top)</div><div class="line"></div><div class="line">        <span class="comment"># pdb.set_trace()</span></div><div class="line"></div><div class="line">        self.a_path =  self.A.wholecwd.get()</div><div class="line">        self.b_path = self.B.wholecwd.get()</div><div class="line">        </div><div class="line">        listfiles_a = os.listdir(self.a_path)</div><div class="line">        listfiles_b = os.listdir(self.b_path)</div><div class="line">        </div><div class="line">        title_msg = <span class="string">'复制这些到%s'</span>%self.b_path</div><div class="line">        self.confirmtop.title(title_msg)</div><div class="line"></div><div class="line">        <span class="comment"># self.fm = Frame(self.confirmtop) # to be pack</span></div><div class="line">        self.copy_candidates_info = Text(self.confirmtop,height=<span class="number">30</span>,width = <span class="number">20</span>) <span class="comment"># to be pack</span></div><div class="line">        </div><div class="line">        pattern = re.compile(<span class="string">'\w+'</span>)</div><div class="line">        self.to_be_copied_list = []</div><div class="line">        <span class="keyword">for</span> to_be_copied <span class="keyword">in</span> listfiles_b:</div><div class="line">            <span class="keyword">try</span>:</div><div class="line">                prefix = pattern.match(to_be_copied).group()</div><div class="line">            <span class="keyword">except</span> AttributeError,e:</div><div class="line">                <span class="keyword">continue</span></div><div class="line">                <span class="comment"># print e</span></div><div class="line">                <span class="comment"># if 'NoneType' in e:</span></div><div class="line">                    <span class="comment"># continue</span></div><div class="line">                <span class="comment"># else:</span></div><div class="line">                    <span class="comment"># sys.exit()</span></div><div class="line">            <span class="keyword">for</span> eachfile <span class="keyword">in</span> listfiles_a:</div><div class="line">                <span class="keyword">if</span> prefix <span class="keyword">in</span> eachfile :<span class="comment"># and os.path.isfile(self.a_path+'/'+prefix): 可能在windows下不支持</span></div><div class="line">                    self.to_be_copied_list.append(eachfile)</div><div class="line"></div><div class="line">        <span class="comment"># self.copy_candidates_info.delete(0,END)</span></div><div class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> self.to_be_copied_list:</div><div class="line">            self.copy_candidates_info.insert(END,item+<span class="string">'\n'</span>) <span class="comment"># window下换行符可能不一样 \r\n</span></div><div class="line"></div><div class="line">        self.copy_candidates_info.pack(side = LEFT,padx = <span class="number">10</span>)</div><div class="line"></div><div class="line">        information = <span class="string">'copy to %s'</span>%self.b_path</div><div class="line">        self.other_information = Label(self.confirmtop,text = information)</div><div class="line">        self.other_information.pack(side=LEFT,ipadx = <span class="number">5</span>,ipady = <span class="number">13</span>)</div><div class="line"></div><div class="line">        self.fm = Frame(self.confirmtop)</div><div class="line">        self.result_info = Label(self.fm,font = (<span class="string">'Helvetica'</span>,<span class="number">12</span>,<span class="string">'bold'</span>),fg=<span class="string">'red'</span>)</div><div class="line">        self.confirmbutton = Button(self.fm,text=<span class="string">'确认'</span>,command = self.copyExecute)</div><div class="line">        self.cancelbutton = Button(self.fm,text=<span class="string">'取消'</span>,command = self.confirmtop.quit)</div><div class="line">        <span class="string">"""</span></div><div class="line">        为什么点击取消会全体退出？？？ 想要的效果是只是这个确认窗口退出而已</div><div class="line">        """</div><div class="line">        self.result_info.pack(side=LEFT)</div><div class="line">        self.confirmbutton.pack(side = LEFT)</div><div class="line">        self.cancelbutton.pack(side=LEFT)</div><div class="line">        self.fm.pack(side = BOTTOM)</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">copyExecute</span><span class="params">(self,ev=None)</span>:</span></div><div class="line">        os.chdir(self.a_path)</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (hasattr(self,<span class="string">'to_be_copied_list'</span>) <span class="keyword">and</span> len(self.to_be_copied_list)):</div><div class="line">            self.result_info.config(text=<span class="string">'Failed'</span>)</div><div class="line">            <span class="keyword">return</span> </div><div class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> self.to_be_copied_list:</div><div class="line">            <span class="keyword">try</span>:</div><div class="line">                shutil.copy(item,self.b_path)</div><div class="line">            <span class="keyword">except</span> Exception,e:</div><div class="line">                self.result_info.config(text=e)</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                self.result_info.config(text=<span class="string">'Successful'</span>)</div><div class="line">            </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    c = CopyDir()</div><div class="line">    mainloop()</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure>
<h1 id="发现的bug："><a href="#发现的bug：" class="headerlink" title="发现的bug："></a>发现的bug：</h1><ol>
<li>因为我现在是在一个窗口生成了两个文件夹展示的frame，但是在一个进程中，一个文件夹切换了路径，另一个就跟着切换了导致出现bug，解决方法，要用多线程</li>
</ol>
]]></content>
    
    <summary type="html">
    
      章礼腾要我做的一个程序，他需求是，有AB两个文件夹，我想通过B文件夹中文件的文件名将A文件夹中相同文件名的文件复制到B文件夹
    
    </summary>
    
      <category term="python" scheme="http://www.mmmmmcclxxvii.cn/categories/python/"/>
    
    
      <category term="python" scheme="http://www.mmmmmcclxxvii.cn/tags/python/"/>
    
      <category term="project" scheme="http://www.mmmmmcclxxvii.cn/tags/project/"/>
    
      <category term="Tkinter" scheme="http://www.mmmmmcclxxvii.cn/tags/Tkinter/"/>
    
  </entry>
  
  <entry>
    <title>python types and objects</title>
    <link href="http://www.mmmmmcclxxvii.cn/2016/12/03/python-types-and-objects/"/>
    <id>http://www.mmmmmcclxxvii.cn/2016/12/03/python-types-and-objects/</id>
    <published>2016-12-03T00:02:26.000Z</published>
    <updated>2017-04-04T09:12:57.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://www.cafepy.com/article/python_types_and_objects/python_types_and_objects.html" target="_blank" rel="external">Python Types and Objects</a><br>这篇文章解释了：</p>
<ul>
<li>什么是<code>&lt;type &#39;type&#39;&gt;</code>和<type 'object'=""></type></li>
<li>用户自定义的类和实例是怎么联系在一起的以及和内建类型的联系</li>
<li>什么是<code>metaclass</code>元类</li>
</ul>
<a id="more"></a>
<h1 id="type和object"><a href="#type和object" class="headerlink" title="type和object"></a><code>type</code>和<code>object</code></h1><p>从之前的学习面向对象编程来看，我们可以通过继承来定义一个类，也可以查看一个对象属于哪个类。其实这就可以抽象出两种关系<br><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-04-04%20at%202.56.02%20PM.png" alt="relationship"><br>图中虚线就是<code>type</code>，表示一个<strong>对象</strong>(又称‘实例’)的类型是尖头指向的那个<br>图中的实线是<code>base</code>，表示一个<strong>类</strong>的基类是尖头指向的那个</p>
<blockquote>
<p>the type and base(if exist) are important, coz they define special relationships an object with other objects.</p>
</blockquote>
<p>因为在python中一切皆为对象，所以<code>base</code>到头了就是<code>object</code>，这个是在python中一切类的祖宗。<br>而因为python中一切皆为对象, 它就有类型，<code>object</code>也是一个对象，它的类型就是<code>type</code>，<code>type</code>本身也是一个对象，为了满足python这样的设定，它的类型就是它自己。<strong><code>type</code>既是一个对象，也是一个类</strong>。就说我们自己定义了一个类<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line"><span class="meta">... </span>    <span class="keyword">pass</span></div><div class="line">...</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>A.__bases__</div><div class="line">(&lt;type <span class="string">'object'</span>&gt;,)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>A.__class__</div><div class="line">&lt;type <span class="string">'type'</span>&gt;</div></pre></td></tr></table></figure></p>
<p>他也有类型，就是<code>type</code>类型</p>
<blockquote>
<p>keep in mind that the types and bases of objects just other objects</p>
</blockquote>
<p>既然像类也是一种”对象”,那它是谁的对象？？答案就是<code>metaclass</code>，<code>type</code>就是<code>metaclass</code>。<br>先有鸡还是先有蛋？<br><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-04-04%20at%202.42.19%20PM.png" alt="explain"></p>
<h2 id="类和类型的统一"><a href="#类和类型的统一" class="headerlink" title="类和类型的统一"></a>类和类型的统一</h2><p>这个问题在知乎上有一个解答不错</p>
<blockquote>
<p>旧式类的实现不够好，类是类，实例是实例，类的类型是classobj，实例的类型是instance，两者的联系只在于<strong>class</strong>，这和内置对象是不同的，int对象的类型就是int，同时int()返回的也是int类型的对象，内置对象和自定义对象不同就对代码统一实现带来很大困难。比如说有段代码输入一个对象，返回一个默认构造的同类型对象，本来应该写作type(obj)()，现在就必须写成：obj.<strong>class</strong>() if hasattr(obj, ‘<strong>class</strong>‘) else type(obj)()。如果想用自定义的类去替代一些系统内置类型，比如说自定义一个dictionary，这样的不一致就会出问题新式类之后自定义类和内置类型就一致了：1. 所有类型的类型都是type2. 所有类型调用的结果都是构造，返回这个类型的实例3. 所有类型都是object的子类这样就不再需要区分自定义类和类型了。实现这件事其实并不容易，理性上来想，type的基类是object，而object的类型是type，这是一个先有鸡还是先有蛋的问题。Python通过对这几个类的特殊处理实现了这样的逻辑。</p>
<p>作者：灵剑<br>链接：<a href="https://www.zhihu.com/question/38803693/answer/103128686" target="_blank" rel="external">https://www.zhihu.com/question/38803693/answer/103128686</a><br>来源：知乎<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
</blockquote>
<hr>
<h1 id="自定义类和内建类型"><a href="#自定义类和内建类型" class="headerlink" title="自定义类和内建类型"></a>自定义类和内建类型</h1><p>图片来自那个文章顶部那个链接,这篇文章写的很详细了<br><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-04-04%20at%203.35.31%20PM.png" alt="python objects map"></p>
<blockquote>
<ol>
<li>Dashed lines cross spacial boundaries (i.e. go from object to meta-object). Only exception is <type 'type'=""> (which is good, otherwise we would need another space to the left of it, and another, and another…).</type></li>
<li>Solid lines do not cross space boundaries. Again, <type 'type'=""> -&gt; <type 'object'=""> is an exception.</type></type></li>
<li>Solid lines are not allowed in the rightmost space. These objects are too concrete to be subclassed.</li>
<li>Dashed line arrow heads are not allowed rightmost space. These objects are too concrete to be instantiated.</li>
<li>Left two spaces contain types. Rightmost space contains non-types.</li>
<li>If we created a new object by subclassing <type 'type'=""> it would be in the leftmost space, and would also be both a subclass and instance of <type 'type'="">.</type></type></li>
</ol>
</blockquote>
<h2 id="两个对象"><a href="#两个对象" class="headerlink" title="两个对象"></a>两个对象</h2><p>python中分<code>Type</code>对象和<code>Non-Type</code>对象，这个<code>Non-Type</code>不是一个正式的概念，只是这么称呼，这类对象，比如2，就是2，2怎么再派生？怎么再实例化，不行，所以是<strong>too concrete</strong>。怎么判断，只要<code>type(obj)</code>出来的是<code>&lt;type &#39;type&#39;&gt;</code>就是<code>Type</code>对象，不然就是<code>Non-Type</code>对象</p>
<blockquote>
<ul>
<li>Type objects - can create instances, can be subclassed.</li>
<li>Non-type objects - cannot create instances, cannot be subclassed.</li>
<li><code>objectname.__class__</code> exists for every object and points the type of the object.</li>
<li><code>objectname.__bases__</code> exists for every type object and points the superclasses of the object. It is empty only for <code>&lt;type &#39;object&#39;&gt;</code>.</li>
<li>Some non-type objects can be created using special Python syntax. For example, <code>[1, 2, 3]</code> creates an instance of <code>&lt;type &#39;list&#39;&gt;</code>.</li>
</ul>
</blockquote>
<h2 id="两个动作"><a href="#两个动作" class="headerlink" title="两个动作"></a>两个动作</h2><p>两种关系对应两种动作可以生成两种对象。有可能是<code>Type</code>对象,也有可能是<code>Non-Type</code>对象。<br>两个动作就是<code>subclassing</code>和<code>instantiating</code>.</p>
<h3 id="subclassing"><a href="#subclassing" class="headerlink" title="subclassing"></a>subclassing</h3><p>这个动作具体就是<code>class</code>语句,定义一个类，或者说定一个<code>type</code>，</p>
<blockquote>
<p>This means you can create a new object that is somewhat similar to existing type objects.</p>
<p>To create a new object using subclassing, we use the class statement and specify the bases (and, optionally, the type) of the new object. This always creates a type object.</p>
</blockquote>
<p><del>这段代码抽象代表的就是一个类</del></p>
<h3 id="instantiating"><a href="#instantiating" class="headerlink" title="instantiating"></a>instantiating</h3><p>这个动作就是实例化，由一个<code>type</code>实例化出对象，<code>type</code>相当于一个工厂的模型，具体就是通过<code>()</code>操作。</p>
<blockquote>
<p>To create a new object using instantiation, we use the call operator (()) on the type object we want to use. This may create a type or a non-type object, <strong>depending on which type object was used</strong>.</p>
<p>This means you can create a new object that is an instance of the existing type object.</p>
</blockquote>
<p>python中的内建类型是在启动python后生成的。比如<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>type(list)</div><div class="line">&lt;type <span class="string">'type'</span>&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>list.__bases__</div><div class="line">(&lt;type <span class="string">'object'</span>&gt;,) <span class="comment"># list是从object派生而来了</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>ml = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>type(ml)</div><div class="line">&lt;type <span class="string">'list'</span>&gt;</div></pre></td></tr></table></figure></p>
<p>如果问<code>[1,2,3]</code>是什么类型啊？列表类型啊。列表类型是什么类型啊？<code>type</code>类型啊。<code>type</code>类型是什么类型啊？<code>type</code>类型。。。当我们创建{‘a’:1,’b’:2},(1,2)这种，是从<code>&lt;type &#39;list&#39;&gt;</code>,<code>&lt;type &#39;dict&#39;&gt;</code>实例化出来的，也就是相应的<code>type</code>，包括自定义。</p>
<h1 id="metaclass"><a href="#metaclass" class="headerlink" title="metaclass"></a>metaclass</h1><p>很重要的一点就是，当我<code>class</code>语句定义了一个类，我就自动的有了一个<code>type</code>，其实也就是说<code>__class__</code>（新式类）<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(object)</span>:</span></div><div class="line">	<span class="keyword">pass</span></div></pre></td></tr></table></figure></p>
<p><code>type(C)</code>就已经定了。它是根据所继承的父类的<code>type</code>延续下来的，因为<code>object</code>的类型是<code>type</code>所以<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt;type(C)</div><div class="line">&lt;type <span class="string">'type'</span>&gt;</div></pre></td></tr></table></figure></p>
<p>那其实这样追溯下去，因为<code>object</code>类型是<code>type</code>类，所以所有的类都是<code>type</code>类。除了<code>Non-Type</code>对象的类型是相对应的类。所以那幅图的前面两列的虚线都指到<code>type</code>。<br>这里有一个问题就是它是由继承关系决定的，那如果是多重继承呢？是继承哪个？<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; class M1(type):</div><div class="line">...     pass</div><div class="line">...</div><div class="line">&gt;&gt;&gt; class M2(type):</div><div class="line">...     pass</div><div class="line">...</div><div class="line">&gt;&gt;&gt; class A(object):</div><div class="line">...     __metaclass__ = M1</div><div class="line">...</div><div class="line">&gt;&gt;&gt; class B(object):</div><div class="line">...     __metaclass__ = M2</div><div class="line">...</div><div class="line">&gt;&gt;&gt; type(A)</div><div class="line">&lt;class '__main__.M1'&gt;</div><div class="line">&gt;&gt;&gt; type(B)</div><div class="line">&lt;class '__main__.M2'&gt;</div><div class="line">&gt;&gt;&gt; class C(A,B):</div><div class="line">...     pass</div><div class="line">...</div><div class="line">Traceback (most recent call last):</div><div class="line">  File "&lt;stdin&gt;", line 1, in &lt;module&gt;</div><div class="line">  TypeError: Error when calling the metaclass bases</div><div class="line">      metaclass conflict: the metaclass of a derived class must be a (non-strict) subclass of the metaclasses of all its bases</div></pre></td></tr></table></figure></p>
<p>如果大家的<code>metaclass</code>都一样，那就没得说了，如果不一样，那么就会混乱，这时候要指定。什么时候会不一样呢？一般情况下都是<code>type</code>，除非自己定义<code>specialType</code>然后派生。但<strong>建议是不要用这个特性</strong>。</p>
<p>另一个问题就是，到底怎么自定义<code>specialType</code>？上面例子已经给出答案了。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(object)</span>:</span></div><div class="line">	__metaclass__ = specialType</div></pre></td></tr></table></figure></p>
<h1 id="隐式关系"><a href="#隐式关系" class="headerlink" title="隐式关系"></a>隐式关系</h1><p>图片来自文章顶部链接文章中的：<br><a href="http://www.cafepy.com/article/python_types_and_objects/python_types_and_objects.html" target="_blank" rel="external"><img src="http://www.cafepy.com/article/python_types_and_objects/images/relationships_transitivity.png" alt="transitivity of relationships"></a></p>
<p><code>issubclass</code>问的是一个<code>class</code>是不是<code>subclass</code> of 另一个<code>class</code>。<code>class</code>和<code>class</code>之间的关系<br><code>isinstance</code>问的是一个<code>object</code>是不是<code>instance</code> of 另一个<code>class</code>。<code>object</code>和<code>class</code>之间的关系</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance(type,type) <span class="comment">#虚线，type指向自己 </span></div><div class="line"><span class="keyword">True</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance(type,object) <span class="comment">#因为type是自身的实例，type又是object的子类，所以type是object的实例</span></div><div class="line"><span class="keyword">True</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance(object,object) <span class="comment">#因为object是type的实例，type又是object的子类，所以object是object的实例</span></div><div class="line"><span class="keyword">True</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance(object,type) <span class="comment"># 虚线</span></div><div class="line"><span class="keyword">True</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>issubclass(type,type) <span class="comment"># A class is considered a subclass of itself</span></div><div class="line"><span class="keyword">True</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>issubclass(type,object) <span class="comment"># 实线</span></div><div class="line"><span class="keyword">True</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>issubclass(object,object) <span class="comment"># 任何类都是object的子类</span></div><div class="line"><span class="keyword">True</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>issubclass(object,type) <span class="comment"># object在类的金字塔顶端，它上面就没人啦</span></div><div class="line"><span class="keyword">False</span></div></pre></td></tr></table></figure>
<blockquote>
<p><a href="https://docs.python.org/2/library/functions.html#issubclass" target="_blank" rel="external">A class is considered a subclass of itself</a></p>
</blockquote>
<hr>
<h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><ol>
<li><p><code>class</code>,<code>object</code>,<code>instance</code>的关系</p>
<blockquote>
<p>An object is an instance of a class, and may be called a class instance or class object; instantiation is then also known as construction. Not all classes can be instantiated – abstract classes cannot be instantiated, while classes that can be instantiated are called concrete classes.</p>
</blockquote>
</li>
<li><p>How does python really create a new object?</p>
<blockquote>
<p>Internally, when python creates a new object, it always uses a type and creates an instance of that object. Specifically it uses the <strong>new</strong>() and <strong>init</strong>() methods of the type. In a sense, the type serves as a factory that can churn out new objects, the type of these manufactured objects will be the type object used to create them. This is why every object has a type.</p>
</blockquote>
</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;http://www.cafepy.com/article/python_types_and_objects/python_types_and_objects.html&quot;&gt;Python Types and Objects&lt;/a&gt;&lt;br&gt;这篇文章解释了：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;什么是&lt;code&gt;&amp;lt;type &amp;#39;type&amp;#39;&amp;gt;&lt;/code&gt;和&lt;type &#39;object&#39;&gt;&lt;/li&gt;
&lt;li&gt;用户自定义的类和实例是怎么联系在一起的以及和内建类型的联系&lt;/li&gt;
&lt;li&gt;什么是&lt;code&gt;metaclass&lt;/code&gt;元类&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="python" scheme="http://www.mmmmmcclxxvii.cn/categories/python/"/>
    
    
      <category term="python" scheme="http://www.mmmmmcclxxvii.cn/tags/python/"/>
    
      <category term="object" scheme="http://www.mmmmmcclxxvii.cn/tags/object/"/>
    
      <category term="type" scheme="http://www.mmmmmcclxxvii.cn/tags/type/"/>
    
  </entry>
  
  <entry>
    <title>Interesting experience -- challenge school master swimming</title>
    <link href="http://www.mmmmmcclxxvii.cn/2016/11/11/swimming-with-master/"/>
    <id>http://www.mmmmmcclxxvii.cn/2016/11/11/swimming-with-master/</id>
    <published>2016-11-11T15:14:56.000Z</published>
    <updated>2017-02-20T10:14:45.000Z</updated>
    
    <content type="html"><![CDATA[<p>–update–<br>其实现在想想，可能当初会有更成熟的做法。</p>
<hr>
<a id="more"></a>
<p>其实真的，在决定要去雷励的时候，众筹这个任务就已经压在我的肩上了，虽然后来真的校长答应我的挑战促使了我的任务圆满完成，但这其中的历程更值得细嚼慢咽</p>
<h1 id="公开信的问题"><a href="#公开信的问题" class="headerlink" title="公开信的问题"></a>公开信的问题</h1><p>发邮件给学校办公室，给校长邮箱，我是不知道会不会有人看到，或者能有多大的反响，站在我自己的角度上，我肯定是希望校长本人能看见，然后我还想像着趁校长吃饭的空隙，上演5分钟演讲感动全世界的戏码。其实就在我点发送的一瞬间，多米诺效应就开始了。首先指出我的几个问题，我把事情想象的太简单了。</p>
<h2 id="道德绑架"><a href="#道德绑架" class="headerlink" title="道德绑架"></a>道德绑架</h2><p>我是出于一种目的来挑战校长的比赛，虽然说以公益的名义，但是糊里糊涂的校长就被我拉上船了，在与管理学校社交平台的学长的沟通上，也是这个问题阻碍了帮我转发。</p>
<h2 id="我没写输了怎么办"><a href="#我没写输了怎么办" class="headerlink" title="我没写输了怎么办"></a>我没写输了怎么办</h2><p>我只写了赢了，好，校长你施舍点我吧。但是我真想不出来，我输了能怎么办，我还卖身不成么？简直胡闹么，这样影响更不好。</p>
<hr>
<p>这两点是最致命的。我是接到了辅导员的电话，才知道我的信已经被学校宣传部拦下来了，在老师中间已经传开了，但是校长在意大利调研，所以还没回国。辅导员对我说基于这个目的是好的，但是不保证能不能行。其实我知道基于那两个致命的缺陷，校长能有一百个理由拒绝。然后又出现了一个更要命的，更“政治化”的问题。那就是学校和公益组织之间的关系，他们想知道为什么做公益还要众筹（这是雷励的传统，因此也更有挑战，基金拿来项目地的建材费用等）。<br>他们考虑到是不是行骗组织，因为前几年清华大学就出了一件乌龙事件，自称罗斯柴尔德家族的人来访，清华大学以最高的规格接待，结果发现是骗子。基于对学生的保护，也基于对学校名誉的保护，任何情况下，校长做决定都是谨慎的。因为即使现在没有组织的任何负面新闻，不代表将来没有，所以这一点，只要校长应战了，学校和组织之间就捆绑了。</p>
<p><img src="http://onexs3cnv.bkt.clouddn.com/7-160325235000.jpg" alt="qinghua"></p>
<hr>
<p>但是想不到的是，校长答应了。听说还很爽快。</p>
<hr>
<p><img src="http://onexs3cnv.bkt.clouddn.com/%E6%A0%A1%E9%95%BF%E9%A2%98%E8%AF%8D.jpg" alt="校长题词"></p>
<h1 id="关于推动这个挑战中的问题"><a href="#关于推动这个挑战中的问题" class="headerlink" title="关于推动这个挑战中的问题"></a>关于推动这个挑战中的问题</h1><p>这里面的问题更多的设计营销推广文案的问题。最主要的就是我没能很好的把那么大量的阅读者人引流到众筹平台。最重要的原因就是没有做好链接。其实我重写了公开信，但是转发的都是第一版的，所以那部分上千人的受众群体其实是流失了的。想想每个人捐我1元，任务也都完成了。后来我还特地的关于众筹的写了另一个版本的面向大学生的公开信，希望能引流一部分。我还增加了很多众筹回报。在微博平台上的长微博中发布中不是还有文字描述么，这里可以增加好几个链接，我一开始增加了好几个链接到众筹回报，会长告诉我说，不要，什么都不要，直入主题，就只放一个众筹平台的链接。后来想想这才是我推文的主要目的。这无疑的正确的。</p>
<hr>
<p>大道至简，直奔主题，细节决定成败</p>
<hr>
<h1 id="备战"><a href="#备战" class="headerlink" title="备战"></a>备战</h1><p>其实之前我是不抱有任何希望的，对于这件事能不能行，但是后来接到记者的电话，再得到辅导员的证实，我心情异常的激动。连我最好的一个朋友原来也说亮瞎了的想法，变成惊呆了。也是。我要是变成那么忙的人，我也会避轻就重。纵观这件事情，最要紧的点就是校长金口开了，答应了，才有了故事的后续。我并不觉得我做了多么了不起的事，我没有想象中的很努力的去争取这个机会，整天堵在校长办公室门口或怎样，寻找一个能面对面交流然后获得机会这样一个场景。我只不是在电脑前打了几行字而已。但既然要比赛了，我就努力吧。我之前基本上游泳因为场地，时间问题就没怎么游了。但还是要练，时间也挺紧张的，我当时在转塘凤凰创意园学影视后期制作，最近的游泳场所，我要去定安游泳馆，来回要三个多小时，但还是在有限的时间去了几次，在那里我遇到美院游泳队的漂亮姐姐，然后我就上去请她们指导，还有一个很有经验的老头，也请他指导我的动作，基本上一些技术性的小细节事临时改过来的。直到比赛当天上午，我还去游了1000米，但是我始终没有测试过800米到底多少成绩，然后有多大的底气。这里非常感谢陪伴我的一个朋友，赖志鹏，帮我记录了练习跳水的镜头。</p>
<p><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-04-06%20at%2010.24.26%20PM.png" alt="plunge"></p>
<hr>
<p>梦想还是要有的，万一实现了呢？-马云<br>最重要的是，要时刻准备着 -me火花</p>
<hr>
<h1 id="跟外界沟通"><a href="#跟外界沟通" class="headerlink" title="跟外界沟通"></a>跟外界沟通</h1><p>没有和记者朋友打过交道，但毕竟看过新闻，也知道一些舆论力量，所以在接到采访电话的时候，我几乎是不敢乱说话的，就怕好事被搅浑了，没见过大场面，hold不住这架势，没打过着交道，不知道里边是怎样的。一开始我还天真的什么都说，把自己知道的都说出来，但关键就在这，你不知道你自己知道的到底是不是真的，但媒体会信以为真。后来雷励CEO 陆丰老师还打电话过来，跟我聊了。之后我尽量只谈我自己的东西，关于组织的，学校的，我就告诉他们找官方。然后陆丰老师还要求我在记者发稿的时候要看一下最终稿有没有问题。</p>
<p><img src="http://onexs3cnv.bkt.clouddn.com/%E5%92%8Cgari%E5%90%88%E7%85%A7.jpg" alt="和gari合照"></p>
<p>毕竟我还承担着两方的某些利益，小心驶得万年船。还好这一环节没出什么大问题。不知道怎么放链接，我就不把新闻整理出来了。</p>
<p><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-04-06%20at%2010.33.22%20PM.png" alt="xinwen"><br><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-04-06%20at%2010.33.56%20PM.png" alt="pinglun"></p>
<hr>
<p>对所说的话负责。保证知道的都是权威的。</p>
<hr>
<h1 id="赛后"><a href="#赛后" class="headerlink" title="赛后"></a>赛后</h1><p>这又是我没想到的一个点。涉世未深。不过在我看来，这应该不是什么大问题，只是这种现象已经根深在人们印象中了。就是我到底该不该赢。这个问题是马后炮。因为，我事先也不知道校长的实力，校长也不知道我的实力，大家更不知道，体军部的老师也不知道。我只是一股脑的想赢，这样挑战也名正言顺。但是后来某些人说你不应该赢，我就方了，我不会做错事了吧，想想也是，我算哪根葱，校长给你面子了，你不给校长面子？我没想到这个问题，但其实在我比赛环节之前有一个老师对学生的接力友谊赛，算是热身赛，然后有队员说，老师让我们游慢一点，故意输。但我没想到我身上。想想赛后一个记者过来和我握手说，我没想到你会赢。这是看不起我还是？不过后来校领导开过会讨论过了，党组织部的老师说这样的结果是最好的，青出于蓝而胜于蓝，而且学校游泳队取得了不俗的成绩，比不过老师说不过去。各位，你们想想，我是个年轻人，体力上本来就占有一定的优势，校长58岁，还能保持这样的竞技状态，这样的生活态度，这才是重点。况且我赢的不多，才十几秒，我一点都没放水，要不是途中多次咬牙坚持，我还很又可能输。就凭这一点，我真的很佩服我们校长。</p>
<p><img src="http://onexs3cnv.bkt.clouddn.com/race.jpeg" alt="race"></p>
<p>不过我真是感受了一把受网络键盘侠攻击的滋味。</p>
<p><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-04-06%20at%2010.42.37%20PM.png" alt="personalattack"></p>
<p>辅导员也说，这些人很多的啊，不要管。但我想想，很大的原因，还是因为信息的不对称，媒体没有很好的做好中介，把事情原本的样子展现出来。</p>
<hr>
<p>但愿我不被规矩世俗束缚，追求本真</p>
<hr>
<p>最后谢谢钱江晚报的一个朋友，帮我做的一个简短的<a href="https://v.qq.com/x/page/l03065kvzrh.html" target="_blank" rel="external">视频</a>，记录这美妙的时刻。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;–update–&lt;br&gt;其实现在想想，可能当初会有更成熟的做法。&lt;/p&gt;
&lt;hr&gt;
    
    </summary>
    
      <category term="life" scheme="http://www.mmmmmcclxxvii.cn/categories/life/"/>
    
    
      <category term="life" scheme="http://www.mmmmmcclxxvii.cn/tags/life/"/>
    
      <category term="rock the boat" scheme="http://www.mmmmmcclxxvii.cn/tags/rock-the-boat/"/>
    
  </entry>
  
  <entry>
    <title>编码总结</title>
    <link href="http://www.mmmmmcclxxvii.cn/2016/10/04/encoding/"/>
    <id>http://www.mmmmmcclxxvii.cn/2016/10/04/encoding/</id>
    <published>2016-10-04T01:47:42.000Z</published>
    <updated>2017-04-10T04:25:35.000Z</updated>
    
    <content type="html"><![CDATA[<p>这篇很长！！！先看一下目录。</p>
<p>更新：</p>
<ul>
<li>python脚本文件的编码</li>
<li>添加vim编码的链接</li>
</ul>
<a id="more"></a>
<h1 id="问题的根源"><a href="#问题的根源" class="headerlink" title="问题的根源"></a>问题的根源</h1><p>因为计算机是二进制的，为了能在计算机上显示字符，又因为是电脑是美国人发明的，他们定义了字符表（ascii码表），也就是字符和数字的对应，比如在ascii码表中<code>65</code>表示<code>A</code>，这样就有一对一的映射关系，字符就能用数字表示了，那样计算机也就算懂得“文字”了。而ascii码表是用到了0~127这样一个范围，<code>0*** ****</code> 7位二进制，但是电脑普及之后，其他国家也想在电脑上显示自己的文字，因为一个字节是8位么，有些可以把8位中的最高位利用起来，定义一些其他字符，然后兼容ascii码，但是有些国家像中国，8位是远远不够的，所以就有了像gbk,gb2312这样的自己定义的一组字符编码表。后来国际上统一制定了一个叫unicode的字符编码表，能够包含<strong>所有</strong>国家的文字</p>
<p>那unicode到底是什么？<br>这里其实有好几个不同的概念</p>
<h1 id="不要混淆概念"><a href="#不要混淆概念" class="headerlink" title="不要混淆概念"></a>不要混淆概念</h1><ul>
<li>字符集(Abstract character repertoire)</li>
<li>编码字符集(Coded character set)</li>
<li>字符编码方式 (Character encoding form)</li>
<li>字符编码方案 (Character encoding scheme)</li>
</ul>
<h2 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h2><p>第一层，可以看作是抽象层，我就是我们人类的视角，看到的我们的语言的文字集合</p>
<blockquote>
<p>不同文字系统在记录信息上的能力是等价的。进一步讲，文字只是信息的载体，而非信息本身。不用文字，用其他的载体（数字）也可以存储同样意义的信息。<br>吴军《数学之美》</p>
</blockquote>
<h2 id="编码字符集"><a href="#编码字符集" class="headerlink" title="编码字符集"></a>编码字符集</h2><p>就是给抽象的字符编上数字，可以看作逻辑层。</p>
<blockquote>
<p>如gb2312中的定义的字符，每个字符都有个整数和它对应。一个整数只对应-着一个字符。反过来，则不一定是<br>这个说法有点模糊，反过来不一定是，是说在这个gb2312定义的字符中，一个字符能有多个整数对应，一个整数只对应一个字符的意思吗？一对多的关系？如果是这样，那没有意义啊，如果是因为在不同编码方式下，比如,这里只是假设打比方啊，在<code>a</code>编码表中，<code>&quot;中&quot;</code>对应<code>52</code>,在<code>b</code>编码中<code>&quot;中&quot;</code>对应<code>77</code>,这样说一个字符对应不同的整数还说的通，但是这样<code>77</code>在<code>a</code>中就能对应其他字符了，与一个整数只对应着一个字符在这个条件下也就矛盾了。所以我不知道这句话说的到底是什么意思</p>
</blockquote>
<p>但只需要知道这里所说的映射关系，<strong>是数学意义上的映射关系，编码字符集是与计算机无关的</strong>,<code>unicode</code>就在这一层</p>
<h2 id="字符编码方式"><a href="#字符编码方式" class="headerlink" title="字符编码方式"></a>字符编码方式</h2><p>记得组原里面的逻辑结构和存储结构的概念，这里的字符编码方式就对应着存储结构的这个概念，它是与计算机有关的</p>
<blockquote>
<p>通俗的说，意思就是怎么样才能将字符所对应的整数的放进计算机内存，或文件、或网络中。于是，不同人有不同的实现方式，所谓的万码奔腾，就是指这个。gb2312，utf-8,utf-16,utf-32等都在这一层。</p>
</blockquote>
<p>这里就有问题了，既然像unicode已经定义了文字对数字的对应了，那直接就那样存就行了？<br>too young, too simple， 不是那么简单。要考虑到存储空间，提一下，因为会有很多零，考虑到这些，所以逻辑形式和存储形式会不一样。下面详解</p>
<h2 id="字符编码方案"><a href="#字符编码方案" class="headerlink" title="字符编码方案"></a>字符编码方案</h2><blockquote>
<p>这个更加与计算机密切相关。具体是与操作系统密切相关。主要是解决大小字节序的问题。对于UTF-16和UTF-32编码，Unicode都支持big-endian 和 little-endian两种编码方案。一般来说，我们所说的编码，都在第三层完成（字符编码方式）。具体到一个软件系统中，则很复杂。浏览器－apache－tomcat（包括tomcat内部的jsp编码、编译，文件读取）－数据库之间，只要存在数据交互，就有可能发生编码不一致，如果在读取数据时，没有正确的decode和encode，出现乱码就是家常便饭了。</p>
</blockquote>
<p>我理解就是这一层就是考虑大端还是小端存储，这是和<strong>不同计算机</strong>具体设计所不同的。</p>
<h1 id="unicode"><a href="#unicode" class="headerlink" title="unicode"></a>unicode</h1><p>刚说了unicode是在第二层，只是理论上的，什么叫只是理论上的，它是理想的，他定义了字符与一个数字的关系，仅仅而此。他没有定义编码在电脑中的具体存储形式。<br>比如 <code>中</code> 对应是<code>4E2D 0100 1110 0010 1101</code>  它不就这样存着就好了么？ 不是这样的。<br>看<code>A</code> 是<code>41</code>,<code>0000 0000 0100 0001</code> 如果都按照这样直接存着，有一个问题就是太浪费资源了，8位还好，16位的话，有那么多个0，存储空间都浪费了，而且传输的时候也浪费不必要的带宽，所以这是理论上编码和具体实现的差别。在实际存储到计算机上要考虑其他因素，正是有这些因素，导致了<code>utf-8</code>，<code>utf-16</code>,<code>utf-32</code>等，基于<code>unicode</code>的编码方式。</p>
<p><strong>但有些编码不只是定义了影射关系，除了有字符集同时也包含了字符编码的含义，<strong>也就是这样定义的也是这样存的</strong>。如ASCII,GBK,GB2312等</strong>， unicode 只是定义了编码。没有定义怎么具体实现。</p>
<p>unicode 作为字符集(usc)是唯一的，编码方案(utf)才是有很多种。</p>
<p>也就是怎么存储，比如<code>中</code>，用的最多的是utf-8</p>
<h2 id="utf-8"><a href="#utf-8" class="headerlink" title="utf-8"></a>utf-8</h2><p><img src="http://onexs3cnv.bkt.clouddn.com/utf8.png" alt="utf-8"></p>
<p>具体<code>utf-8</code>是怎么和<code>unicode</code>对应不是这里的讨论重点，终点是<code>unicode</code>和<code>utf-8</code>的关系，<code>unicode</code>是理想的，虚浮的，<code>utf-8</code>才是真实的显示的。<code>unicode</code>是一个<code>code point</code>，他还是需要被表示成一个一个binary,这就需要encode.</p>
<blockquote>
<p>In Unicode, a letter maps to something called a code point which is still just a theoretical concept. How that code point is represented in memory or on disk is a whole nuther story.</p>
</blockquote>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-04-09%20at%209.46.29%20AM.png" alt="转化的例子"><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> sys</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>sys.stdin.encoding</div><div class="line"><span class="string">'UTF-8'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c = <span class="string">'中文'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c</div><div class="line"><span class="string">'\xe4\xb8\xad\xe6\x96\x87'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>cu = c.decode(<span class="string">'utf-8'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>cu</div><div class="line"><span class="string">u'\u4e2d\u6587'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>cu.encode(<span class="string">'gbk'</span>)</div><div class="line"><span class="string">'\xd6\xd0\xce\xc4'</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>It does not make sense to have a string without knowing what encoding it uses.</p>
</blockquote>
<p>这句话很重要。这里就先知道<code>c</code>这个字符串是由<code>utf-8</code>编码的。也就是计算机里面存的就是<code>\xe4\xb8\xad\xe6\x96\x87</code>对应的二进制。其实编码可以看作一个给<code>unicode</code>加密的过程,解码就是从字符串到<code>unicode</code>解密的过程。其实最终在计算机里只是一些<code>010101010</code>这样的数字，关键就是看你怎么看待它，怎么去翻译它的问题，翻译不正确就没有意义。</p>
<p><code>c</code> 是由<code>utf-8</code>来编码的，解码之后<code>unicode</code> code point 是<code>4e2d 6587</code>, 代表<code>&#39;中文&#39;</code>，再对它进行<code>gbk</code>编码，它则变成了<code>&#39;\xd6\xd0\xce\xc4&#39;</code>, 所以字符集在不同编码方式下可能对应的实际存储形式是不一样的。 但反过来。给你一串这个数字 ， 不知道它的编码方式是毫无意义的。<br>因为unicode定义了这个地球所有的字符和数字的映射关系，看作是一个“上层建筑”，一个蓝图，各个编码就是具体的施工，因为地形的原因，气候关系，各个国家根据这个蓝图都会有有些变动（这个例子不够好）。</p>
<p><strong>同一个<code>unicode</code>在不同编码下肯定是不一样的,但是不同的<code>unicode</code>在不同的编码下有可能是一样的</strong>。这个很容易验证，只要随便找个字符字节，<code>decode</code>一下，只要能<code>decode</code>出来，这个字节符合编码的格式，然后还原出来的<code>unicode</code>就是在那个编码下对应的<code>unicode</code>但是两者是相同的字节。下面有一个例子，看下面。<strong>所以，像<code>\xe9</code>这种给出不一定就是utf-8编码方式</strong>，有些只是刚好符合编码格式，但是不一定有意义。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>c.decode(<span class="string">'ascii'</span>)</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">  UnicodeDecodeError: <span class="string">'ascii'</span> codec can<span class="string">'t decode byte 0xe4 in position 0: ordinal not in range(128)</span></div></pre></td></tr></table></figure>
<p>因为<code>c</code>不是<code>utf-8</code>来编码的所以用<code>ascii</code>来“解密”这个逆过程是行不通的<br>当得到了<code>unicode</code>又可以用不同的“加密方式”加密了。</p>
<h1 id="python中的编码深入（python2）"><a href="#python中的编码深入（python2）" class="headerlink" title="python中的编码深入（python2）"></a>python中的编码深入（python2）</h1><p>首先明确<code>0x41</code>和<code>\x41</code>的区别<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0x41</span></div><div class="line"><span class="number">65</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>\x41</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span></div><div class="line">	\x41</div><div class="line">	   ^</div><div class="line">SyntaxError: unexpected character after line continuation character</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'\x41'</span></div><div class="line"><span class="string">'A'</span></div></pre></td></tr></table></figure></p>
<p><strong><code>0x41</code>是<code>numeric</code> ，<code>\x41</code>是 <code>character</code>，它只有在字符串中才有意义。 两者虽然在电脑中都是存着<code>01000001</code>,但是看待它的角度不一样。 </strong></p>
<h2 id="str类和unicode类"><a href="#str类和unicode类" class="headerlink" title="str类和unicode类"></a>str类和unicode类</h2><h2 id="str和unicode是两个不同的类"><a href="#str和unicode是两个不同的类" class="headerlink" title="str和unicode是两个不同的类"></a><strong><code>str</code>和<code>unicode</code>是两个不同的类</strong></h2><p>在python的REPL中，类似<code>w = &#39;{whatever}&#39;</code>，这样给出的，代表w是一个<code>str</code>，</p>
<blockquote>
<p><strong>str hold bytes ! str hold bytes ! str hold bytes !</strong><br><strong>str 存储的是已经编码后的字节序列，输出是看到每个字节用16进制表示，以<code>\x</code>开头，每个汉字会占用3个字节的长度。</strong></p>
<p>str is string of bytes<br>unicode is string of unicode character</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>c=<span class="string">'中文'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c</div><div class="line"><span class="string">'\xe4\xb8\xad\xe6\x96\x87'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>cu=<span class="string">u'中文'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>cu</div><div class="line"><span class="string">u'\u4e2d\u6587'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> c</div><div class="line">中文</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> cu</div><div class="line">中文</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>len(c)</div><div class="line"><span class="number">6</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>len(cu)</div><div class="line"><span class="number">2</span></div></pre></td></tr></table></figure>
<p><code>cu=u&#39;中文&#39;</code>表示<code>cu</code>的编码指定为<code>unicode</code>了。这个是python的内部编码。<br><strong>我现在有一个疑问，那这个<code>cu</code>在内存中保存的是什么样的？？？</strong> [Todo]</p>
<p><strong>一个以bytes 为单位，一个以unicode character 为单位</strong></p>
<blockquote>
<p>Unicode started out using 16-bit characters instead of 8-bit characters.!!!</p>
</blockquote>
<p>我的理解是<br><code>len(cu) == 2</code> 表示<code>cu</code>里面有2个code point<br><code>len（c) == 6</code> 表示<code>c</code>有6个bytes</p>
<h2 id="那这里就有两个问题了"><a href="#那这里就有两个问题了" class="headerlink" title="那这里就有两个问题了"></a>那这里就有两个问题了</h2><h3 id="x-str存储已经编码后的字节序列，是用什么编码？？"><a href="#x-str存储已经编码后的字节序列，是用什么编码？？" class="headerlink" title="-[x] str存储已经编码后的字节序列，是用什么编码？？"></a>-[x] str存储已经编码后的字节序列，是用什么编码？？</h3><p>从键盘上按下到屏幕上显示的这一步我们先不管，我猜想是涉及到键盘的工作原理<strong><a href="http://hsmaterial.moe.edu.tw/file/computer/7I44/class800/7I44/final/7i44_2_4/7i44_2_4.htm" target="_blank" rel="external">Todo</a></strong>和输入法的原理<strong>[Todo]</strong>,改天再把这一块补上，现在先就关注再python内部的编码。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>sys.stdin.encoding</div><div class="line"><span class="string">'UTF-8'</span></div></pre></td></tr></table></figure></p>
<p>是默认用<code>sys.stdin.encoding</code>来编码输入的字符。</p>
<p>说到这里，python中有好几个有关编码的函数或值</p>
<ul>
<li>sys.stdin.encoding</li>
<li>sys.stdout.encoding</li>
<li>sys.getdefaultencoding()</li>
<li>sys.getfilesystemencoding()</li>
</ul>
<p>各自的用处都不一样<br><img src="http://onexs3cnv.bkt.clouddn.com/python%E7%BC%96%E7%A0%81.png" alt="encoding in python"></p>
<h3 id="w＝-39-中文-39-是需要编码一下的-用utf-8那这样-w-39-xe9-39-也要先utf-8编码？"><a href="#w＝-39-中文-39-是需要编码一下的-用utf-8那这样-w-39-xe9-39-也要先utf-8编码？" class="headerlink" title="-[] w＝&#39;中文&#39; 是需要编码一下的 用utf-8那这样 w = &#39;\xe9&#39;也要先utf-8编码？"></a>-[] <code>w＝&#39;中文&#39;</code> 是需要编码一下的 用<code>utf-8</code>那这样 <code>w = &#39;\xe9&#39;</code>也要先<code>utf-8</code>编码？</h3><p>这个我还不清楚，因为不可能一个不编码，一个编码，应该是统一的形式，但是对<code>\xe9</code>进行<code>utf-8</code>的编码是不行的因为对于但字节的，<code>utf-8</code>是高位是<code>0</code>开头的，所以这个不可能用<code>utf-8</code>编码成功，所以我猜测是因为<code>\x</code>,有这个，直接以字节码的形式传入进来了不用编码了。</p>
<h2 id="print"><a href="#print" class="headerlink" title="print"></a>print</h2><p>当做<code>print c</code>的时候，会把<code>c</code>的byte string， 也就是字节流传到终端，终端接受到这一组字节流要用终端的编码来解码这个字节流（毕竟不是字符集，传送过来的只是编码方式，所以找字符对应关系还得还原），这样就又回到了<code>unicode</code>的形式，然后接下来就是<a href="Todo">字符怎么显示到计算机屏幕上的问题了</a></p>
<h3 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>c = <span class="string">'中文'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c.decode(<span class="string">'utf-8'</span>)</div><div class="line"><span class="string">u'\u4e2d\u6587'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c.decode(<span class="string">'utf-8'</span>).encode(<span class="string">'gb2312'</span>)</div><div class="line"><span class="string">'\xd6\xd0\xce\xc4'</span></div></pre></td></tr></table></figure>
<p>我在iTerm下先把Terminal的Character Encoding改为<code>GB 2312</code><br><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-04-10%20at%208.03.38%20AM.png" alt="change terminal encoding"><br>可以看到结果是被正确打印出来<br><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-04-10%20at%208.05.13%20AM.png" alt="correct result"><br>但当我把编码随便改成另外国家的<br><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-04-10%20at%208.08.30%20AM.png" alt="other encoding"><br>然后再打印的时候就不对了<br><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-04-10%20at%208.09.04%20AM.png" alt="wrong result"><br>但是！ <code>cg</code>里面保存是一样的</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-04-10%20at%208.10.14%20AM.png" alt="cg"></h2><p>这也就是说当你终端的编码和在python中处理字符的编码不一致的时候，打印结果可能出现问题。之所以是可能，因为如果都是英文的话，因为都兼容ascii码,所以会打印出你想要看到的样子。</p>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>cg = <span class="string">'\xd6\xd0\xce\xc4'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>cg.decode(<span class="string">'iso 8859-11'</span>)</div><div class="line"><span class="string">u'\u0e36\u0e30\u0e2e\u0e24'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>cg.decode(<span class="string">'gb2312'</span>)</div><div class="line"><span class="string">u'\u4e2d\u6587'</span></div></pre></td></tr></table></figure>
<p>这里就是不同<code>unicode</code>在不同的编码下有着相同的字节的例子<br>然后<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>cg.decode(<span class="string">'iso 2022-jp'</span>)</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">  UnicodeDecodeError: <span class="string">'iso2022_jp'</span> codec can<span class="string">'t decode byte 0xd6 in position 0: illegal multibyte sequence</span></div></pre></td></tr></table></figure></p>
<p>上面那个能对<code>iso 8859-11</code>解码也只是凑巧，这个对<code>iso 2022-jp</code>就不行。</p>
<h3 id="实验2"><a href="#实验2" class="headerlink" title="实验2"></a>实验2</h3><p>如果是<code>print</code>一个unicode对象的话<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>cgt = cg.decode(<span class="string">'iso 8859-11'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> cgt</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">  UnicodeEncodeError: <span class="string">'ascii'</span> codec can<span class="string">'t encode characters in position 0-3: ordinal not in range(128)</span></div></pre></td></tr></table></figure></p>
<p>看着样子好像是要转化成字节流传送到终端再解码。那这样不会出现什么问题么？<br>因为<code>unicode</code>的code point和字符之间是一一对应的，我编码成<code>utf-8</code>也好，<code>gbk</code>也好，其他什么的也好，只要能编成，我只是用它做个过度，我只需确保解码的时候用的是一致的编码的就行了，现在这里的问题就是<code>ascii</code>码不能编成，因为格式不支持。这个<code>ascii</code>应该是<code>sys.getdefaultencoding()</code>的。<br>以下终端编码是<code>utf-8</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>cgt = cg.decode(<span class="string">'iso 8859-11'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>cgt.encode(<span class="string">'utf-8'</span>)</div><div class="line"><span class="string">'\xe0\xb8\xb6\xe0\xb8\xb0\xe0\xb8\xae\xe0\xb8\xa4'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">'\xe0\xb8\xb6\xe0\xb8\xb0\xe0\xb8\xae\xe0\xb8\xa4'</span></div><div class="line">ะฮฤ</div></pre></td></tr></table></figure></p>
<p>这个显示的不知道是不是一致的，看着又像又不像，少了一个点貌似，到底对不对？？</p>
<h2 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h2><h3 id="读文件，文件的编码"><a href="#读文件，文件的编码" class="headerlink" title="读文件，文件的编码"></a>读文件，文件的编码</h3><p>现在我先建立一个<code>gbk.txt</code>的文件，在vim中<code>:set fileencoding=gbk</code>,有关vim中的编码<a href="Todo">看这里</a><br>输入内容<code>我叫陈烨</code>保存。<br>先看一下<code>utf-8</code>的编码长什么样，<code>gbk</code>编码长什么样<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>c = <span class="string">'我叫陈烨'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c</div><div class="line"><span class="string">'\xe6\x88\x91\xe5\x8f\xab\xe9\x99\x88\xe7\x83\xa8'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c.decode(<span class="string">'utf-8'</span>).encode(<span class="string">'gbk'</span>)</div><div class="line"><span class="string">'\xce\xd2\xbd\xd0\xb3\xc2\xec\xc7'</span></div></pre></td></tr></table></figure></p>
<p>然后读取文件<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>f = open(<span class="string">'gbk.txt'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>fr = f.read()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>fr</div><div class="line"><span class="string">'\xce\xd2\xbd\xd0\xb3\xc2\xec\xc7\n'</span></div></pre></td></tr></table></figure></p>
<p>可以看出，我保存的是<code>gbk</code>编码格式，现在读入的也是<code>gbk</code>编码的格式，因为计算机他操作的就在“第三层”（这里先忽略第四层）所以，<strong>如果我不知道原来文件的编码是什么，直接操作文件内容也是没有意义的</strong>，只是现在大部分都是<code>utf-8</code>，一切都恰好行的通，等出现乱码的时候就应该知道是编码出现问题了。</p>
<h3 id="读文件，文件内容的操作"><a href="#读文件，文件内容的操作" class="headerlink" title="读文件，文件内容的操作"></a>读文件，文件内容的操作</h3><p>现在我建立一个文件叫做wr.TARIN  , 这是里面的内容是<br><code>你好 中国 Hello China 1 2 3</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> sys</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>sys.getfilesystemencoding()</div><div class="line"><span class="string">'utf-8'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>f = open(<span class="string">'wr.TRAIN'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>content=f.readline()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>content</div><div class="line"><span class="string">'\xe4\xbd\xa0\xe5\xa5\xbd \xe4\xb8\xad\xe5\x9b\xbd Hello China 1 2 3\n'</span></div></pre></td></tr></table></figure></p>
<p>这个<code>sys.getfilesystemencoding()</code>是不是用来文件解码的还不清楚！！！【Todo】<br>文件都是以字节流的方式读进来的？  但不管怎么样，读进来的是一段字符串，重点是你怎么看，都是这样的01010的数字，关键在于怎么翻译，所以要知道它文件原来的编码方式。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>content_list = content.split()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>content_list</div><div class="line">[<span class="string">'\xe4\xbd\xa0\xe5\xa5\xbd'</span>, <span class="string">'\xe4\xb8\xad\xe5\x9b\xbd'</span>, <span class="string">'Hello'</span>, <span class="string">'China'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> content</div><div class="line">你好 中国 Hello China <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> content_list</div><div class="line">[<span class="string">'\xe4\xbd\xa0\xe5\xa5\xbd'</span>, <span class="string">'\xe4\xb8\xad\xe5\x9b\xbd'</span>, <span class="string">'Hello'</span>, <span class="string">'China'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> content_list[<span class="number">0</span>]</div><div class="line">你好</div></pre></td></tr></table></figure></p>
<p>那这里就有一个问题，为什么<code>print content_list</code>显示的是以这样的形式，而不是<br><code>[&#39;你好&#39;,&#39;中国&#39;,&#39;Hello&#39;,&#39;China&#39;,&#39;1&#39;,&#39;2&#39;,&#39;3&#39;]</code><br>这样子？<br>这其实是两个问题。<code>content_list</code>是<code>list</code>类型，它不是一个<code>str</code>！！！<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>l = [<span class="string">'中文'</span>,<span class="string">'你好'</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>l</div><div class="line">[<span class="string">'\xe4\xb8\xad\xe6\x96\x87'</span>, <span class="string">'\xe4\xbd\xa0\xe5\xa5\xbd'</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> l</div><div class="line">[<span class="string">'\xe4\xb8\xad\xe6\x96\x87'</span>, <span class="string">'\xe4\xbd\xa0\xe5\xa5\xbd'</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> str(l)</div><div class="line">[<span class="string">'\xe4\xb8\xad\xe6\x96\x87'</span>, <span class="string">'\xe4\xbd\xa0\xe5\xa5\xbd'</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>str(l)</div><div class="line"><span class="string">"['\\xe4\\xb8\\xad\\xe6\\x96\\x87', '\\xe4\\xbd\\xa0\\xe5\\xa5\\xbd']"</span></div></pre></td></tr></table></figure></p>
<p>在打印<code>list</code>类型的时候，会先把<code>list</code>转为<code>str</code>，这样就发现<code>\x</code>编程了<code>\\x</code>，相当于<code>\xe4</code>原本表示编码的，被当成字符串处理了，说了一切看你怎么看的问题。<br>但其实本来是<code>list</code>转为字符串格式的话，会调用<code>repr</code>来转化，但是效果是和<code>str</code>是一样的。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>repr(l)</div><div class="line"><span class="string">"['\\xe4\\xb8\\xad\\xe6\\x96\\x87', '\\xe4\\xbd\\xa0\\xe5\\xa5\\xbd']"</span></div></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>lc = <span class="string">','</span>.join(l)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> lc</div><div class="line">中文,你好</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>lc</div><div class="line"><span class="string">'\xe4\xb8\xad\xe6\x96\x87,\xe4\xbd\xa0\xe5\xa5\xbd'</span></div></pre></td></tr></table></figure>
<p>但是如果想要有<code>[...]</code>的效果怎么办<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> str(l).decode(<span class="string">'string_escape'</span>)</div><div class="line">[<span class="string">'中文'</span>, <span class="string">'世界'</span>]</div></pre></td></tr></table></figure></p>
<p><code>string_escape</code>是转义字符<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>repr(l)</div><div class="line"><span class="string">"['\\xe4\\xb8\\xad\\xe6\\x96\\x87', '\\xe4\\xbd\\xa0\\xe5\\xa5\\xbd']"</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>repr(l).decode(<span class="string">'string_escape'</span>)</div><div class="line"><span class="string">"['\xe4\xb8\xad\xe6\x96\x87', '\xe4\xbd\xa0\xe5\xa5\xbd']"</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">"['\xe4\xb8\xad\xe6\x96\x87', '\xe4\xbd\xa0\xe5\xa5\xbd']"</span></div><div class="line">[<span class="string">'中文'</span>, <span class="string">'你好'</span>]</div></pre></td></tr></table></figure></p>
<p>也就是相当于把<code>\\x</code>还原回<code>\x</code>了的一步操作。如果已经是<code>\x</code>再这样弄，没什么效果。</p>
<h3 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a>写入文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">','</span>.join(content_list)</div><div class="line"><span class="string">'\xe4\xbd\xa0\xe5\xa5\xbd,\xe4\xb8\xad\xe5\x9b\xbd,Hello,China,1,2,3'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>fw = open(<span class="string">'out.TEST'</span>,<span class="string">'w'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>fw.write(<span class="string">','</span>.join(content_list))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>fw.close()</div></pre></td></tr></table></figure>
<p><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202016-10-04%20at%209.11.11%20PM.png" alt="file_out"></p>
<p>还可以用<code>unicode</code>统一来处理文本，不过在写入文件时，还是要转换为“第三层”的格式，毕竟<code>unicode</code>是虚浮的！！！<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>fw=open(<span class="string">'out.TEST'</span>,<span class="string">'w'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>content_u_list_conjunction = <span class="string">','</span>.join(content_u_list)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>content_u_list_conjunction</div><div class="line"><span class="string">u'\u4f60\u597d,\u4e2d\u56fd,Hello,China,1,2,3'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>fw.write(content_u_list_conjunction)</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">UnicodeEncodeError: <span class="string">'ascii'</span> codec cant encode characters <span class="keyword">in</span> position <span class="number">0</span><span class="number">-1</span>: ordinal <span class="keyword">not</span> <span class="keyword">in</span> range(<span class="number">128</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>fw.write(content_u_list_conjunction.encode(<span class="string">'utf-8'</span>)) <span class="comment">#要指定encode编码，不然用默认的</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>fw.close()</div></pre></td></tr></table></figure></p>
<p>这个默认的应该就是<code>sys.getdefaultencoding()</code>指定的吧。</p>
<h2 id="python-脚本文件的编码"><a href="#python-脚本文件的编码" class="headerlink" title="python 脚本文件的编码"></a>python 脚本文件的编码</h2><p>经常可以看到一些<code>.py</code>文件的头两行是怎么写的<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env/python</span></div><div class="line"><span class="comment"># coding=utf-8</span></div><div class="line"><span class="comment"># 或</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>If a comment in the first or second line of the Python script matches the regular expression coding[=:]\s*([-\w.]+), this comment is processed as an encoding declaration; the first group of this expression names the encoding of the source code file. The encoding declaration must appear on a line of its own. If it is the second line, the first line must also be a comment-only line. The recommended forms of an encoding expression are</p>
<p><code># -*- coding: &lt;encoding-name&gt; -*-</code><br>from <a href="https://docs.python.org/2.7/reference/lexical_analysis.html#encoding-declarations" target="_blank" rel="external">Encoding declarations</a></p>
<p>Python will default to ASCII as standard encoding if no other encoding hints are given.<br>from <a href="https://www.python.org/dev/peps/pep-0263/" target="_blank" rel="external">PEP 263 – Defining Python Source Code Encodings</a></p>
</blockquote>
<p>如果没有指定，脚本默认会用ascii码来解析文件内容，这时如果遇到有中文的，那就会报错<br><img src="http://onexs3cnv.bkt.clouddn.com/Screen%20Shot%202017-04-10%20at%2011.30.09%20AM.png" alt="without specific encoding"></p>
<p>还有一些<a href="https://www.python.org/dev/peps/pep-0263/#id9" target="_blank" rel="external">example</a></p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ol>
<li><a href="http://www.joelonsoftware.com/articles/Unicode.html" target="_blank" rel="external">The Absolute Minimum Every Software Developer Absolutely, Positively Must Know About Unicode and Character Sets (No Excuses!)</a></li>
<li><a href="http://www.51testing.com/html/63/524463-817888.html" target="_blank" rel="external">python新手必碰到的问题—encode与decode，中文乱码</a></li>
<li><a href="http://noalgo.info/571.html" target="_blank" rel="external">字符编码详解</a></li>
<li><a href="https://docs.python.org/2/howto/unicode.html" target="_blank" rel="external">Unicode HOWTO</a></li>
<li><a href="http://stackoverflow.com/questions/16903192/meaning-of-0x-and-x-in-python-hex-strings" target="_blank" rel="external">Meaning of 0x and \x in python hex strings?</a></li>
<li><a href="http://unicode-table.com/en/#00E9" target="_blank" rel="external">unicode-table</a></li>
<li><a href="http://stackoverflow.com/questions/2596714/why-does-python-print-unicode-characters-when-the-default-encoding-is-ascii/21968640#21968640" target="_blank" rel="external">Why does Python print unicode characters when the default encoding is ASCII?</a></li>
<li><a href="http://stackoverflow.com/questions/24832335/len-with-unicode-strings" target="_blank" rel="external">len() with unicode strings</a></li>
<li><a href="http://stackoverflow.com/questions/5695714/python-len-and-slices-on-unicode-strings" target="_blank" rel="external">Python, len and slices on unicode strings</a></li>
<li><a href="http://stackoverflow.com/questions/39835779/lenunicode-string#39835844" target="_blank" rel="external">len(unicode string)</a></li>
<li><a href="http://blog.csdn.net/huxian370/article/details/51145926" target="_blank" rel="external">Python 2.7 解决写入文件的中文乱码问题</a></li>
<li><a href="http://stackoverflow.com/questions/39807985/python-write-file-dealing-with-encode" target="_blank" rel="external">python write file dealing with encode</a></li>
<li><a href="http://nedbatchelder.com/text/unipain.html" target="_blank" rel="external">Pragmatic Unicode</a></li>
<li><a href="http://noalgo.info/578.html" target="_blank" rel="external">Python编程的中文问题</a></li>
</ol>
<hr>
<p>1,2,4,7,13,14 推荐要看一下</p>
<hr>
<h2 id="一些重要的摘出来"><a href="#一些重要的摘出来" class="headerlink" title="一些重要的摘出来"></a>一些重要的摘出来</h2><h3 id="4"><a href="#4" class="headerlink" title="4"></a>4</h3><blockquote>
<p>The Unicode standard describes how characters are represented by code points. A code point is an integer value, usually denoted in base 16. In the standard, a code point is written using the notation <code>U+12ca</code> to mean the character with value <code>0x12ca</code> (4810 decimal). The Unicode standard contains a lot of tables listing characters and their corresponding code points:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; 0061    &apos;a&apos;; LATIN SMALL LETTER A</div><div class="line">&gt; 0062    &apos;b&apos;; LATIN SMALL LETTER B</div><div class="line">&gt; 0063    &apos;c&apos;; LATIN SMALL LETTER C</div><div class="line">&gt; ...</div><div class="line">&gt; 007B    &apos;&#123;&apos;; LEFT CURLY BRACKET</div><div class="line">&gt;</div></pre></td></tr></table></figure></p>
<p><strong>Strictly, these definitions imply that it’s meaningless to say ‘this is character U+12ca’. U+12ca is a code point, which represents some particular character; in this case, it represents the character ‘ETHIOPIC SYLLABLE WI’. In informal contexts, this distinction between code points and characters will sometimes be forgotten.</strong></p>
<p><strong>A character is represented on a screen or on paper by a set of graphical elements that’s called a glyph. The glyph for an uppercase A, for example, is two diagonal strokes and a horizontal stroke, though the exact details will depend on the font being used. Most Python code doesn’t need to worry about glyphs; figuring out the correct glyph to display is generally the job of a GUI toolkit or a terminal’s font renderer.</strong></p>
<p>a Unicode string is a sequence of code points, which are numbers from 0 to 0x10ffff. This sequence needs to be represented as a set of bytes (meaning, values from 0-255) in memory. The rules for translating a Unicode string into a sequence of bytes are called an encoding.</p>
</blockquote>
<h3 id="12"><a href="#12" class="headerlink" title="12"></a>12</h3><p>There are many encodings and they define 128-255 differently.</p>
<blockquote>
<p>For example, character 185 (0xB9) is ą in windows-1250 encoding, but it is š in iso-8859-2 encoding.<br>So, what happens if you print \xb9? It depends on the encoding used in the console. In my case (my console uses cp852 encoding) it is:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; &gt;&gt;&gt; <span class="keyword">print</span> <span class="string">'\xb9'</span></div><div class="line">&gt; ╣</div><div class="line">&gt;</div></pre></td></tr></table></figure></p>
<p><strong>Because of that ambiguity, string ‘\xb9’ will never be represented as ‘╣’ (nor ‘ą’…). That would hide the true value. </strong> (这里解释了为什么用<code>\xb9</code>这样字节来保存，而不打印出来实际的字符)It will be represented as the numeric value:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; &gt;&gt;&gt; <span class="string">'\xb9'</span></div><div class="line">&gt; <span class="string">'\xb9'</span></div><div class="line">&gt; <span class="comment">#Also:</span></div><div class="line">&gt; &gt;&gt;&gt; <span class="string">'╣'</span></div><div class="line">&gt; <span class="string">'\xb9'</span></div><div class="line">&gt;</div></pre></td></tr></table></figure></p>
<p><strong>But what happens if variable is just entered in the console?When a variable is enteren in cosole without print, its representation is printed.</strong> It is the same as the following:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; &gt;&gt;&gt; <span class="keyword">print</span> repr(content)</div><div class="line">&gt; <span class="string">'\xe4\xbd\xa0\xe5\xa5\xbd \xe4\xb8\xad\xe5\x9b\xbd Hello China 1 2 3\n'</span></div><div class="line">&gt;</div></pre></td></tr></table></figure></p>
<p>Unlike str objects, which are strings of bytes, unicode objects are strings of unicode characters<br>characters != bytes. a utf16 character is 2 bytes, but only one character</p>
</blockquote>
<h3 id="14"><a href="#14" class="headerlink" title="14"></a>14</h3><blockquote>
<p>内置的open()方法打开文件时，read()读取的是str，读取后需要使用正确的编码格式进行decode()。write()写入时，如果参数是unicode，则需要使用你希望写入的编码进行encode()，如果是其他编码格式的str，则需要先用该str的编码进行decode()，转成unicode后再使用写入的编码进行encode()。如果直接将unicode作为参数传入write()方法，Python将先使用源代码文件声明的字符编码进行编码然后写入。</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这篇很长！！！先看一下目录。&lt;/p&gt;
&lt;p&gt;更新：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;python脚本文件的编码&lt;/li&gt;
&lt;li&gt;添加vim编码的链接&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="砍树人" scheme="http://www.mmmmmcclxxvii.cn/categories/%E7%A0%8D%E6%A0%91%E4%BA%BA/"/>
    
    
      <category term="python" scheme="http://www.mmmmmcclxxvii.cn/tags/python/"/>
    
      <category term="encode" scheme="http://www.mmmmmcclxxvii.cn/tags/encode/"/>
    
      <category term="unicode" scheme="http://www.mmmmmcclxxvii.cn/tags/unicode/"/>
    
      <category term="utf-8" scheme="http://www.mmmmmcclxxvii.cn/tags/utf-8/"/>
    
  </entry>
  
  <entry>
    <title>【转】如何从菜鸟程序员成长为高手</title>
    <link href="http://www.mmmmmcclxxvii.cn/2015/04/07/rookie-to-master/"/>
    <id>http://www.mmmmmcclxxvii.cn/2015/04/07/rookie-to-master/</id>
    <published>2015-04-07T08:00:02.000Z</published>
    <updated>2015-04-07T08:00:02.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://codecloud.net/4128.html" target="_blank" rel="external">原文链接</a></p>
<p>下面这篇优秀的文章来自Axb的自我修养，写得很直白、很真实，很有营养，分享在这里与君共勉！<br>口头禅</p>
<blockquote>
<p>这其实是两个问题 （不要混淆概念）<br>还有没有更好的方案 （不要思维局限）<br>能不能举个例子 （理论实际相结合）<br>能不能给个一句话总结 （说明自己掌握了重点）</p>
</blockquote>
<a id="more"></a>
<h1 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h1><p>最近有一些毕业不久的同事问我：“你工作的时候有没有什么窍门？怎么才能快速成为高手？”</p>
<p>想起当初刚入职，新人培训的时候，也跟其他同事讨论过这个问题：如何才能成为业界大牛？当时自己只是觉得兴趣是最好的老师，思路方法什么的没有多想。</p>
<p>加入微博平台架构部的时间也不短了，趁着快过春节总结了一下自己入职微博以来的工作情况，从互联网开发的半个门外汉，到如今能设计一些架构、排查一些问题、分享一些经验，收获颇多，感想颇多,也逐渐意识到思路和方法的重要性，在此跟大家分享一下。主要分为学、做、想三方面。</p>
<h1 id="学会学习"><a href="#学会学习" class="headerlink" title="学会学习"></a>学会学习</h1><p>学习无疑是程序员最为重要的素质之一，尤其是互联网这种日新月异的行业，把学习当做工作的一大半也不为过。</p>
<h2 id="自主学习"><a href="#自主学习" class="headerlink" title="自主学习"></a>自主学习</h2><p>最近发现身边的人并不是不想学习，只是每天都在纠结自己到底学什么好：简单的没挑战，复杂的看不懂；旧技术怕过时，新技术没方向……</p>
<p>讲讲自己毕业后的经历，毕业之后去了个不大不小的公司，工作主要是做一些XX管理系统之类的东西，没什么挑战，也用不上什么技术，基本上前端用个extjs后面套个sql server就解决了。工作稳定了几年，业余时间除了wow没别的事情做，觉得这么闲下去不是办法，于是之后一年的时间里，用上班摸鱼和下班休息的时间学了这些东西：</p>
<ul>
<li>闲着无聊想做个小游戏，发现游戏相关的书大多是英文的，看不懂，一咬牙翻译了《Real-time rending 3rd》的前几章，刚开始前言都看不懂，只能一个词一个词的翻字典，一句话要琢磨几个钟头到底作者说的到底是什么意思。翻译了几百页英文书之后，发现自己看英文书没什么障碍了，于是开始每天用休息和摸鱼的时间看书。</li>
<li>看完游戏引擎的书之后，把irrlicht引擎的代码看了一遍，然后自己山寨了一个3d渲染的场景管理器，还有个朴素的渲染引擎。</li>
<li>给自己的游戏引擎写了个基于脚本语言的解释器，为此看了不少编译原理和虚拟机的书，了解了程序究竟是什么东西，这是我觉得收益很大的一件事情。</li>
<li>看编译原理的书的时候发现操作系统的知识有些欠缺，又去看了<a href="http://codecloud.net/?s=linux" target="_blank" rel="external">linux内核</a>相关的书。之后买了个开发板天天修改内核玩，毕业以后又一次了解了内核的cpu调度、内存管理和文件系统，了解了应用是怎么跑在操作系统上，操作系统又是怎么运行在硬件上的，这也是收益很大的一件事情。</li>
<li>看完操作系统又顺着看网络相关的书，之后把lighthttpd的代码看了一遍，用c写了个<a href="http://codecloud.net/?s=linux" target="_blank" rel="external">linux</a>下的http服务器，把几种网络编程模型挨个实现了一遍。</li>
<li>实现<a href="http://codecloud.net/?s=http" target="_blank" rel="external">http</a>服务器的过程中觉得自己编码能力还是有欠缺，把代码大全翻了一遍，顺着又去看了设计模式的书，并且用自己的理解把每个模式用文字重新描述了一遍。</li>
<li>中间还看了很多语言和框架相关的书，就不一一列举了。</li>
</ul>
<p>我把学习的方向分为三类：</p>
<ol>
<li>为了工作，满足当前工作所必备的知识</li>
<li>为了提升，与当前工作相关的知识（深度）</li>
<li>拓展视野，与当前工作无关的知识（广度）</li>
</ol>
<p>学习（1）之后只是个熟练工，2和3才是提升自己的途径，伴随着知识储备的提升，接触新事物时更容易找到相似的知识加以类比，加快理解，也更容易掌握本质。如果每天都在纠结“到底学什么”，那么只能说明还是学的太少了。（真正没什么可学的大牛们应该不会读到这里吧……）</p>
<p>所以，如果觉着没什么东西可以学的时候，那么可以考虑一下学一下更有深度的知识（比如虚拟机或编译器），或者完全不同的知识（新的语言或当前比较火的方向），甚至完全不相干的知识（单纯练习英文阅读，学习ppt排版之类）吧。随着知识储备增加，自己的不足和未来的学习的方向也会更加明确起来。</p>
<h2 id="向历史学习"><a href="#向历史学习" class="headerlink" title="向历史学习"></a>向历史学习</h2><p>以微博为例，在微博发展的过程中经历了不少波折，并逐渐衍生出了目前的系统架构。很多新人最喜欢问的问题便是“现在线上是怎么做的？”</p>
<p>这个问题不错，但是还不够好。在程序员的世界里罕有能解决所有问题的“银弹”，当前的做法用不了多久也会被替换掉，如果想了解一件事情，那么就多关注一下“它是怎么变成今天这样的”吧。学会用发展的眼光看问题，了解一些经历过的经验教训，收获会比单纯学会一件什么事情多的多。</p>
<p>那么，如何向历史学习？</p>
<ul>
<li>公司内部的资料库、wiki等大都会有旧时的资料，刚入职时大多不会太忙，这些资料库简直是挖不完的宝藏</li>
<li>部门内部分享，比如我当初入职时经常去听“微博XXXX架构演化历程”之类的内部分享</li>
<li>多问一下自己”它为什么不那么设计</li>
<li>老员工忆苦思甜吹牛逼的时候多奉承几句</li>
</ul>
<h2 id="向他人学习"><a href="#向他人学习" class="headerlink" title="向他人学习"></a>向他人学习</h2><p>这里有两个极端，</p>
<ul>
<li>有的人喜欢自己闷头捣鼓，什么也不问，这必然是不利于自己提高的；</li>
<li>也有人碰到问题就问，这也有问题，浪费他人时间不说，更关键的是说明这人向他人学习的思路错了，要学习他人的并不是具体某个知识（要学知识看书就能解决了），而是学习别人的思维方式。</li>
</ul>
<p>但是思维方式这种东西很难通过交流的方式学到，后来我发现有个很简单的学习方式：口头禅。举几个例子，大家体会一下：</p>
<ul>
<li>“这个其实是两个问题”</li>
<li>“有没有更好的方案”</li>
<li>“能不能举个例子”</li>
<li>“能不能给个一句话总结”<br>除了口头禅，很多牛人都会有非常鲜明的思维方式和处事原则，如果有幸与业界的大牛共事，那么恭喜你，只要多交流、多观察、多思考，那么提升速度会提升好几个数量级。</li>
</ul>
<h1 id="多做有意义的事情"><a href="#多做有意义的事情" class="headerlink" title="多做有意义的事情"></a>多做有意义的事情</h1><p>有的人每天时间浪费在跟问题本身无关的事情上，比如我要设计架构的时候还要考虑架构图怎么画，写完代码还要反复部署测试好几轮才pass，查bug的时候把时间浪费在扫日志上。人的精力总是有限的，把时间浪费在这些事情上面，让自己提高的时间就变得少了。</p>
<h2 id="练习，更多的练习"><a href="#练习，更多的练习" class="headerlink" title="练习，更多的练习"></a>练习，更多的练习</h2><p>这里有个误区：“做有意义的事情”不等于“只做自己没做过的事情”。</p>
<p>对于程序员来说，写代码是基本功中的基本功，编码的规范、设计的权衡、甚至顺手的IDE快捷键都要靠平日的试错和积累，很难通过几本书或者几天培训领悟到。</p>
<p>曾经目睹一些人写代码一年之后开始做一些小项目的设计，然后就迫不及待的把重心全都转移到设计甚至架构上，这种没有基础能力支撑做出的设计和架构最多只能算是高级意淫，大多没等落地就荒废了，意义不大。究其原因，大多是设计出来的东西“不好做”或者“不好用”，就像是只看过一遍课本就去参加高数考试，现实吗？（学霸们我错了……）</p>
<p>举个例子，几年前在看设计模式的过程中，用qt做了个看漫画的应用，把能用的模式都试了一遍，当然有很多用的不合适的地方，正是这些不合适的地方让我对面向对象编程和设计模式的思考深入了很多，如何权衡灵活性和复杂性也有了新的认识。之后在设计很多系统的时候少走了很多弯路，既保证了时间点又保证了质量。如果当时指望着“用的时候再说”，大概已经被项目坑的不能自理了。</p>
<h2 id="善用工具"><a href="#善用工具" class="headerlink" title="善用工具"></a>善用工具</h2><p>工具能解决的事情就用工具去解决，好的工具能节约大把的时间用在更有意义的事情上。</p>
<p>工具的范畴很广，比如linux的各种命令、比如团队内部的各种系统、比如顺手的应用、甚至包括上下班骑的自行车。只要能节约时间、提高效率，那就值得一试。</p>
<p>在这里我列举几个大幅度提升了我的效率的东西：</p>
<ul>
<li>双屏显示器</li>
<li>顺手的键盘</li>
<li>google（不是baidu！不是bing！）</li>
<li>mac</li>
<li>mac上的应用：idea、alfread、omnifocus、甚至synergy和istats menus之类跟开发本身关系不大的应用。</li>
</ul>
<p>我更倾向于把“使用工具”作为一种生活态度：是否希望让自己的生活专注于有意义的事情。如果你认同这个观点，那么想一想投入和回报比例，还是很可观的。</p>
<p>（当然，为了不花钱而自己破解应用的大神也是极叼的……）</p>
<h2 id="提高时间的利用率"><a href="#提高时间的利用率" class="headerlink" title="提高时间的利用率"></a>提高时间的利用率</h2><p>时间是所有期待提升自己的人最宝贵的资源，效率再高，没时间做也没意义。</p>
<p>网上有个流传挺广的图：打扰程序员的成本。事实上我每天的工作时间非常碎片化，来到公司之后可能不断的接电话、被问问题、被拉去开会、回复邮件等等；也经常会有时间不够用或者没事做的困惑，这里分享一下心得：</p>
<ul>
<li>GTD可以整合很多碎片时间。除了把事做完之外，把上下文相关的事情集中在一起完成也很有帮助。比如把几件想去其他办公室做的事情整合成一趟完成。</li>
<li>减少无意义的时间浪费，比如家住在公司边上可以每天节省几个小时的时间用来学习或者做别的事情。（但如果节省下来的时间用来刷微博，那就没有必要了。）</li>
<li><ul>
<li>另外一个很有趣的现象：一个软件的注册费就10几刀，贵些的几百刀，把日常用到的所有工具的费用全加起来都顶不上一个肾6贵，但是很多人还是坚持着没有破解不用的观念，为了几百块钱浪费了大把时间。</li>
</ul>
</li>
<li>加班可以创造很多时间，并且能有效减少被打扰的几率，但是也会给身体和精神带来很大负担。因此加班做的事情必须能对个人进步产生足够多的收益。如果加班只是用来处理无意义的工作的话，那应该是日常工作出了什么问题。</li>
<li>事情可以分成紧急重要、紧急不重要、重要不紧急、不重要不紧急四类，在todo列表里随时要有重要不紧急的事情。</li>
</ul>
<h1 id="学会思考"><a href="#学会思考" class="headerlink" title="学会思考"></a>学会思考</h1><h2 id="深究"><a href="#深究" class="headerlink" title="深究"></a>深究</h2><p>当有什么问题解决不了的时候，很多人会有畏难或者拖延的情绪，典型口头禅就是“就这么凑合着用吧”或者“先这样吧，以后有时间再研究”，说这些话的人大多并不是真的那么忙，甚至有人一边刷着微博一边跟我说没时间研究……(你tm在逗我？)</p>
<p>要克服畏难情绪其实很简单，找一个具体的似懂非懂的问题，想尽办法把问题研究清楚，体会几次解决问题时的愉悦感，建立自信。</p>
<p>大部分问题其实没有什么高深的科学原理，甚至只要翻几页书就解决了，但是遇到问题不深究，久而久之会形成自我暗示：这些问题是我懂的，那些是我不懂的，自己反而把自己进步的路给堵上了。</p>
<p>说到如何深究，也有几条心得：</p>
<ul>
<li>遇事多想为什么，并且要反复问为什么。很多貌似理解了的问题过一阵再重新想想，往往会发现之前还有没考虑到的地方</li>
<li>问题要有明确答案，哲学之类的就别纠结了</li>
<li>查找资料时选权威的书籍或者网站，避免被误导</li>
<li>找人讨论，或者直接拉小伙伴入伙，既可以互相交流，又可以互相监督</li>
<li>分享你的成果</li>
<li>不要所有事情全都深究，会给自己太多压力</li>
</ul>
<h2 id="多说，多写，多交流"><a href="#多说，多写，多交流" class="headerlink" title="多说，多写，多交流"></a>多说，多写，多交流</h2><p>平常工作中有一个感受，有交流和写作习惯的人思路会更清晰一些，能接触到的观点也会多一些。这方面其实属于我的弱项，大概总结几个观点。</p>
<ul>
<li>隔一段时间最好能书面形式总结一下最近的工作，比如说写个心得感悟，或者持续更新自己的简历</li>
<li>写作的时候有两个难点：对要说明的事情做总结和抽象，形成观点统一、调理清晰的主线；从对方的视角考虑，把事情说明白，避免自言自语。</li>
<li>找人讨论之前自己先要有个基本完整的思路，否则大部分的时间都要耗在解释原理之类的上网查反而更快的事情上。</li>
<li>讨论之后要有一句话就能说明白的结论和描述清晰的时间点。</li>
<li>有些人喜欢纠结于“这个不是我的问题，为什么要我处理”之类的事情。在我看来这是很好的机会。既能增长见识，又能展示水平，还能留个认真负责的好名声，何乐而不为呢。</li>
</ul>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>最后分享一下关于我理解的程序员的自我修养，在我看来，可以总结为：负责任，重名声。</p>
<p>负责任，说的更具体些：写的代码自己有没有测过、做的框架自己有没有用过、设计的架构自己有没有认真权衡过。</p>
<p>重名声，说的直接些：没有测过的代码、没有用过的框架、没有权衡过的方案有没有脸交付给别人。</p>
<p>与各位共勉。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;http://codecloud.net/4128.html&quot;&gt;原文链接&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;下面这篇优秀的文章来自Axb的自我修养，写得很直白、很真实，很有营养，分享在这里与君共勉！&lt;br&gt;口头禅&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;这其实是两个问题 （不要混淆概念）&lt;br&gt;还有没有更好的方案 （不要思维局限）&lt;br&gt;能不能举个例子 （理论实际相结合）&lt;br&gt;能不能给个一句话总结 （说明自己掌握了重点）&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="life" scheme="http://www.mmmmmcclxxvii.cn/categories/life/"/>
    
    
      <category term="namaste" scheme="http://www.mmmmmcclxxvii.cn/tags/namaste/"/>
    
  </entry>
  
</feed>
